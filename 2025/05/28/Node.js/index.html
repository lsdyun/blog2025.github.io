<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/blog2025.github.io/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog2025.github.io/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog2025.github.io/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog2025.github.io/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog2025.github.io/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"lsdyun.github.io","root":"/blog2025.github.io/","images":"/blog2025.github.io/images","scheme":"Pisces","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/blog2025.github.io/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/blog2025.github.io/js/config.js"></script>

    <meta name="description" content="Node.js开始特点Node.js 就是运行在服务端的 JavaScript。 单线程和事件驱动架构（借助 JavaScript 天生的事件驱动机制）：Node.js 使用单线程来处理请求，但通过事件驱动和非阻塞 I&#x2F;O 操作的特性，使其可以高效地处理大量并发连接，而不会阻塞线程。">
<meta property="og:type" content="article">
<meta property="og:title" content="Node.js">
<meta property="og:url" content="https://lsdyun.github.io/blog2025.github.io/2025/05/28/Node.js/index.html">
<meta property="og:site_name" content="记录博客">
<meta property="og:description" content="Node.js开始特点Node.js 就是运行在服务端的 JavaScript。 单线程和事件驱动架构（借助 JavaScript 天生的事件驱动机制）：Node.js 使用单线程来处理请求，但通过事件驱动和非阻塞 I&#x2F;O 操作的特性，使其可以高效地处理大量并发连接，而不会阻塞线程。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250501104811159.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250501104939131.png">
<meta property="og:image" content="https://www.runoob.com/wp-content/uploads/2014/03/1704959020813.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250501112055816.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250501112418138.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250501112456496.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250501112520393.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250501113202223.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250501113013226.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250501121750279.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250501121840456.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250501122117993.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250501122003672.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250501122305746.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250501124018371.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250501124109073.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250501125800706.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250501130604259.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250501132300378.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250501134702344.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/stream-nodejs.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250502114217591.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250502114129955.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250502131217439.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250502134436168.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250502134531496.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250502134614395.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250502135806178.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250502135924044.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503092619234.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503092710434.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503112310095.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503112331620.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503113237340.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503113257451.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503120118983.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503120134242.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503120147672.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503120203537.png">
<meta property="og:image" content="https://www.runoob.com/wp-content/uploads/2015/09/web_architecture.jpg">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503121623965.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503121806344.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503121827728.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503122544098.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503122747221.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503123947310.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503124347263.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503124411249.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503124916262.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503124933080.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503125907472.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503130001095.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503130240872.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503130021263.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503131301081.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503131319686.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503131353687.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250503131412960.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250504101946525.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250504102326113.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250504102304618.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250504102404458.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250504112144603.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250504112943771.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250504113008729.png">
<meta property="og:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250504114813603.png">
<meta property="article:published_time" content="2025-05-28T03:03:19.701Z">
<meta property="article:modified_time" content="2025-05-28T03:18:17.754Z">
<meta property="article:author" content="lsdyun">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lsdyun.github.io/blog2025.github.io/image-20250501104811159.png">


<link rel="canonical" href="https://lsdyun.github.io/blog2025.github.io/2025/05/28/Node.js/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://lsdyun.github.io/blog2025.github.io/2025/05/28/Node.js/","path":"2025/05/28/Node.js/","title":"Node.js"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Node.js | 记录博客</title>
  








  <noscript>
    <link rel="stylesheet" href="/blog2025.github.io/css/noscript.css">
  </noscript>
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog2025.github.io/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">记录博客</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/blog2025.github.io/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/blog2025.github.io/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-categories"><a href="/blog2025.github.io/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/blog2025.github.io/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Node-js"><span class="nav-number">1.</span> <span class="nav-text">Node.js</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%A7%8B"><span class="nav-number">1.1.</span> <span class="nav-text">开始</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E7%82%B9"><span class="nav-number">1.1.1.</span> <span class="nav-text">特点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">1.1.2.</span> <span class="nav-text">适用场景</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Node-js-%E5%92%8C-SpringBoot"><span class="nav-number">1.1.3.</span> <span class="nav-text">Node.js 和 SpringBoot</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81%E2%80%8C%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E5%AF%B9%E6%AF%94%E2%80%8C"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">1、‌核心特性对比‌</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81%E2%80%8C%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF%E4%B8%8E%E5%85%B8%E5%9E%8B%E5%BA%94%E7%94%A8%E2%80%8C"><span class="nav-number">1.1.3.2.</span> <span class="nav-text">2、‌适用场景与典型应用‌</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E3%80%81%E2%80%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E9%80%82%E9%85%8D%E5%BB%BA%E8%AE%AE%E2%80%8C"><span class="nav-number">1.1.3.3.</span> <span class="nav-text">3、‌数据库适配建议‌</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%E3%80%81%E2%80%8C%E9%80%89%E5%9E%8B%E5%86%B3%E7%AD%96%E6%A0%91%E2%80%8C"><span class="nav-number">1.1.3.4.</span> <span class="nav-text">4、‌选型决策树‌</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5%E3%80%81%E2%80%8C%E6%B7%B7%E5%90%88%E6%9E%B6%E6%9E%84%E5%AE%9E%E8%B7%B5%E2%80%8C"><span class="nav-number">1.1.3.5.</span> <span class="nav-text">5、‌混合架构实践‌</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Node-js-%E7%BB%84%E6%88%90"><span class="nav-number">1.1.4.</span> <span class="nav-text">Node.js 组成</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81%E5%88%9B%E5%BB%BA%E5%BA%94%E7%94%A8%EF%BC%9A"><span class="nav-number">1.1.4.1.</span> <span class="nav-text">1、创建应用：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6%EF%BC%9A"><span class="nav-number">1.1.4.2.</span> <span class="nav-text">2、工作机制：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NPM"><span class="nav-number">1.2.</span> <span class="nav-text">NPM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%EF%BC%9A"><span class="nav-number">1.2.1.</span> <span class="nav-text">定义：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%EF%BC%9A"><span class="nav-number">1.2.2.</span> <span class="nav-text">命令：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#REPL%EF%BC%88%E4%BA%A4%E4%BA%92%E5%BC%8F%E8%A7%A3%E9%87%8A%E5%99%A8%EF%BC%89"><span class="nav-number">1.3.</span> <span class="nav-text">REPL（交互式解释器）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0-callback"><span class="nav-number">1.4.</span> <span class="nav-text">回调函数 callback</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Node-js-%E7%89%B9%E6%80%A7%EF%BC%9A"><span class="nav-number">1.4.1.</span> <span class="nav-text">Node.js 特性：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0-callback-%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%EF%BC%9A"><span class="nav-number">1.4.2.</span> <span class="nav-text">回调函数 callback 使用场景：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%98%BB%E5%A1%9E%E5%92%8C%E9%9D%9E%E9%98%BB%E5%A1%9E%E5%AF%B9%E6%AF%94%EF%BC%9A"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">阻塞和非阻塞对比：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%9E%E8%B0%83%E5%9C%B0%E7%8B%B1"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">回调地狱</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF"><span class="nav-number">1.5.</span> <span class="nav-text">事件循环</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89"><span class="nav-number">1.5.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%E7%9A%84%E9%98%B6%E6%AE%B5"><span class="nav-number">1.5.2.</span> <span class="nav-text">事件循环的阶段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%E7%9A%84%E6%B5%81%E7%A8%8B"><span class="nav-number">1.5.3.</span> <span class="nav-text">事件循环的流程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%8F%E4%BB%BB%E5%8A%A1%E4%B8%8E%E5%BE%AE%E4%BB%BB%E5%8A%A1"><span class="nav-number">1.5.3.1.</span> <span class="nav-text">宏任务与微任务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E6%89%A7%E8%A1%8C%E8%A7%84%E5%88%99%E2%80%8C"><span class="nav-number">1.5.3.2.</span> <span class="nav-text">关键执行规则‌</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B8%E5%9E%8B%E6%B5%81%E7%A8%8B%E6%80%BB%E7%BB%93"><span class="nav-number">1.5.3.3.</span> <span class="nav-text">典型流程总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">1.5.4.</span> <span class="nav-text">事件驱动程序</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-1"><span class="nav-number">1.5.4.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8%E6%A8%A1%E5%9E%8B%E7%9A%84%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="nav-number">1.5.4.2.</span> <span class="nav-text">事件驱动模型的核心组件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B%E2%80%8C"><span class="nav-number">1.5.4.3.</span> <span class="nav-text">事件驱动开发流程‌</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B8%E5%9E%8B%E5%BA%94%E7%94%A8%E6%A1%88%E4%BE%8B%E2%80%8C"><span class="nav-number">1.5.4.4.</span> <span class="nav-text">典型应用案例‌</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#EventEmitter"><span class="nav-number">1.6.</span> <span class="nav-text">EventEmitter</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#EventEmitter-%E7%B1%BB"><span class="nav-number">1.6.1.</span> <span class="nav-text">EventEmitter 类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#EventEmitter-%E4%BA%8B%E4%BB%B6%E7%BB%84%E6%88%90%EF%BC%9A"><span class="nav-number">1.6.2.</span> <span class="nav-text">EventEmitter 事件组成：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#EventEmitter-API%EF%BC%9A"><span class="nav-number">1.6.3.</span> <span class="nav-text">EventEmitter API：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%A7%E6%89%BF-EventEmitter"><span class="nav-number">1.6.4.</span> <span class="nav-text">继承 EventEmitter</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Buffer%EF%BC%88%E7%BC%93%E5%86%B2%EF%BC%89"><span class="nav-number">1.7.</span> <span class="nav-text">Buffer（缓冲）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Buffer-%E4%B8%8E%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81"><span class="nav-number">1.7.1.</span> <span class="nav-text">Buffer 与字符编码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Buffer-API"><span class="nav-number">1.7.2.</span> <span class="nav-text">Buffer API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%99%E5%85%A5%E7%BC%93%E5%86%B2%E5%8C%BA"><span class="nav-number">1.7.3.</span> <span class="nav-text">写入缓冲区</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%BB%E7%BC%93%E5%86%B2%E5%8C%BA"><span class="nav-number">1.7.4.</span> <span class="nav-text">读缓冲区</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%86-Buffer-%E8%BD%AC%E6%8D%A2%E4%B8%BA-JSON-%E5%AF%B9%E8%B1%A1"><span class="nav-number">1.7.5.</span> <span class="nav-text">将 Buffer 转换为 JSON 对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E5%90%88%E5%B9%B6"><span class="nav-number">1.7.6.</span> <span class="nav-text">缓冲区合并</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E6%AF%94%E8%BE%83"><span class="nav-number">1.7.7.</span> <span class="nav-text">缓冲区比较</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E6%8B%B7%E8%B4%9D"><span class="nav-number">1.7.8.</span> <span class="nav-text">缓冲区拷贝</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E8%A3%81%E5%89%AA"><span class="nav-number">1.7.9.</span> <span class="nav-text">缓冲区裁剪</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E9%95%BF%E5%BA%A6"><span class="nav-number">1.7.10.</span> <span class="nav-text">缓冲区长度</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Stream%EF%BC%88%E6%B5%81%EF%BC%89"><span class="nav-number">1.8.</span> <span class="nav-text">Stream（流）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%8E%E6%B5%81%E4%B8%AD%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="nav-number">1.8.1.</span> <span class="nav-text">从流中读取数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%99%E6%95%B0%E6%8D%AE%E5%88%B0%E6%B5%81"><span class="nav-number">1.8.2.</span> <span class="nav-text">写数据到流</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8C%E5%B7%A5%E6%B5%81%EF%BC%88Duplex%EF%BC%89"><span class="nav-number">1.8.3.</span> <span class="nav-text">双工流（Duplex）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BD%AC%E6%8D%A2%E6%B5%81%EF%BC%88Transform%EF%BC%89"><span class="nav-number">1.8.4.</span> <span class="nav-text">转换流（Transform）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%A1%E9%81%93%E6%B5%81%EF%BC%9A%EF%BC%88pipe%EF%BC%89"><span class="nav-number">1.8.5.</span> <span class="nav-text">管道流：（pipe）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%93%BE%E5%BC%8F%E6%B5%81"><span class="nav-number">1.8.6.</span> <span class="nav-text">链式流</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%80%8C%E8%BD%AC%E6%8D%A2%E6%B5%81%E3%80%81%E7%AE%A1%E9%81%93%E6%B5%81%E3%80%81%E9%93%BE%E5%BC%8F%E6%B5%81%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="nav-number">1.8.7.</span> <span class="nav-text">‌转换流、管道流、链式流的关系</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9F"><span class="nav-number">1.9.</span> <span class="nav-text">模块系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E7%B1%BB%E5%9E%8B%EF%BC%9A"><span class="nav-number">1.9.1.</span> <span class="nav-text">模块类型：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E5%86%85%E7%BD%AE%E6%A8%A1%E5%9D%97%EF%BC%9A"><span class="nav-number">1.9.2.</span> <span class="nav-text">导入内置模块：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A8%A1%E5%9D%97"><span class="nav-number">1.9.3.</span> <span class="nav-text">导入第三方模块:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%87%BA%E4%B8%8E%E5%AF%BC%E5%85%A5%EF%BC%88CommonJS-%E6%A8%A1%E5%9D%97%EF%BC%89"><span class="nav-number">1.9.4.</span> <span class="nav-text">自定义模块导出与导入（CommonJS 模块）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%87%BA%E4%B8%8E%E5%AF%BC%E5%85%A5%EF%BC%88ES-%E6%A8%A1%E5%9D%97%EF%BC%89"><span class="nav-number">1.9.5.</span> <span class="nav-text">自定义模块导出与导入（ES 模块）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9D%97%E7%9A%84%E8%B7%AF%E5%BE%84%E8%A7%A3%E6%9E%90"><span class="nav-number">1.9.6.</span> <span class="nav-text">加载模块的路径解析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E7%BC%93%E5%AD%98"><span class="nav-number">1.9.7.</span> <span class="nav-text">模块缓存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%9A%84%E6%A8%A1%E5%9D%97"><span class="nav-number">1.9.8.</span> <span class="nav-text">服务端的模块</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0"><span class="nav-number">1.10.</span> <span class="nav-text">函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E5%A3%B0%E6%98%8E"><span class="nav-number">1.10.1.</span> <span class="nav-text">函数声明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">1.10.2.</span> <span class="nav-text">函数表达式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0"><span class="nav-number">1.10.3.</span> <span class="nav-text">箭头函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.10.4.</span> <span class="nav-text">函数的类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5%E5%87%BD%E6%95%B0"><span class="nav-number">1.10.5.</span> <span class="nav-text">异步函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95"><span class="nav-number">1.10.6.</span> <span class="nav-text">高级用法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0"><span class="nav-number">1.10.7.</span> <span class="nav-text">默认参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Rest-%E5%89%A9%E4%BD%99%E5%8F%82%E6%95%B0-%E2%80%A6%E5%80%BC"><span class="nav-number">1.10.8.</span> <span class="nav-text">Rest 剩余参数[…值]</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%9E%84%E5%8F%82%E6%95%B0"><span class="nav-number">1.10.9.</span> <span class="nav-text">解构参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E6%8E%A8%E8%8D%90%E5%86%99%E6%B3%95%EF%BC%9A"><span class="nav-number">1.10.10.</span> <span class="nav-text">函数推荐写法：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1"><span class="nav-number">1.11.</span> <span class="nav-text">路由</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"><span class="nav-number">1.11.1.</span> <span class="nav-text">请求参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Express-%E8%B7%AF%E7%94%B1"><span class="nav-number">1.11.2.</span> <span class="nav-text">Express 路由</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%A8%E5%B1%80%E5%AF%B9%E8%B1%A1"><span class="nav-number">1.12.</span> <span class="nav-text">全局对象</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%A8%E5%B1%80%E5%AF%B9%E8%B1%A1%E4%B8%8E%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%EF%BC%9A"><span class="nav-number">1.12.1.</span> <span class="nav-text">全局对象与全局变量：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7%EF%BC%88util%EF%BC%89"><span class="nav-number">1.13.</span> <span class="nav-text">常用工具（util）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5-util-%E6%A8%A1%E5%9D%97"><span class="nav-number">1.13.1.</span> <span class="nav-text">导入 util 模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#util-%E6%96%B9%E6%B3%95"><span class="nav-number">1.13.2.</span> <span class="nav-text">util 方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#util-types-%E4%B8%8B%E7%9A%84%E7%B1%BB%E5%9E%8B%E6%A3%80%E6%B5%8B%E6%96%B9%E6%B3%95"><span class="nav-number">1.13.3.</span> <span class="nav-text">util.types 下的类型检测方法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%EF%BC%88fs-%E6%A8%A1%E5%9D%97%EF%BC%89"><span class="nav-number">1.14.</span> <span class="nav-text">文件系统（fs 模块）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5%E5%92%8C%E5%90%8C%E6%AD%A5"><span class="nav-number">1.14.1.</span> <span class="nav-text">异步和同步</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E7%B1%BB-API%E2%80%8C"><span class="nav-number">1.14.2.</span> <span class="nav-text">文件操作类 API‌</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%80%8C%E7%9B%AE%E5%BD%95%E6%93%8D%E4%BD%9C%E7%B1%BB-API%E2%80%8C"><span class="nav-number">1.14.3.</span> <span class="nav-text">‌目录操作类 API‌</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%BF%A1%E6%81%AF%E4%B8%8E%E6%9D%83%E9%99%90%E2%80%8C"><span class="nav-number">1.14.4.</span> <span class="nav-text">文件信息与权限‌</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%80%8C%E6%B5%81%E5%BC%8F%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="nav-number">1.14.5.</span> <span class="nav-text">‌流式文件操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E2%80%8C%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD%E2%80%8C"><span class="nav-number">1.14.6.</span> <span class="nav-text">‌高级功能‌</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Node-js%E5%BA%94%E7%94%A8"><span class="nav-number">1.15.</span> <span class="nav-text">Node.js应用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E7%AE%80%E5%8D%95%E5%BA%94%E7%94%A8"><span class="nav-number">1.15.1.</span> <span class="nav-text">构建简单应用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GET-POST%E5%91%BD%E4%BB%A4"><span class="nav-number">1.15.2.</span> <span class="nav-text">GET&#x2F;POST命令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#GET%EF%BC%9A"><span class="nav-number">1.15.2.1.</span> <span class="nav-text">GET：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#POST%EF%BC%9A"><span class="nav-number">1.15.2.2.</span> <span class="nav-text">POST：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B7%A5%E5%85%B7%E6%A8%A1%E5%9D%97"><span class="nav-number">1.15.3.</span> <span class="nav-text">工具模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Web-%E6%A8%A1%E5%9D%97"><span class="nav-number">1.15.4.</span> <span class="nav-text">Web 模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Node-%E5%88%9B%E5%BB%BA-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">1.15.4.1.</span> <span class="nav-text">使用 Node 创建 Web 服务器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Node-%E5%88%9B%E5%BB%BA-Web-%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-number">1.15.4.2.</span> <span class="nav-text">使用 Node 创建 Web 客户端</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Express-%E6%A1%86%E6%9E%B6"><span class="nav-number">1.15.5.</span> <span class="nav-text">Express 框架</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-Express"><span class="nav-number">1.15.5.1.</span> <span class="nav-text">安装 Express</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E7%A4%BA%E4%BE%8B"><span class="nav-number">1.15.5.2.</span> <span class="nav-text">第一个示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%B7%E6%B1%82%E5%92%8C%E5%93%8D%E5%BA%94"><span class="nav-number">1.15.5.3.</span> <span class="nav-text">请求和响应</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1-1"><span class="nav-number">1.15.5.4.</span> <span class="nav-text">路由</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6"><span class="nav-number">1.15.5.5.</span> <span class="nav-text">静态文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GET-%E6%96%B9%E6%B3%95"><span class="nav-number">1.15.5.6.</span> <span class="nav-text">GET 方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#POST-%E6%96%B9%E6%B3%95"><span class="nav-number">1.15.5.7.</span> <span class="nav-text">POST 方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-number">1.15.5.8.</span> <span class="nav-text">文件上传</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Cookie-%E7%AE%A1%E7%90%86"><span class="nav-number">1.15.5.9.</span> <span class="nav-text">Cookie 管理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RESTful-API"><span class="nav-number">1.15.6.</span> <span class="nav-text">RESTful API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#HTTP-%E6%96%B9%E6%B3%95"><span class="nav-number">1.15.6.1.</span> <span class="nav-text">HTTP 方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E8%BF%9B%E7%A8%8B"><span class="nav-number">1.15.7.</span> <span class="nav-text">多进程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AD%90%E8%BF%9B%E7%A8%8B%E7%BB%84%E6%88%90%EF%BC%9A%EF%BC%88%E4%B8%89%E5%A4%A7%E6%A0%87%E5%87%86%E6%B5%81%EF%BC%89"><span class="nav-number">1.15.7.1.</span> <span class="nav-text">子进程组成：（三大标准流）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%9A%E8%BF%9B%E7%A8%8B%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97"><span class="nav-number">1.15.7.2.</span> <span class="nav-text">多进程核心模块</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JXcore-%E6%89%93%E5%8C%85%EF%BC%88%E4%B8%8D%E5%BB%BA%E8%AE%AE%E4%BD%BF%E7%94%A8-%E4%B8%8D%E6%94%AF%E6%8C%81ES6%EF%BC%89"><span class="nav-number">1.15.8.</span> <span class="nav-text">JXcore 打包（不建议使用-不支持ES6）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#JXcore-%E5%AE%89%E8%A3%85"><span class="nav-number">1.15.8.1.</span> <span class="nav-text">JXcore 安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C"><span class="nav-number">1.15.8.2.</span> <span class="nav-text">运行</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%BC%E5%AE%B9%E6%80%A7%E9%97%AE%E9%A2%98%EF%BC%9A"><span class="nav-number">1.15.8.3.</span> <span class="nav-text">兼容性问题：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pkg-nexe-Next-js-%E7%AD%89%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7"><span class="nav-number">1.15.9.</span> <span class="nav-text">pkg&#x2F;nexe&#x2F;Next.js 等打包工具</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#pkg%E6%95%99%E7%A8%8B%EF%BC%88%E6%8E%A8%E8%8D%90%EF%BC%89"><span class="nav-number">1.15.9.1.</span> <span class="nav-text">pkg教程（推荐）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#nexe%E6%95%99%E7%A8%8B%EF%BC%88%E5%AD%98%E5%9C%A8%E8%81%94%E7%BD%91%E9%97%AE%E9%A2%98%EF%BC%89"><span class="nav-number">1.15.9.2.</span> <span class="nav-text">nexe教程（存在联网问题）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">1.16.</span> <span class="nav-text">数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%B8%80%EF%BC%9A"><span class="nav-number">1.16.1.</span> <span class="nav-text">示例一：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%BA%8C%EF%BC%9A%EF%BC%88%E9%A1%B5%E9%9D%A2-%E8%A7%A3%E8%80%A6%EF%BC%89"><span class="nav-number">1.16.2.</span> <span class="nav-text">示例二：（页面+解耦）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E2%80%8C-%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88RDBMS%EF%BC%89-%E2%80%8C%E2%80%8C"><span class="nav-number">1.16.3.</span> <span class="nav-text">一、‌**关系型数据库（RDBMS）**‌‌</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E2%80%8C-%E9%9D%9E%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88NoSQL%EF%BC%89-%E2%80%8C"><span class="nav-number">1.16.4.</span> <span class="nav-text">二、‌**非关系型数据库（NoSQL）**‌</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E3%80%81NoSQL-%E5%92%8C-MySQL-%E5%8C%BA%E5%88%AB"><span class="nav-number">1.16.5.</span> <span class="nav-text">三、NoSQL 和 MySQL 区别</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="lsdyun"
      src="/blog2025.github.io/images/avatar.png">
  <p class="site-author-name" itemprop="name">lsdyun</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/blog2025.github.io/archives/">
          <span class="site-state-item-count">32</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/blog2025.github.io/categories/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/lsdyun" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;lsdyun" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lsdyun.github.io/blog2025.github.io/2025/05/28/Node.js/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog2025.github.io/images/avatar.png">
      <meta itemprop="name" content="lsdyun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="记录博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Node.js | 记录博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Node.js
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2025-05-28 11:03:19 / 修改时间：11:18:17" itemprop="dateCreated datePublished" datetime="2025-05-28T11:03:19+08:00">2025-05-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/blog2025.github.io/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>


		<!--  设置置顶图标  -->
		        
		<!--  设置置顶图标  -->
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a><a target="_blank" rel="noopener" href="https://www.runoob.com/nodejs/nodejs-tutorial.html">Node.js</a></h1><h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><p><em>Node.js 就是运行在服务端的 JavaScript。</em></p>
<p><em><strong>单线程和事件驱动架构（借助 JavaScript 天生的事件驱动机制）</strong>：Node.js 使用单线程来处理请求，但通过事件驱动和非阻塞 I&#x2F;O 操作的特性，使其可以高效地处理大量并发连接，而不会阻塞线程。</em></p>
<p><em><strong>异步和非阻塞 I&#x2F;O</strong>：这使得 Node.js 能够处理高并发的请求，非常适合 I&#x2F;O 密集型应用，如文件读取、数据库操作和网络请求。</em></p>
<p><em>高性能。</em></p>
<p><em>跨平台。</em></p>
<p><em>基于 Google 的 V8 引擎。</em></p>
<p><em>无需考虑浏览器兼容性问题，直接上 ES6。</em></p>
<p><em>拥有 npm 这个包管理工具。</em> </p>
<p><em>自带 HTTP 服务器模块。</em></p>
<h3 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h3><ul>
<li><strong>Web 服务器</strong>：由于其高效的处理并发请求的能力，Node.js 常被用于构建快速、可扩展的 web 服务器。</li>
<li><strong>实时应用</strong>：例如<em>聊天应用、实时协作工具</em>等。</li>
<li><strong>API 服务</strong>：Node.js 很适合用来开发 RESTful API 和 GraphQL 服务。</li>
<li><strong>命令行工具</strong>：Node.js 还可以用于构建 CLI 工具，利用其易用的库和包管理器进行快速开发。</li>
</ul>
<h3 id="Node-js-和-SpringBoot"><a href="#Node-js-和-SpringBoot" class="headerlink" title="Node.js 和 SpringBoot"></a>Node.js 和 SpringBoot</h3><h4 id="1、‌核心特性对比‌"><a href="#1、‌核心特性对比‌" class="headerlink" title="1、‌核心特性对比‌"></a>1、‌<strong>核心特性对比</strong>‌</h4><table>
<thead>
<tr>
<th>‌<strong>维度</strong>‌</th>
<th>‌<strong>Node.js</strong>‌</th>
<th>‌<strong>Spring Boot</strong>‌</th>
</tr>
</thead>
<tbody><tr>
<td>‌<strong>语言</strong>‌</td>
<td>基于 JavaScript（动态类型）</td>
<td>基于 Java（强类型、面向对象）</td>
</tr>
<tr>
<td>‌<strong>运行时架构</strong>‌</td>
<td><strong>单线程</strong>事件驱动模型，非阻塞 I&#x2F;O 异步处理</td>
<td><strong>多线程</strong>同步模型，依赖线程池处理请求</td>
</tr>
<tr>
<td>‌<strong>性能特点</strong>‌</td>
<td>高并发 I&#x2F;O 密场景优化（如实时通信）</td>
<td>CPU 密集型和复杂事务处理效率更高</td>
</tr>
<tr>
<td>‌<strong>开发效率</strong>‌</td>
<td>轻量级框架，语法简洁，适合快速迭代</td>
<td>配置复杂但功能完善，适合长期维护的大型项目</td>
</tr>
<tr>
<td>‌<strong>生态系统</strong>‌</td>
<td>依赖 npm 包管理，工具链灵活但碎片化</td>
<td>集成 Spring 生态（如 Spring Security、Spring Data）</td>
</tr>
</tbody></table>
<h4 id="2、‌适用场景与典型应用‌"><a href="#2、‌适用场景与典型应用‌" class="headerlink" title="2、‌适用场景与典型应用‌"></a>2、‌<strong>适用场景与典型应用</strong>‌</h4><table>
<thead>
<tr>
<th>‌<strong>场景类型</strong>‌</th>
<th>‌<strong>Node.js 适用场景</strong>‌</th>
<th>‌<strong>Spring Boot 适用场景</strong>‌</th>
</tr>
</thead>
<tbody><tr>
<td>‌<strong>高频交互型</strong>‌</td>
<td>实时聊天应用、在线协作工具、物联网（IoT）数据处理</td>
<td>高频交易系统（如证券交易）、ERP 业务逻辑层</td>
</tr>
<tr>
<td>‌<strong>数据处理型</strong>‌</td>
<td>流媒体服务器、API 网关、日志分析系统</td>
<td>大数据批处理、复杂报表生成、金融风控计算</td>
</tr>
<tr>
<td>‌<strong>架构类型</strong>‌</td>
<td>微服务轻量化部署、Serverless 函数计算</td>
<td>单体分层架构、分布式事务强一致性系统</td>
</tr>
</tbody></table>
<hr>
<h4 id="3、‌数据库适配建议‌"><a href="#3、‌数据库适配建议‌" class="headerlink" title="3、‌数据库适配建议‌"></a>3、‌<strong>数据库适配建议</strong>‌</h4><table>
<thead>
<tr>
<th>‌<strong>数据库类型</strong>‌</th>
<th>‌<strong>Node.js 推荐搭配</strong>‌</th>
<th>‌<strong>Spring Boot 推荐搭配</strong>‌</th>
</tr>
</thead>
<tbody><tr>
<td>‌<strong>关系型数据库</strong>‌</td>
<td>PostgreSQL（通过 TypeORM 或 Sequelize 适配）</td>
<td>MySQL（集成 Hibernate&#x2F;JPA）</td>
</tr>
<tr>
<td>‌<strong>NoSQL 数据库</strong>‌</td>
<td>MongoDB（JSON 文档存储天然契合）</td>
<td>Redis（缓存加速）、Cassandra（大规模分布式存储）</td>
</tr>
<tr>
<td>‌<strong>特殊场景</strong>‌</td>
<td>时序数据库（如 InfluxDB，用于 IoT 时序数据存储）</td>
<td>图数据库（如 Neo4j，支持复杂关系分析）</td>
</tr>
</tbody></table>
<h4 id="4、‌选型决策树‌"><a href="#4、‌选型决策树‌" class="headerlink" title="4、‌选型决策树‌"></a>4、‌<strong>选型决策树</strong>‌</h4><ul>
<li>‌<strong>选择 Node.js</strong>‌ 若满足以下条件：<ul>
<li>需快速开发 MVP（最小可行产品）或实时交互功能</li>
<li>团队熟悉 JavaScript 全栈开发（前后端语言统一）</li>
<li>处理高并发请求且 I&#x2F;O 延迟敏感（如社交平台推送）</li>
</ul>
</li>
<li>‌<strong>选择 Spring Boot</strong>‌ 若满足以下条件：<ul>
<li>需严格事务管理（如银行转账）或复杂业务规则</li>
<li>企业已有 Java 技术栈积累（如微服务治理体系）</li>
<li>长期维护需求优先于开发速度（如政府信息系统）</li>
</ul>
</li>
</ul>
<h4 id="5、‌混合架构实践‌"><a href="#5、‌混合架构实践‌" class="headerlink" title="5、‌混合架构实践‌"></a>5、‌<strong>混合架构实践</strong>‌</h4><table>
<thead>
<tr>
<th>‌<strong>组合方案</strong>‌</th>
<th>‌<strong>说明</strong>‌</th>
</tr>
</thead>
<tbody><tr>
<td>‌<strong>前端+Node.js</strong>‌</td>
<td>使用 Node.js 构建 BFF（Backend For Frontend）层，聚合多后端服务</td>
</tr>
<tr>
<td>‌<strong>Spring Boot+Redis</strong>‌</td>
<td>通过 Redis 缓存高频查询数据，降低 MySQL 负载</td>
</tr>
<tr>
<td>‌<strong>微服务混搭</strong>‌</td>
<td>核心服务用 Spring Boot（强事务），边缘服务用 Node.js（高并发）</td>
</tr>
</tbody></table>
<h3 id="Node-js-组成"><a href="#Node-js-组成" class="headerlink" title="Node.js 组成"></a>Node.js 组成</h3><ul>
<li><strong>require 指令</strong>：在 Node.js 中，使用 require 指令来加载和引入模块，引入的模块可以是内置模块，也可以是第三方模块或自定义模块。</li>
<li>**创建服务器：**服务器可以监听客户端的请求，类似于 Apache 、Nginx 等 HTTP 服务器。</li>
<li><strong>接收请求与响应请求</strong> 服务器很容易创建，客户端可以使用浏览器或终端发送 HTTP 请求，服务器接收请求后返回响应数据。</li>
</ul>
<h4 id="1、创建应用："><a href="#1、创建应用：" class="headerlink" title="1、创建应用："></a>1、创建应用：</h4><p>1、<strong>使用 require 指令来加载和引入模块：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable language_">module</span> = <span class="built_in">require</span>(<span class="string">&#x27;module-name&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>module-name 可以是一个<strong>文件路径</strong>（相对或绝对路径），也可以是一个<strong>模块名称</strong>，如果是一个模块名称，Node.js 会自动从 node_modules 目录中查找该模块。</p>
</li>
<li><p>require 指令会返回被加载的模块的导出对象，可以通过该对象来<strong>访问模块中定义的属性和方法</strong>，如果模块中有多个导出对象，则可以使用<strong>解构赋值</strong> *（解构赋值的规则是，只要等号右边的值不是对象或数组，就先将其转为对象。）*的方式来获取它们。</p>
</li>
<li><p>使用 <strong>require</strong> 指令来载入 http 模块，并将实例化的 HTTP 赋值给变量 http。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
<p>2、<strong>创建服务器：</strong></p>
<p>首先创建一个 server.js 文件</p>
<p>使用 <code>http.createServer()</code> 方法创建服务器，并使用 listen 方法绑定 8888 端口。</p>
<p>函数通过 request, response 参数来接收和响应数据。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//server.js </span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line">http.<span class="title function_">createServer</span>(<span class="keyword">function</span> (<span class="params">request, response</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 发送 HTTP 头部 </span></span><br><span class="line">        <span class="comment">// HTTP 状态值: 200 : OK</span></span><br><span class="line">        <span class="comment">// 内容类型: text/plain</span></span><br><span class="line">        response.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/plain&#x27;</span>&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 发送响应数据 &quot;Hello World&quot;</span></span><br><span class="line">        response.<span class="title function_">end</span>(<span class="string">&#x27;Hello World\n&#x27;</span>);</span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">8888</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 终端打印如下信息</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务器正在启动...\n&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务器运行在 http://127.0.0.1:8888/&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>在 cmd 命令框输入：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node server.js</span><br></pre></td></tr></table></figure>

<p>显示：</p>
<p><img src="/blog2025.github.io/image-20250501104811159.png" alt="image-20250501104811159"></p>
<p>在浏览器访问：<a target="_blank" rel="noopener" href="http://127.0.0.1:8888/">http://127.0.0.1:8888/</a></p>
<p><img src="/blog2025.github.io/image-20250501104939131.png" alt="image-20250501104939131"></p>
<p><strong>解析 Node.js 的 HTTP 服务器：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入 Node.js 内置的 http 模块。</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个新的 HTTP 服务器，每次有请求时都会执行回调函数。</span></span><br><span class="line">http.<span class="title function_">createServer</span>(<span class="keyword">function</span>(<span class="params">request, response</span>)&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//箭头函数</span></span><br><span class="line">http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123; </span><br><span class="line">    ... </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置响应状态码和内容类型。</span></span><br><span class="line">response.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/plain&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//结束响应并发送数据。</span></span><br><span class="line">response.<span class="title function_">end</span>(<span class="string">&#x27;Hello World\n&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//监听指定端口并在服务器启动后输出信息。</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//如:</span></span><br><span class="line">.<span class="title function_">listen</span>(<span class="number">8888</span>);</span><br></pre></td></tr></table></figure>

<h4 id="2、工作机制："><a href="#2、工作机制：" class="headerlink" title="2、工作机制："></a>2、<a target="_blank" rel="noopener" href="https://www.runoob.com/nodejs/nodejs-http-server.html">工作机制</a>：</h4><p>Node.js 基于 ‌<strong>Chrome V8 引擎</strong>‌ 执行 JavaScript 代码，使用 Node.js API 与操作系统交互，并通过 Libuv 处理异步 I&#x2F;O 操作。事件循环和工作线程确保了 Node.js 的高效和非阻塞特性。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">主线程（单线程）</span><br><span class="line">│</span><br><span class="line">├─ 同步任务 → 直接执行  </span><br><span class="line">├─ 异步任务 → 注册至 libuv 线程池或系统内核  </span><br><span class="line">│    ├─ 文件 I/O → 线程池处理  </span><br><span class="line">│    └─ 网络请求 → 系统内核处理  </span><br><span class="line">│  </span><br><span class="line">└─ 事件循环（轮询阶段）  </span><br><span class="line">     │  </span><br><span class="line">     ├─ Timers → I/O Callbacks → Poll → Check → Close  </span><br><span class="line">     │  </span><br><span class="line">     └─ 微任务优先：Promise/process.nextTick 回调</span><br></pre></td></tr></table></figure>

<p><img src="https://www.runoob.com/wp-content/uploads/2014/03/1704959020813.png" alt="img"></p>
<h2 id="NPM"><a href="#NPM" class="headerlink" title="NPM"></a><a target="_blank" rel="noopener" href="https://www.runoob.com/nodejs/nodejs-npm.html">NPM</a></h2><h3 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h3><ul>
<li>NPM（Node Package Manager）是一个 JavaScript 包管理工具，也是 Node.js 的默认包管理器。（安装 Node.js 时就会自动安装）</li>
<li>NPM 允许开发者轻松地下载、安装、共享、管理项目的依赖库和工具。</li>
</ul>
<h3 id="命令："><a href="#命令：" class="headerlink" title="命令："></a>命令：</h3><p><strong>1、升级npm</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install npm -g</span><br></pre></td></tr></table></figure>

<p><strong>2、安装模块</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install &lt;Module Name&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>比如说安装express框架</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express</span><br></pre></td></tr></table></figure>

<p>安装好之后，express 包就放在了工程目录下的 node_modules 目录中，因此在代码中只需要通过 <strong>require(‘express’)</strong> 的方式就好，无需指定第三方包路径。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>3、全局安装与本地安装</strong>：</p>
<p>npm 的包安装分为本地安装（local）、全局安装（global）两种，从敲的命令行来看，差别只是有没有 <strong>-g</strong> 参数。</p>
<ul>
<li><p><strong>本地安装：<strong>将包安装到 node_modules 目录，并将信息保存到 package.json 的 dependencies 中。</strong>（Vue中可见）</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express          <span class="comment"># 本地安装</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>**全局安装：**用于安装命令行工具或需要在多个项目中使用的包。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express -g  	 <span class="comment"># 全局安装</span></span><br></pre></td></tr></table></figure>

<p>全局安装的包版本由 npm 管理，但不会在项目的 <code>package.json</code> 中体现。这意味着全局安装的包可能在不同项目之间共享，但也可能因为版本冲突而导致问题。</p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">特性</th>
<th align="left">本地安装</th>
<th align="left">全局安装</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>安装范围</strong></td>
<td align="left">仅在当前项目中可用</td>
<td align="left">在系统的全局环境中可用</td>
</tr>
<tr>
<td align="left"><strong>命令使用</strong></td>
<td align="left"><code>npm install package-name</code></td>
<td align="left"><code>npm install -g package-name</code></td>
</tr>
<tr>
<td align="left"><strong>安装位置</strong></td>
<td align="left"><code>node_modules</code> 目录</td>
<td align="left">系统全局目录（依 OS 而异）</td>
</tr>
<tr>
<td align="left"><strong>使用场景</strong></td>
<td align="left">项目依赖（库、框架）</td>
<td align="left">CLI 工具、项目生成器</td>
</tr>
<tr>
<td align="left"><strong>访问方式</strong></td>
<td align="left">通过 <code>require()</code> 或 <code>import</code> 使用</td>
<td align="left">在命令行中直接使用</td>
</tr>
<tr>
<td align="left"><strong>依赖声明</strong></td>
<td align="left">在 <code>package.json</code> 中记录</td>
<td align="left">不在 <code>package.json</code> 中记录</td>
</tr>
<tr>
<td align="left"><strong>版本控制</strong></td>
<td align="left">不同项目中可用不同版本</td>
<td align="left">系统中只保留一个版本</td>
</tr>
<tr>
<td align="left"><strong>权限问题</strong></td>
<td align="left">无需特殊权限</td>
<td align="left">可能需要管理员权限</td>
</tr>
</tbody></table>
<p><strong>4、查看安装信息</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm list</span><br><span class="line"><span class="comment"># 查看全局安装的模块</span></span><br><span class="line">npm list -g</span><br><span class="line"><span class="comment"># 查看某个模块的版本号</span></span><br><span class="line">npm list &lt;模块名&gt;</span><br></pre></td></tr></table></figure>

<p><strong>5、卸载：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall &lt;模块名&gt;</span><br></pre></td></tr></table></figure>

<p><strong>6、更新</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm update &lt;模块名&gt;</span><br></pre></td></tr></table></figure>

<p><strong>7、查找模块：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm search &lt;模块名&gt;</span><br></pre></td></tr></table></figure>

<p><strong>8、创建模块：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br></pre></td></tr></table></figure>

<p><img src="/blog2025.github.io/image-20250501112055816.png" alt="image-20250501112055816"></p>
<p>内容：</p>
<p><img src="/blog2025.github.io/image-20250501112418138.png" alt="image-20250501112418138"></p>
<p>结果：</p>
<p><img src="/blog2025.github.io/image-20250501112456496.png" alt="image-20250501112456496"></p>
<p><img src="/blog2025.github.io/image-20250501112520393.png" alt="image-20250501112520393"></p>
<ul>
<li><p>package.json 说明：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">name：项目的名称，应该是唯一的，通常使用小写字母和连字符。</span><br><span class="line">version：项目的版本号，遵循语义化版本控制（Semantic Versioning）。</span><br><span class="line">description：项目的简短描述。</span><br><span class="line">main：项目的入口文件，通常是应用程序的启动文件。</span><br><span class="line">scripts：定义了一系列的命令行脚本，可以在项目中执行特定的任务。</span><br><span class="line">dependencies：列出了项目运行所需的所有依赖包及其版本。</span><br><span class="line">devDependencies：列出了只在开发过程中需要的依赖包及其版本。</span><br><span class="line">peerDependencies：列出了项目期望其依赖包也依赖的包。</span><br><span class="line">optionalDependencies：列出了可选的依赖包。</span><br><span class="line">engines：指定了项目兼容的 Node.js 版本。</span><br><span class="line">repository：项目的代码仓库信息，如 GitHub 仓库的 URL。</span><br><span class="line">keywords：项目的关键词，有助于在 npm 搜索中找到项目。</span><br><span class="line">author：项目的作者信息。</span><br><span class="line">license：项目的许可证信息。</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>9、发布自创模块到 npm官方：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注册用户</span></span><br><span class="line">npm adduser</span><br><span class="line">Username: </span><br><span class="line">Password:</span><br><span class="line">Email: (this IS public) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录npm</span></span><br><span class="line">npm login</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发布模块</span></span><br><span class="line">npm publish</span><br><span class="line"></span><br><span class="line"><span class="comment"># 撤销发布的包（一般限 24 小时内）。</span></span><br><span class="line">npm unpublish package-name</span><br></pre></td></tr></table></figure>

<p><strong>10、运行 <code>package.json</code> 中定义的脚本：</strong></p>
<p>例如 <code>npm run start</code>。</p>
<p>这个 start 在之间创建的 package.json 中修改</p>
<p><img src="/blog2025.github.io/image-20250501113202223.png" alt="image-20250501113202223"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run scripts-name</span><br></pre></td></tr></table></figure>

<p><img src="/blog2025.github.io/image-20250501113013226.png" alt="image-20250501113013226"></p>
<p><strong>11、更新依赖</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm update package-name</span><br></pre></td></tr></table></figure>

<h2 id="REPL（交互式解释器）"><a href="#REPL（交互式解释器）" class="headerlink" title="REPL（交互式解释器）"></a>REPL（交互式解释器）</h2><p>Node.js 提供了一个内置的 REPL（Read-Eval-Print Loop），这是一个交互式编程环境，可以在终端中运行 JavaScript 代码。</p>
<p>REPL：</p>
<ul>
<li><strong>读取（Read）</strong> - 读取用户输入，解析输入的 Javascript 数据结构并存储在内存中。</li>
<li><strong>执行（Eval）</strong> - 执行输入的数据结构</li>
<li><strong>打印（Print）</strong> - 输出结果</li>
<li><strong>循环（Loop）</strong> - 循环操作以上步骤直到用户两次按下 <strong>ctrl-c</strong> 按钮退出。</li>
</ul>
<p>REPL 可以<strong>直接输入并立即执行</strong> JavaScript 代码，快速验证代码片段。</p>
<p>REPL 适合测试简单逻辑和调试以及尝试新语法或 Node.js API。</p>
<p>启动Node：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node</span><br></pre></td></tr></table></figure>

<p><img src="/blog2025.github.io/image-20250501121750279.png" alt="image-20250501121750279"></p>
<p>简单逻辑的测试：输入1+1，直接就打印出2</p>
<p><img src="/blog2025.github.io/image-20250501121840456.png" alt="image-20250501121840456"></p>
<p><img src="/blog2025.github.io/image-20250501122117993.png" alt="image-20250501122117993"></p>
<p>说白了就是能直接运行 JavaScript 代码</p>
<p><img src="/blog2025.github.io/image-20250501122003672.png" alt="image-20250501122003672"></p>
<p>使用下划线(_)获取上一个表达式的运算结果：</p>
<p><img src="/blog2025.github.io/image-20250501122305746.png" alt="image-20250501122305746"></p>
<h2 id="回调函数-callback"><a href="#回调函数-callback" class="headerlink" title="回调函数 callback"></a>回调函数 callback</h2><h3 id="Node-js-特性："><a href="#Node-js-特性：" class="headerlink" title="Node.js 特性："></a><strong>Node.js 特性：</strong></h3><ul>
<li><p>Node.js 的核心特性之一是其非阻塞 I&#x2F;O（输入&#x2F;输出）模型，这使得 Node.js 非常适合处理高并发的网络应用。</p>
</li>
<li><p>Node.js <strong>异步</strong>编程的直接体现就是回调。</p>
</li>
<li><p>Node.js 是<strong>单线程</strong>的，但通过事件驱动和回调机制实现异步操作。</p>
</li>
</ul>
<p>在 Node.js 中，回调函数是一种<strong>异步</strong>编程模式，用于处理 I&#x2F;O 操作，如文件读写、数据库交互、网络请求等，这些操作通常需要花费较长时间，如果采用同步方式，会阻塞整个程序的执行，直到操作完成。</p>
<p>使用回调函数，Node.js 可以在 I&#x2F;O 操作进行时继续执行其他代码，一旦 I&#x2F;O 操作完成，再执行回调函数。</p>
<h3 id="回调函数-callback-使用场景："><a href="#回调函数-callback-使用场景：" class="headerlink" title="回调函数 callback 使用场景："></a><strong>回调函数 callback 使用场景：</strong></h3><ul>
<li>读取文件、写入文件等 I&#x2F;O 操作。</li>
<li>处理网络请求。</li>
<li>数据库查询。</li>
</ul>
<p>例如，我们可以一边读取文件，一边执行其他命令，在文件读取完成后，我们将文件内容作为回调函数的参数返回。这样在执行代码时就没有阻塞或等待文件 I&#x2F;O 操作。这就大大提高了 Node.js 的性能，可以处理大量的并发请求。</p>
<p><strong>回调函数 callback</strong> 一般作为<strong>函数的最后一个参数</strong>出现：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo1</span>(<span class="params">name, age, callback</span>) &#123; &#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo2</span>(<span class="params">value, callback1, callback2</span>) &#123; &#125;</span><br></pre></td></tr></table></figure>

<h4 id="阻塞和非阻塞对比："><a href="#阻塞和非阻塞对比：" class="headerlink" title="阻塞和非阻塞对比："></a><strong>阻塞和非阻塞对比：</strong></h4><table>
<thead>
<tr>
<th>‌<strong>维度</strong>‌</th>
<th>‌<strong>阻塞回调</strong>‌</th>
<th>‌<strong>非阻塞回调</strong>‌</th>
</tr>
</thead>
<tbody><tr>
<td>‌<strong>定义</strong>‌</td>
<td>同步执行，需等待当前操作完成才能继续后续代码</td>
<td>异步执行，立即返回并注册回调函数，主线程继续处理其他任务</td>
</tr>
<tr>
<td>‌<strong>执行线程</strong>‌</td>
<td>阻塞主线程，导致后续逻辑延迟</td>
<td>通过事件循环调度，主线程仅在回调触发时处理结果</td>
</tr>
<tr>
<td>‌<strong>典型方法</strong>‌</td>
<td>同步方法（如 <code>fs.readFileSync</code>）</td>
<td>异步方法（如 <code>fs.readFile</code>）</td>
</tr>
</tbody></table>
<ul>
<li><p>‌<strong>阻塞回调流程</strong>‌：（代码是按照顺序执行的）</p>
<ol>
<li><p>调用同步方法（如 <code>readFileSync</code>）后，主线程<strong>暂停</strong>执行。</p>
</li>
<li><p>等待 I&#x2F;O 操作（如文件读取）完成，期间无法处理其他任务。</p>
</li>
<li><p>操作完成后返回结果，继续执行后续代码。</p>
</li>
</ol>
</li>
<li><p>‌<strong>非阻塞回调流程</strong>‌：（代码是不需要按照顺序执行的）</p>
<ol>
<li><p>调用异步方法（如 <code>readFile</code>）后，主线程立即释放。</p>
</li>
<li><p>I&#x2F;O 操作由底层线程池或系统处理，主线程继续执行后续逻辑。</p>
</li>
<li><p>操作完成后通过事件循环触发回调函数处理结果。</p>
</li>
</ol>
</li>
</ul>
<p><strong>示例代码</strong>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//input.txt</span></span><br><span class="line">回调函数测试，哈哈哈哈</span><br></pre></td></tr></table></figure>

<p>callback.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="comment">// 阻塞回调示例（同步读取文件）</span></span><br><span class="line"><span class="keyword">const</span> data = fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;input.txt&#x27;</span>);  <span class="comment">// 主线程暂停</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(data.<span class="title function_">toString</span>());              <span class="comment">// 需等待文件读取完成</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;程序执行结束&quot;</span>);               <span class="comment">// 最后执行</span></span><br></pre></td></tr></table></figure>

<p><img src="/blog2025.github.io/image-20250501124018371.png" alt="image-20250501124018371"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="comment">// 非阻塞回调示例（异步读取文件）</span></span><br><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&#x27;input.txt&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;   <span class="comment">// 立即返回，主线程继续</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(data.<span class="title function_">toString</span>());            <span class="comment">// 在回调中处理结果</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;程序执行结束&quot;</span>);               <span class="comment">// 先执行此行</span></span><br></pre></td></tr></table></figure>

<p><img src="/blog2025.github.io/image-20250501124109073.png" alt="image-20250501124109073"></p>
<p><strong>性能与适用场景对比</strong>‌</p>
<table>
<thead>
<tr>
<th>‌<strong>维度</strong>‌</th>
<th>‌<strong>阻塞回调</strong>‌</th>
<th>‌<strong>非阻塞回调</strong>‌</th>
</tr>
</thead>
<tbody><tr>
<td>‌<strong>吞吐量</strong>‌</td>
<td>低：单线程顺序处理，易堆积请求</td>
<td>高：通过事件循环复用线程，支持高并发 I&#x2F;O 操作</td>
</tr>
<tr>
<td>‌<strong>适用场景</strong>‌</td>
<td>简单脚本、需严格顺序执行的场景</td>
<td>高并发服务（如 Web 服务器）、实时数据处理（如聊天应用）</td>
</tr>
<tr>
<td>‌<strong>错误处理</strong>‌</td>
<td>通过 <code>try/catch</code> 捕获异常</td>
<td>依赖回调函数的 <code>err</code> 参数或 Promise 的 <code>catch</code> 方法</td>
</tr>
</tbody></table>
<p><strong>关键设计差异总结</strong>‌</p>
<ul>
<li>‌资源占用：<ul>
<li>阻塞回调占用主线程时间，导致 CPU 闲置等待 I&#x2F;O。</li>
<li>非阻塞回调通过事件循环最大化利用 CPU，适合 I&#x2F;O 密集型任务。</li>
</ul>
</li>
<li>‌代码复杂度：<ul>
<li>阻塞代码逻辑简单，但难以扩展高并发需求。</li>
<li>非阻塞代码需处理回调嵌套（回调地狱），可通过 <code>Promise</code> 或 <code>async/await</code> 优化</li>
</ul>
</li>
</ul>
<p><strong>选型建议</strong>‌</p>
<ul>
<li>‌<strong>优先非阻塞回调</strong>‌：构建 Web 服务、实时系统等高并发场景。</li>
<li>‌<strong>慎用阻塞回调</strong>‌：仅限初始化配置、小型工具脚本等轻量任务</li>
</ul>
<h4 id="回调地狱"><a href="#回调地狱" class="headerlink" title="回调地狱"></a><a target="_blank" rel="noopener" href="https://www.runoob.com/nodejs/nodejs-callback.html">回调地狱</a></h4><p>使用 Promises 或者 async&#x2F;await 解决回调地狱中的多层嵌套。</p>
<h2 id="事件循环"><a href="#事件循环" class="headerlink" title="事件循环"></a>事件循环</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>事件循环是 Node.js 处理非阻塞 I&#x2F;O 操作的核心机制，使得单线程能够高效处理多个<strong>并发请求。</strong></p>
<p>事件循环用来处理：</p>
<ul>
<li>文件读取</li>
<li>网络请求</li>
<li>数据库查询</li>
<li>等等</li>
</ul>
<p>事件循环使得 Node.js 能够非阻塞地运行代码、处理多个连接、以及执行异步 I&#x2F;O 操作。</p>
<p>事件循环使得 Node.js 能够处理大量并发的 I&#x2F;O 操作而不会导致线程阻塞，这是 Node.js 高效处理并发请求的关键。</p>
<h3 id="事件循环的阶段"><a href="#事件循环的阶段" class="headerlink" title="事件循环的阶段"></a>事件循环的阶段</h3><ul>
<li><strong>Timers</strong>：<ul>
<li>执行 <code>setTimeout()</code> 和 <code>setInterval()</code> 的回调。</li>
<li>实际执行时间可能因系统调度延迟。</li>
</ul>
</li>
<li><strong>Pending(I&#x2F;O) Callbacks</strong>：<ul>
<li>处理上一轮循环未执行的 I&#x2F;O 异常回调（如 TCP 错误）</li>
</ul>
</li>
<li><strong>Idle&#x2F;prepare</strong>：<ul>
<li>Node.js 内部使用的空闲&#x2F;准备阶段，开发者一般不直接干预。</li>
</ul>
</li>
<li><strong>Poll</strong>：<ul>
<li><strong>执行 I&#x2F;O 回调</strong>‌：处理文件读写、网络请求等异步操作完成后的回调。</li>
<li>‌<strong>等待新事件</strong>‌：若队列为空，则阻塞等待新 I&#x2F;O 事件或直接进入下一阶段。</li>
<li>‌<strong>检查 Check 阶段</strong>‌：若有 <code>setImmediate</code> 回调注册，则提前结束 Poll 阶段。</li>
</ul>
</li>
<li><strong>Check</strong>：<ul>
<li>执行 <code>setImmediate()</code> 回调。</li>
</ul>
</li>
<li><strong>Close Callbacks</strong>：<ul>
<li>处理关闭的回调，如 <code>socket.on(&#39;close&#39;, ...)</code>。</li>
</ul>
</li>
</ul>
<h3 id="事件循环的流程"><a href="#事件循环的流程" class="headerlink" title="事件循环的流程"></a>事件循环的流程</h3><ul>
<li><p><strong>任务进入事件循环队列</strong>。</p>
</li>
<li><p>事件循环按照阶段顺序进行处理，每个阶段有自己的回调队列。</p>
</li>
<li><p>事件循环会在 <code>poll</code> 阶段等待新的事件到达，如果没有事件，会检查其他阶段的回调。</p>
</li>
<li><p>如果 <code>setImmediate()</code> 和 <code>setTimeout()</code> 都存在，<code>setImmediate()</code> 在 <code>check</code> 阶段先执行，而 <code>setTimeout()</code> 在 <code>timers</code> 阶段执行。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Timeout callback&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">setImmediate</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Immediate callback&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Main thread execution&#x27;</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/blog2025.github.io/image-20250501125800706.png" alt="image-20250501125800706"></p>
<h4 id="宏任务与微任务"><a href="#宏任务与微任务" class="headerlink" title="宏任务与微任务"></a><strong>宏任务与微任务</strong></h4><ul>
<li><strong>宏任务</strong>：<code>setTimeout</code>、<code>setInterval</code>、<code>setImmediate</code>、I&#x2F;O 操作等。</li>
<li><strong>微任务</strong>：<code>process.nextTick</code>、<code>Promise.then</code>。</li>
</ul>
<p>**执行顺序：**微任务优先级高于宏任务，会在当前阶段的回调结束后立即执行。</p>
<p><strong>微任务队列优先级</strong>‌</p>
<p>每个阶段结束后，‌<strong>优先清空微任务队列</strong>‌，顺序为：</p>
<ol>
<li>‌**<code>process.nextTick</code> 队列**‌：优先级最高，当前阶段结束后立即执行。</li>
<li>‌<strong>Promise 微任务队列</strong>‌：紧随 <code>process.nextTick</code> 后执行。</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setImmediate</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Check 阶段回调&#x27;</span>));</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Timers 阶段回调&#x27;</span>), <span class="number">0</span>);</span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Promise 微任务&#x27;</span>));</span><br><span class="line">process.<span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;nextTick 微任务&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出顺序：</span></span><br><span class="line"><span class="comment">// nextTick 微任务 → Promise 微任务 → Timers 阶段回调 → Check 阶段回调  </span></span><br></pre></td></tr></table></figure>

<p><img src="/blog2025.github.io/image-20250501130604259.png" alt="image-20250501130604259"></p>
<h4 id="关键执行规则‌"><a href="#关键执行规则‌" class="headerlink" title="关键执行规则‌"></a><strong>关键执行规则</strong>‌</h4><table>
<thead>
<tr>
<th>‌<strong>规则</strong>‌</th>
<th>‌<strong>说明</strong>‌</th>
</tr>
</thead>
<tbody><tr>
<td>‌<strong>阶段顺序固定</strong>‌</td>
<td>每个事件循环必须依次执行 6 个阶段，不可跳跃。</td>
</tr>
<tr>
<td>‌<strong>微任务优先于宏任务</strong>‌</td>
<td>当前阶段宏任务执行后，立即清空微任务队列。</td>
</tr>
<tr>
<td>‌**<code>setTimeout</code> vs <code>setImmediate</code>**‌</td>
<td>在主模块中执行顺序不确定，但在 I&#x2F;O 回调中 <code>setImmediate</code> 优先。</td>
</tr>
</tbody></table>
<h4 id="典型流程总结"><a href="#典型流程总结" class="headerlink" title="典型流程总结"></a>典型流程总结</h4><ol>
<li>执行同步代码，注册异步任务（如 <code>fs.readFile</code>）。</li>
<li>事件循环进入 ‌<strong>Timers 阶段</strong>‌，处理到期的定时器回调。</li>
<li>进入 ‌<strong>Poll 阶段</strong>‌，执行 I&#x2F;O 回调，若队列空则等待新事件或跳转至 Check 阶段。</li>
<li>‌<strong>Check 阶段</strong>‌ 处理 <code>setImmediate</code> 回调。</li>
<li>‌<strong>每个阶段结束后</strong>‌，依次清空 <code>process.nextTick</code> 和 Promise 微任务队列。</li>
<li>循环重复，直至没有待处理的任务。</li>
</ol>
<h3 id="事件驱动程序"><a href="#事件驱动程序" class="headerlink" title="事件驱动程序"></a>事件驱动程序</h3><h4 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h4><p>Node.js 的事件驱动模型通过 ‌<strong>异步非阻塞架构</strong>‌ 和 ‌<strong>高效的事件调度机制</strong>‌，成为构建高性能分布式系统的核心方案</p>
<p>Node.js 的事件驱动模型基于 ‌<strong>EventEmitter 类</strong>‌、‌<strong>非阻塞 I&#x2F;O</strong>‌ 和 ‌<strong>事件循环机制</strong>‌，通过异步回调实现<strong>高并发</strong>处理能力。其核心设计要点如下：</p>
<p><strong>基本概念：</strong></p>
<ul>
<li><strong>事件</strong>：在程序中发生的动作或状态改变，例如一个文件读取完成或一个 HTTP 请求到达。</li>
<li><strong>事件触发器</strong>：<code>EventEmitter</code> 是 Node.js 的内置模块，用来发出和监听事件。</li>
<li><strong>事件处理器</strong>：与事件关联的回调函数，事件发生时被调用。</li>
</ul>
<p><strong>事件驱动的流程：</strong></p>
<ul>
<li><strong>注册事件</strong>：在程序中通过 <code>EventEmitter</code> 实例注册事件和对应的处理器。</li>
<li><strong>触发事件</strong>：当指定的事件发生时，<code>EventEmitter</code> 会触发该事件。</li>
<li><strong>处理事件</strong>：事件循环会调度相应的回调函数来执行任务。</li>
</ul>
<h4 id="事件驱动模型的核心组件"><a href="#事件驱动模型的核心组件" class="headerlink" title="事件驱动模型的核心组件"></a>事件驱动模型的核心组件</h4><ol>
<li><p>‌**事件循环（Event Loop）**‌</p>
<ul>
<li>按固定阶段（Timers → I&#x2F;O Callbacks → Poll → Check → Close）轮询任务队列，调度异步回调执行顺序。</li>
<li>每个阶段结束后优先处理微任务（<code>process.nextTick</code> → Promise）。</li>
</ul>
</li>
<li><p>‌<strong>EventEmitter 类</strong>‌</p>
<ul>
<li><p>继承自 <code>events</code> 模块，用于创建可触发和监听事件的对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入 events 模块</span></span><br><span class="line"><span class="keyword">var</span> events = <span class="built_in">require</span>(<span class="string">&#x27;events&#x27;</span>);</span><br><span class="line"><span class="comment">// 创建 eventEmitter 对象</span></span><br><span class="line"><span class="keyword">var</span> eventEmitter = <span class="keyword">new</span> events.<span class="title class_">EventEmitter</span>();</span><br></pre></td></tr></table></figure>
</li>
<li><p>核心方法：</p>
<ul>
<li><code>on(event, listener)</code>：注册事件监听器。</li>
<li><code>emit(event, [args])</code>：触发事件并调用关联的监听器。</li>
</ul>
</li>
</ul>
</li>
<li><p>‌<strong>非阻塞 I&#x2F;O 模型</strong>‌</p>
<ul>
<li>异步操作（如文件读写、网络请求）立即返回，主线程继续执行后续代码。</li>
<li>操作完成后通过回调函数或事件通知主线程处理结果。</li>
</ul>
</li>
</ol>
<h4 id="事件驱动开发流程‌"><a href="#事件驱动开发流程‌" class="headerlink" title="事件驱动开发流程‌"></a><strong>事件驱动开发流程</strong>‌</h4><ol>
<li><p>‌<strong>定义事件与监听器</strong>‌</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">EventEmitter</span> = <span class="built_in">require</span>(<span class="string">&#x27;events&#x27;</span>);  </span><br><span class="line"><span class="keyword">const</span> myEmitter = <span class="keyword">new</span> <span class="title class_">EventEmitter</span>();  </span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册事件监听器  </span></span><br><span class="line">myEmitter.<span class="title function_">on</span>(<span class="string">&#x27;userAction&#x27;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;  </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`捕获用户行为：<span class="subst">$&#123;data&#125;</span>`</span>);  </span><br><span class="line">&#125;);  </span><br><span class="line"></span><br><span class="line"><span class="comment">// 触发事件  </span></span><br><span class="line">myEmitter.<span class="title function_">emit</span>(<span class="string">&#x27;userAction&#x27;</span>, <span class="string">&#x27;点击按钮&#x27;</span>);  </span><br></pre></td></tr></table></figure>

<p><img src="/blog2025.github.io/image-20250501132300378.png" alt="image-20250501132300378">‌</p>
<ul>
<li><strong>解耦逻辑</strong>‌：不同监听器处理独立任务（如日志记录、数据统计）。</li>
</ul>
</li>
<li><p>‌<strong>异步任务与回调</strong>‌</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);  </span><br><span class="line"></span><br><span class="line"><span class="comment">// 非阻塞文件读取  </span></span><br><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&#x27;data.txt&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;  </span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;  </span><br><span class="line">  myEmitter.<span class="title function_">emit</span>(<span class="string">&#x27;fileRead&#x27;</span>, data.<span class="title function_">toString</span>());  </span><br><span class="line">&#125;);  </span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听文件读取完成事件  </span></span><br><span class="line">myEmitter.<span class="title function_">on</span>(<span class="string">&#x27;fileRead&#x27;</span>, <span class="function">(<span class="params">content</span>) =&gt;</span> &#123;  </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`文件内容：<span class="subst">$&#123;content&#125;</span>`</span>);  </span><br><span class="line">&#125;);  </span><br></pre></td></tr></table></figure>

<ul>
<li>‌<strong>流程控制</strong>‌：通过事件串联异步操作，避免回调嵌套。</li>
</ul>
</li>
</ol>
<h4 id="典型应用案例‌"><a href="#典型应用案例‌" class="headerlink" title="典型应用案例‌"></a><strong>典型应用案例</strong>‌</h4><ul>
<li>‌<strong>实时监控系统</strong>‌：监听文件访问、网络连接等事件，通过队列异步处理并生成报告。</li>
<li>‌<strong>Web 服务器</strong>‌：使用 <code>http</code> 模块监听请求事件，异步响应客户端。</li>
<li>‌<strong>自定义插件</strong>‌：通过 <code>EventEmitter</code> 扩展模块功能，实现松耦合架构。</li>
</ul>
<h2 id="EventEmitter"><a href="#EventEmitter" class="headerlink" title="EventEmitter"></a><a target="_blank" rel="noopener" href="https://www.runoob.com/nodejs/nodejs-event.html">EventEmitter</a></h2><p>Node.js 所有的异步 I&#x2F;O 操作在完成时都会发送一个事件到事件队列。</p>
<p>EventEmitter 是 Node.js 中用于创建、注册和触发事件的核心模块。</p>
<p>EventEmitter 是 Node.js 事件驱动编程的核心模块，通过 ‌<strong>发布-订阅模式</strong>‌ 实现异步事件处理能力，广泛用于网络请求、文件操作等高并发场景。其工作机制与使用要点如下：</p>
<h3 id="EventEmitter-类"><a href="#EventEmitter-类" class="headerlink" title="EventEmitter 类"></a>EventEmitter 类</h3><p>events 模块只提供了一个对象： events.EventEmitter。</p>
<p>EventEmitter 的核心就是事件触发与事件监听器功能的封装。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入 events 模块</span></span><br><span class="line"><span class="keyword">var</span> events = <span class="built_in">require</span>(<span class="string">&#x27;events&#x27;</span>);</span><br><span class="line"><span class="comment">// 创建 eventEmitter 对象</span></span><br><span class="line"><span class="keyword">var</span> eventEmitter = <span class="keyword">new</span> events.<span class="title class_">EventEmitter</span>();</span><br></pre></td></tr></table></figure>

<ul>
<li>实例化时错误 &#x3D;&gt; 触发error事件</li>
<li>添加新的监听器 &#x3D;&gt; 触发 newListener 事件</li>
<li>监听器被移除 &#x3D;&gt; 触发 removeListener 事件</li>
</ul>
<h3 id="EventEmitter-事件组成："><a href="#EventEmitter-事件组成：" class="headerlink" title="EventEmitter 事件组成："></a>EventEmitter 事件组成：</h3><ul>
<li>事件名：一个字符串，如：<code>&#39;SomeEvent&#39;</code><ul>
<li>EventEmitter 支持 若干个事件监听器。</li>
</ul>
</li>
<li>若干参数：</li>
</ul>
<p>如：注册了两个事件监听器的事件 <code>&#39;SomeEvent&#39;</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//event.js 文件</span></span><br><span class="line"><span class="keyword">var</span> events = <span class="built_in">require</span>(<span class="string">&#x27;events&#x27;</span>); </span><br><span class="line"><span class="keyword">var</span> emitter = <span class="keyword">new</span> events.<span class="title class_">EventEmitter</span>(); </span><br><span class="line">emitter.<span class="title function_">on</span>(<span class="string">&#x27;someEvent&#x27;</span>, <span class="keyword">function</span>(<span class="params">arg1, arg2</span>) &#123; </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;listener1&#x27;</span>, arg1, arg2); </span><br><span class="line">&#125;); </span><br><span class="line">emitter.<span class="title function_">on</span>(<span class="string">&#x27;someEvent&#x27;</span>, <span class="keyword">function</span>(<span class="params">arg1, arg2</span>) &#123; </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;listener2&#x27;</span>, arg1, arg2); </span><br><span class="line">&#125;); </span><br><span class="line">emitter.<span class="title function_">emit</span>(<span class="string">&#x27;someEvent&#x27;</span>, <span class="string">&#x27;arg1 参数&#x27;</span>, <span class="string">&#x27;arg2 参数&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/blog2025.github.io/image-20250501134702344.png" alt="image-20250501134702344"></p>
<h3 id="EventEmitter-API："><a href="#EventEmitter-API：" class="headerlink" title="EventEmitter API："></a>EventEmitter API：</h3><table>
<thead>
<tr>
<th><strong>方法</strong>‌</th>
<th>‌<strong>功能说明</strong>‌</th>
<th>‌<strong>示例</strong>‌</th>
</tr>
</thead>
<tbody><tr>
<td><code>on(event, listener)</code></td>
<td>注册事件监听器，可重复添加同一事件的多个监听器</td>
<td><code>emitter.on(&#39;connect&#39;, () =&gt; &#123; console.log(&#39;连接成功&#39;); &#125;)</code></td>
</tr>
<tr>
<td><code>once(event, listener)</code></td>
<td>注册一次性监听器，事件触发后自动移除</td>
<td><code>emitter.once(&#39;init&#39;, () =&gt; &#123; console.log(&#39;初始化完成&#39;); &#125;)</code></td>
</tr>
<tr>
<td><code>emit(event, [...args])</code></td>
<td>触发指定事件，同步调用所有关联的监听器并按注册顺序传递参数</td>
<td><code>emitter.emit(&#39;error&#39;, new Error(&#39;操作失败&#39;))</code></td>
</tr>
<tr>
<td><code>removeListener(event, listener)</code></td>
<td>移除指定事件的某个监听器</td>
<td><code>emitter.removeListener(&#39;data&#39;, dataHandler)</code></td>
</tr>
<tr>
<td><code>removeAllListeners(event)</code></td>
<td>移除指定事件的所有监听器（不传参数则移除全部事件监听器）</td>
<td><code>emitter.removeAllListeners(&#39;log&#39;)</code></td>
</tr>
<tr>
<td><code>addListener(event, listener)</code></td>
<td>为指定事件添加一个监听器到监听器数组的尾部。</td>
<td></td>
</tr>
<tr>
<td><code>setMaxListeners(n)</code></td>
<td>默认情况下， EventEmitters 如果你添加的监听器超过 10 个就会输出警告信息。 setMaxListeners 函数用于改变监听器的默认限制的数量。</td>
<td><code>emitter.setMaxListeners(20)</code></td>
</tr>
<tr>
<td><code>listeners(event)</code></td>
<td>返回指定事件的监听器数组。</td>
<td></td>
</tr>
<tr>
<td><code>listenerCount(emitter, event)</code></td>
<td>返回指定事件的监听器数量。</td>
<td><code>events.emitter.listenerCount(eventName)</code></td>
</tr>
</tbody></table>
<h3 id="继承-EventEmitter"><a href="#继承-EventEmitter" class="headerlink" title="继承 EventEmitter"></a>继承 EventEmitter</h3><p>大多数时候我们不会直接使用 EventEmitter，而是在对象中继承它，包括 fs、net、http 在内的，只要是支持事件响应的核心模块都是 EventEmitter 的子类。</p>
<p>大多数 Node.js 核心模块（如 HTTP、文件系统）都继承了 EventEmitter，你可以创建自己的类来继承 EventEmitter。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyEmitter</span> <span class="keyword">extends</span> <span class="title class_ inherited__">EventEmitter</span> &#123;&#125;</span><br><span class="line"><span class="keyword">const</span> customEmitter = <span class="keyword">new</span> <span class="title class_">MyEmitter</span>();</span><br><span class="line"></span><br><span class="line">customEmitter.<span class="title function_">on</span>(<span class="string">&#x27;customEvent&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Custom event fired&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">customEmitter.<span class="title function_">emit</span>(<span class="string">&#x27;customEvent&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Buffer（缓冲）"><a href="#Buffer（缓冲）" class="headerlink" title="Buffer（缓冲）"></a>Buffer（缓冲）</h2><p>说白了就是转换数据用的。</p>
<p>JavaScript 语言自身只有字符串数据类型，没有二进制数据类型。</p>
<p>Buffer 类是用于处理二进制数据的核心工具，提供了对二进制数据的高效操作。尤其在处理文件操作、网络通信、图像处理等场景中特别有用。</p>
<p>特性：</p>
<ul>
<li><strong>二进制数据</strong>：<code>Buffer</code> 对象是一个包含原始二进制数据的固定大小的数组。每个元素占用一个字节（8位），因此 <code>Buffer</code> 适合处理二进制数据，如文件内容、网络数据包等。</li>
<li><strong>不可变性</strong>：虽然 <code>Buffer</code> 对象的内容可以在创建后修改，但其长度是固定的，不能动态改变。</li>
</ul>
<h3 id="Buffer-与字符编码"><a href="#Buffer-与字符编码" class="headerlink" title="Buffer 与字符编码"></a>Buffer 与字符编码</h3><p>Buffer 实例一般用于表示编码字符的序列，比如 UTF-8 、 UCS2 、 Base64 、或十六进制编码的数据。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buf = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;测试&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出 e6b58be8af95</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf.<span class="title function_">toString</span>(<span class="string">&#x27;hex&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出 5rWL6K+V</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf.<span class="title function_">toString</span>(<span class="string">&#x27;base64&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p><strong>Node.js 目前支持的字符编码包括：</strong></p>
<ul>
<li><strong>ascii</strong> - 仅支持 7 位 ASCII 数据。如果设置去掉高位的话，这种编码是非常快的。</li>
<li><strong>utf8</strong> - 多字节编码的 Unicode 字符。许多网页和其他文档格式都使用 UTF-8 。</li>
<li><strong>utf16le</strong> - 2 或 4 个字节，小字节序编码的 Unicode 字符。支持代理对（U+10000 至 U+10FFFF）。</li>
<li><strong>ucs2</strong> - <strong>utf16le</strong> 的别名。</li>
<li><strong>base64</strong> - Base64 编码。</li>
<li><strong>latin1</strong> - 一种把 <strong>Buffer</strong> 编码成一字节编码的字符串的方式。</li>
<li><strong>binary</strong> - <strong>latin1</strong> 的别名。</li>
<li><strong>hex</strong> - 将每个字节编码为两个十六进制字符。</li>
</ul>
<h3 id="Buffer-API"><a href="#Buffer-API" class="headerlink" title="Buffer API"></a>Buffer API</h3><table>
<thead>
<tr>
<th>API</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Buffer.alloc(size[, fill[, encoding]])</strong></td>
<td>创建了一个长度为 size 字节的 Buffer，相当于申请了 size 字节的内存空间，每个字节的值为 0。</td>
</tr>
<tr>
<td><strong>Buffer.allocUnsafe(size)</strong></td>
<td>建了一个长度为 size 字节的 Buffer，但 Buffer 中可能存在旧的数据，可能会影响执行结果，所以叫 unsafe。</td>
</tr>
<tr>
<td><strong>Buffer.allocUnsafeSlow(size)</strong></td>
<td>用于分配给定大小 size 的新 Buffer 实例，但不对其进行初始化。</td>
</tr>
<tr>
<td><strong>Buffer.from(array)</strong></td>
<td>返回一个被 array 的值初始化的新的 Buffer 实例（传入的 array 的元素只能是数字，不然就会自动被 0 覆盖）。</td>
</tr>
<tr>
<td><strong>Buffer.from(arrayBuffer[, byteOffset[, length]])</strong></td>
<td>返回一个新建的与给定的 ArrayBuffer 共享同一内存的 Buffer。</td>
</tr>
<tr>
<td><strong>Buffer.from(buffer)</strong></td>
<td>复制传入的 Buffer 实例的数据，并返回一个新的 Buffer 实例。</td>
</tr>
<tr>
<td><strong>Buffer.from(string[, encoding])</strong></td>
<td>通过字符串创建 Buffer，可以指定编码，默认为 UTF-8。</td>
</tr>
</tbody></table>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/nodejs/nodejs-buffer.html">更多 API</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个长度为 10、且用 0 填充的 Buffer。</span></span><br><span class="line"><span class="keyword">const</span> buf1 = <span class="title class_">Buffer</span>.<span class="title function_">alloc</span>(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个长度为 10、且用 0x1 填充的 Buffer。 </span></span><br><span class="line"><span class="keyword">const</span> buf2 = <span class="title class_">Buffer</span>.<span class="title function_">alloc</span>(<span class="number">10</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个长度为 10、且未初始化的 Buffer。</span></span><br><span class="line"><span class="comment">// 这个方法比调用 Buffer.alloc() 更快，</span></span><br><span class="line"><span class="comment">// 但返回的 Buffer 实例可能包含旧数据，</span></span><br><span class="line"><span class="comment">// 因此需要使用 fill() 或 write() 重写。</span></span><br><span class="line"><span class="keyword">const</span> buf3 = <span class="title class_">Buffer</span>.<span class="title function_">allocUnsafe</span>(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个包含 [0x1, 0x2, 0x3] 的 Buffer。</span></span><br><span class="line"><span class="keyword">const</span> buf4 = <span class="title class_">Buffer</span>.<span class="title function_">from</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个包含 UTF-8 字节 [0x74, 0xc3, 0xa9, 0x73, 0x74] 的 Buffer。</span></span><br><span class="line"><span class="keyword">const</span> buf5 = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;tést&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个包含 Latin-1 字节 [0x74, 0xe9, 0x73, 0x74] 的 Buffer。</span></span><br><span class="line"><span class="keyword">const</span> buf6 = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;tést&#x27;</span>, <span class="string">&#x27;latin1&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="写入缓冲区"><a href="#写入缓冲区" class="headerlink" title="写入缓冲区"></a>写入缓冲区</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buf.<span class="title function_">write</span>(string[, offset[, length]][, encoding])</span><br></pre></td></tr></table></figure>

<p><strong>参数</strong>：</p>
<ul>
<li><strong>string</strong> - 写入缓冲区的字符串。</li>
<li><strong>offset</strong> - 缓冲区开始写入的索引值，默认为 0 。</li>
<li><strong>length</strong> - 写入的字节数，默认为 buffer.length</li>
<li><strong>encoding</strong> - 编码类型。默认为 ‘utf8’ 。</li>
</ul>
<p>根据 endoding <strong>编码类型</strong>，将<strong>长度</strong>为 length 的<strong>字符串</strong> string 写入到<strong>缓冲区</strong>的 offset <strong>索引位置</strong>  。</p>
<p>如果缓冲区空间不足，字符串会被截断，只会写入一部分字符串到缓冲区。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buf = <span class="title class_">Buffer</span>.<span class="title function_">alloc</span>(<span class="number">10</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;utf8&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> len = buf.<span class="title function_">write</span>(<span class="string">&quot;测试测试测试测试测试&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;写入字节数 : &quot;</span>+  len);<span class="comment">// 输出 9</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> buf = <span class="title class_">Buffer</span>.<span class="title function_">alloc</span>(<span class="number">10</span>);</span><br><span class="line"><span class="comment">// 在 write() 方法中显式指定编码</span></span><br><span class="line"><span class="keyword">const</span> len = buf.<span class="title function_">write</span>(<span class="string">&quot;测试测试测试测试测试&quot;</span>, <span class="number">0</span>, buf.<span class="property">length</span>, <span class="string">&quot;utf8&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;写入字节数 : &quot;</span> + len); <span class="comment">// 输出 9</span></span><br></pre></td></tr></table></figure>

<h3 id="读缓冲区"><a href="#读缓冲区" class="headerlink" title="读缓冲区"></a>读缓冲区</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buf.<span class="title function_">toString</span>([encoding[, start[, end]]])</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buf = <span class="title class_">Buffer</span>.<span class="title function_">alloc</span>(<span class="number">10</span>,<span class="string">&quot;&quot;</span>,<span class="string">&quot;utf8&quot;</span>);</span><br><span class="line">buf.<span class="title function_">write</span>(<span class="string">&quot;测试测试测试测试测试&quot;</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span> ; i++)&#123;</span><br><span class="line">    buf[i] = i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf);<span class="comment">// 输出 &lt;Buffer 00 01 02 03 04 05 06 07 08 09&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> buf = <span class="title class_">Buffer</span>.<span class="title function_">alloc</span>(<span class="number">10</span>);</span><br><span class="line"><span class="comment">// 在 write() 方法中显式指定编码和写入长度</span></span><br><span class="line">buf.<span class="title function_">write</span>(<span class="string">&quot;测试测试测试测试测试&quot;</span>, <span class="number">0</span>, buf.<span class="property">length</span>, <span class="string">&quot;utf8&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf.<span class="title function_">toString</span>(<span class="string">&#x27;utf8&#x27;</span>, <span class="number">0</span> , <span class="number">3</span>));<span class="comment">// 输出 &quot;测&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf.<span class="title function_">toString</span>(<span class="string">&#x27;utf8&#x27;</span>));<span class="comment">// 输出 &quot;测试测&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf.<span class="title function_">toString</span>(<span class="literal">undefined</span>));<span class="comment">// 输出 &quot;测试测&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="将-Buffer-转换为-JSON-对象"><a href="#将-Buffer-转换为-JSON-对象" class="headerlink" title="将 Buffer 转换为 JSON 对象"></a>将 Buffer 转换为 JSON 对象</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buf.<span class="title function_">toJSON</span>()</span><br></pre></td></tr></table></figure>

<p>ASCII 字符</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buf = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf.<span class="title function_">toJSON</span>());</span><br><span class="line"><span class="comment">// 输出: &#123; type: &#x27;Buffer&#x27;, data: [ 97, 98, 99 ] &#125;</span></span><br><span class="line"><span class="comment">// data 数组中的 97, 98, 99 是 ASCII 码，对应字符 a, b, c。</span></span><br></pre></td></tr></table></figure>

<p>UTF-8 编码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buf = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&quot;测试&quot;</span>, <span class="string">&quot;utf8&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf.<span class="title function_">toJSON</span>());</span><br><span class="line"><span class="comment">// 输出: &#123; type: &#x27;Buffer&#x27;, data: [ 230, 181, 139, 232, 175, 149 ] &#125;</span></span><br><span class="line"><span class="comment">// 每个汉字在 UTF-8 编码下占 3 字节，测试 共 6 字节。</span></span><br></pre></td></tr></table></figure>

<p>空 Buffer</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buf = <span class="title class_">Buffer</span>.<span class="title function_">alloc</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf.<span class="title function_">toJSON</span>());</span><br><span class="line"><span class="comment">// 输出: &#123; type: &#x27;Buffer&#x27;, data: [] &#125;</span></span><br></pre></td></tr></table></figure>

<p>‌<strong>JSON 序列化</strong></p>
<p>当需要将 Buffer 数据通过 JSON.stringify() 转换为 JSON 字符串时，toJSON() 会自动调用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buf = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> json = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(buf);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(json); </span><br><span class="line"><span class="comment">// 输出: &#123;&quot;type&quot;:&quot;Buffer&quot;,&quot;data&quot;:[104,101,108,108,111]&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>反序列化还原 Buffer</strong></p>
<p>通过 <code>Buffer.from(jsonObj.data)</code> 可将 JSON 对象转回 Buffer：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jsonStr = <span class="string">&#x27;&#123;&quot;type&quot;:&quot;Buffer&quot;,&quot;data&quot;:[104,101,108,108,111]&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> jsonObj = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(jsonStr);</span><br><span class="line"><span class="keyword">const</span> buf = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(jsonObj.<span class="property">data</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf.<span class="title function_">toString</span>()); <span class="comment">// 输出: hello</span></span><br></pre></td></tr></table></figure>

<h3 id="缓冲区合并"><a href="#缓冲区合并" class="headerlink" title="缓冲区合并"></a>缓冲区合并</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Buffer</span>.<span class="title function_">concat</span>(list[, totalLength])</span><br></pre></td></tr></table></figure>

<p><strong>参数：</strong></p>
<ul>
<li><strong>list</strong> - 用于合并的 Buffer 对象数组列表。</li>
<li><strong>totalLength</strong> - 指定合并后Buffer对象的总长度。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> buffer1 = <span class="title class_">Buffer</span>.<span class="title function_">from</span>((<span class="string">&#x27;测试&#x27;</span>));</span><br><span class="line"><span class="keyword">var</span> buffer2 = <span class="title class_">Buffer</span>.<span class="title function_">from</span>((<span class="string">&#x27;test&#x27;</span>));</span><br><span class="line"><span class="keyword">var</span> buffer3 = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>([buffer1,buffer2]);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;buffer3 内容: &quot;</span> + buffer3.<span class="title function_">toString</span>());</span><br><span class="line"><span class="comment">//输出 buffer3 内容:测试test</span></span><br></pre></td></tr></table></figure>

<h3 id="缓冲区比较"><a href="#缓冲区比较" class="headerlink" title="缓冲区比较"></a>缓冲区比较</h3><p>可以用于排序和数据校验</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buf.<span class="title function_">compare</span>(otherBuffer);</span><br></pre></td></tr></table></figure>

<p><strong>参数：</strong></p>
<ul>
<li><strong>otherBuffer</strong> - 与 <strong>buf</strong> 对象比较的另外一个 Buffer 对象。</li>
</ul>
<p><strong>返回值：<code>-1</code>、<code>0</code> 或 <code>1</code>，表示比较结果</strong></p>
<ul>
<li>**<code>-1</code>**‌：当前 Buffer (<code>buf</code>) 在字典序中排在 <code>otherBuffer</code> 之前。</li>
<li>‌**<code>0</code>**‌：两个 Buffer 内容完全相同。</li>
<li>‌**<code>1</code>**‌：当前 Buffer 在字典序中排在 <code>otherBuffer</code> 之后。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> buffer1 = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;ABC&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> buffer2 = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;ABCD&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> result = buffer1.<span class="title function_">compare</span>(buffer2);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(result &lt; <span class="number">0</span>) &#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(buffer1 + <span class="string">&quot; 在 &quot;</span> + buffer2 + <span class="string">&quot;之前&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(result == <span class="number">0</span>)&#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(buffer1 + <span class="string">&quot; 与 &quot;</span> + buffer2 + <span class="string">&quot;相同&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(buffer1 + <span class="string">&quot; 在 &quot;</span> + buffer2 + <span class="string">&quot;之后&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出ABC在ABCD之前 </span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buf1 = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;ABC&#x27;</span>);  </span><br><span class="line"><span class="keyword">const</span> buf2 = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;ABD&#x27;</span>);  </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf1.<span class="title function_">compare</span>(buf2)); <span class="comment">// 输出: -1  </span></span><br><span class="line"><span class="comment">//前两位 A（0x41）和 B（0x42）相同，第三位 C（0x43） &lt; D（0x44），故返回 -1。</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buf5 = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;123&#x27;</span>);  </span><br><span class="line"><span class="keyword">const</span> buf6 = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;ABC&#x27;</span>);  </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf5.<span class="title function_">compare</span>(buf6)); <span class="comment">// 输出: -1  </span></span><br><span class="line"><span class="comment">// 数字字符 1 的 ASCII 码（0x31）小于字母 A（0x41）</span></span><br></pre></td></tr></table></figure>

<p><strong>排序 Buffer 数组</strong>‌</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buffers = [<span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;Z&#x27;</span>), <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;A&#x27;</span>), <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;M&#x27;</span>)];  </span><br><span class="line">buffers.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a.<span class="title function_">compare</span>(b));  </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buffers);</span><br><span class="line"><span class="comment">// 输出: [ &lt;Buffer 41&gt;, &lt;Buffer 4d&gt;, &lt;Buffer 5a&gt; ]  </span></span><br></pre></td></tr></table></figure>

<ul>
<li>排序结果为 <code>A</code>、<code>M</code>、<code>Z</code>（按 ASCII 码升序）。</li>
</ul>
<p>‌<strong>数据一致性校验</strong>‌<br>比对文件、网络传输等场景中的二进制数据是否一致：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> file1 = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;file_content&#x27;</span>);  </span><br><span class="line"><span class="keyword">const</span> file2 = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;file_content&#x27;</span>);  </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(file1.<span class="title function_">compare</span>(file2) === <span class="number">0</span>); </span><br><span class="line"><span class="comment">// 输出: true </span></span><br></pre></td></tr></table></figure>

<h3 id="缓冲区拷贝"><a href="#缓冲区拷贝" class="headerlink" title="缓冲区拷贝"></a>缓冲区拷贝</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buf.<span class="title function_">copy</span>(targetBuffer[, targetStart[, sourceStart[, sourceEnd]]])</span><br></pre></td></tr></table></figure>

<p><strong>参数</strong>：</p>
<ul>
<li><strong>targetBuffer</strong> - 要拷贝的 Buffer 对象。</li>
<li><strong>targetStart</strong> - 数字, 可选, 默认: 0</li>
<li><strong>sourceStart</strong> - 数字, 可选, 默认: 0</li>
<li><strong>sourceEnd</strong> - 数字, 可选, 默认: buffer.length</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buf1 = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> buf2 = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//将 buf2 插入到 buf1 指定位置上</span></span><br><span class="line">buf2.<span class="title function_">copy</span>(buf1, <span class="number">2</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(buf1.<span class="title function_">toString</span>());</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buf1 = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&quot;测试测试测试&quot;</span>, <span class="string">&quot;utf8&quot;</span>); <span class="comment">// 18 字节</span></span><br><span class="line"><span class="keyword">const</span> buf2 = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&quot;哈哈&quot;</span>, <span class="string">&quot;utf8&quot;</span>); <span class="comment">// 6 字节</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建新 Buffer，总长度 = buf1长度 + buf2长度</span></span><br><span class="line"><span class="keyword">const</span> newBuf = <span class="title class_">Buffer</span>.<span class="title function_">alloc</span>(buf1.<span class="property">length</span> + buf2.<span class="property">length</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复制原 buf1 的前 3 字节（&quot;测&quot;）</span></span><br><span class="line">buf1.<span class="title function_">copy</span>(newBuf, <span class="number">0</span>, <span class="number">0</span>, <span class="number">3</span>); </span><br><span class="line"><span class="comment">// 插入 buf2（&quot;哈哈&quot;）</span></span><br><span class="line">buf2.<span class="title function_">copy</span>(newBuf, <span class="number">3</span>); </span><br><span class="line"><span class="comment">// 复制原 buf1 的剩余字节（从第 3 字节到末尾）</span></span><br><span class="line">buf1.<span class="title function_">copy</span>(newBuf, <span class="number">3</span> + buf2.<span class="property">length</span>, <span class="number">3</span>); </span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newBuf.<span class="title function_">toString</span>()); <span class="comment">// 输出：测哈哈测试测试测试</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">测 (0-2) | 哈 (3-5) | 哈 (6-8) | 测 (9-11) | 试 (12-14) | 测 (15-17) |</span></span><br><span class="line"><span class="comment"> 试 (18-20) | 测 (21-23) | 试 (24-26) |</span></span><br><span class="line"><span class="comment">→ &quot;测哈哈测试测试测试&quot;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h3 id="缓冲区裁剪"><a href="#缓冲区裁剪" class="headerlink" title="缓冲区裁剪"></a>缓冲区裁剪</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buf.<span class="title function_">slice</span>([start[, end]])</span><br></pre></td></tr></table></figure>

<p><strong>参数：</strong></p>
<ul>
<li><strong>start</strong> - 数字, 可选, 默认: 0</li>
<li><strong>end</strong> - 数字, 可选, 默认: buffer.length</li>
</ul>
<p><strong>返回值：</strong></p>
<p>返回一个新的缓冲区，它和旧缓冲区指向<strong>同一块内存</strong>，但是从索引 start 到 end 的位置剪切。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> buffer1 = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line"><span class="comment">// 剪切缓冲区</span></span><br><span class="line"><span class="keyword">var</span> buffer2 = buffer1.<span class="title function_">slice</span>(<span class="number">0</span>,<span class="number">2</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;buffer2的内容为: &quot;</span> + buffer2.<span class="title function_">toString</span>());</span><br><span class="line"><span class="comment">// 输出buffer2的内容为:te</span></span><br></pre></td></tr></table></figure>

<h3 id="缓冲区长度"><a href="#缓冲区长度" class="headerlink" title="缓冲区长度"></a>缓冲区长度</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buf.<span class="property">length</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> buffer = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line"><span class="comment">//  缓冲区长度</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;buffer 长度为: &quot;</span> + buffer.<span class="property">length</span>);</span><br><span class="line"><span class="comment">// buffer 长度为: 4</span></span><br></pre></td></tr></table></figure>

<h2 id="Stream（流）"><a href="#Stream（流）" class="headerlink" title="Stream（流）"></a>Stream（流）</h2><p>Stream 是一种处理流式数据的抽象接口，广泛应用于文件操作、网络通信等场景。</p>
<p>Node 中有很多对象实现了这个接口。例如，对 http 服务器发起请求的 request 对象就是一个 Stream，还有stdout（标准输出）。</p>
<p>Stream 的一个主要优点是可以在数据<strong>传输过程中</strong>就开始处理数据，而不需要等待整个数据加载完毕，这使得 Node.js 能够<strong>高效地处理大量数据</strong>，而<strong>不会占用过多的内存</strong>。也就是说，Stream（流）允许以流的形式处理数据，而不是一次性将数据全部加载到内存中。</p>
<p><img src="/blog2025.github.io/stream-nodejs.png" alt="img"></p>
<p>Stream 有四种流类型：</p>
<ul>
<li><strong>Readable</strong> - 可读操作。</li>
<li><strong>Writable</strong> - 可写操作。</li>
<li><strong>Duplex</strong> - 可读可写操作.</li>
<li><strong>Transform</strong> - 操作被写入数据，然后读出结果。</li>
</ul>
<p>所有的 Stream 对象都是 EventEmitter 的实例。常用的事件有：</p>
<ul>
<li><strong>data</strong> - 当有数据可读时触发。</li>
<li><strong>end</strong> - 没有更多的数据可读时触发。</li>
<li><strong>error</strong> - 在接收和写入过程中发生错误时触发。</li>
<li><strong>finish</strong> - 所有数据已被写入到底层系统时触发。</li>
</ul>
<h3 id="从流中读取数据"><a href="#从流中读取数据" class="headerlink" title="从流中读取数据"></a>从流中读取数据</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> data = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建可读流</span></span><br><span class="line"><span class="keyword">var</span> readerStream = fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;input.txt&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置编码为 utf8。</span></span><br><span class="line">readerStream.<span class="title function_">setEncoding</span>(<span class="string">&#x27;UTF8&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理流事件 --&gt; data, end, and error</span></span><br><span class="line">readerStream.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>,<span class="keyword">function</span>(<span class="params">chunk</span>)&#123;</span><br><span class="line">    data += chunk;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">readerStream.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">readerStream.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>,<span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">stack</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;程序执行完毕&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">readerStream.on(&#x27;data&#x27;,(chunk)=&gt;&#123;</span></span><br><span class="line"><span class="comment">    data += chunk;</span></span><br><span class="line"><span class="comment">&#125;);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">readerStream.on(&#x27;end&#x27;,()=&gt;&#123;</span></span><br><span class="line"><span class="comment">    console.log(data);</span></span><br><span class="line"><span class="comment">&#125;);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">readerStream.on(&#x27;error&#x27;,(err)=&gt;&#123;</span></span><br><span class="line"><span class="comment">    console.log(err.stack);</span></span><br><span class="line"><span class="comment">&#125;)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>可读流的暂停和恢复</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> data = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="comment">// 创建可读流</span></span><br><span class="line"><span class="keyword">var</span> readerStream = fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;input.txt&#x27;</span>,<span class="string">&#x27;UTF8&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理流事件 --&gt; data, end, and error</span></span><br><span class="line">readerStream.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>,<span class="keyword">function</span>(<span class="params">chunk</span>)&#123;</span><br><span class="line">    readerStream.<span class="title function_">pause</span>();<span class="comment">//暂停读取</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        readerStream.<span class="title function_">resume</span>();<span class="comment">//恢复读取</span></span><br><span class="line">        data += chunk;</span><br><span class="line">    &#125;,<span class="number">3000</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">readerStream.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>销毁流</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> data = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="comment">// 创建可读流</span></span><br><span class="line"><span class="keyword">var</span> readerStream = fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;input.txt&#x27;</span>,<span class="string">&#x27;UTF8&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理流事件</span></span><br><span class="line">readerStream.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>,<span class="function">(<span class="params">chunk</span>)=&gt;</span>&#123;</span><br><span class="line">    readerStream.<span class="title function_">destroy</span>()<span class="comment">//销毁流</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="写数据到流"><a href="#写数据到流" class="headerlink" title="写数据到流"></a>写数据到流</h3><p>此代码会覆盖原文件中的内容：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;input.txt&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">flags</span>: <span class="string">&#x27;w&#x27;</span> <span class="comment">// 默认标志为 &#x27;w&#x27;，即覆盖写入</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> data = <span class="string">&#x27;流的写入测试&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个可以写入的流，写入到文件 output.txt 中</span></span><br><span class="line"><span class="keyword">var</span> writerStream = fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;input.txt&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置编码为 utf8。</span></span><br><span class="line">writerStream.<span class="title function_">write</span>(data,<span class="string">&#x27;UTF8&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 标记文件末尾</span></span><br><span class="line">writerStream.<span class="title function_">end</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理流事件 --&gt; finish、error</span></span><br><span class="line">writerStream.<span class="title function_">on</span>(<span class="string">&#x27;finish&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;写入完成。&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">writerStream.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">stack</span>);</span><br><span class="line"> &#125;);</span><br><span class="line"> </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;程序执行完毕&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>如果不需要覆盖，需要在<code>createWriteStream</code>中另外添加 <code>flags=&#39;a&#39;</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> writerStream = fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;input.txt&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">flags</span>: <span class="string">&#x27;a&#x27;</span> <span class="comment">// 追加模式，保留原内容并在末尾写入新数据</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> data = <span class="string">&#x27;流的写入测试&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个可以写入的流，写入到文件 output.txt 中</span></span><br><span class="line"><span class="keyword">var</span> writerStream = fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;input.txt&#x27;</span>,&#123;<span class="attr">flags</span>:<span class="string">&#x27;a&#x27;</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置编码为 utf8。</span></span><br><span class="line">writerStream.<span class="title function_">write</span>(data,<span class="string">&#x27;UTF8&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 标记文件末尾</span></span><br><span class="line">writerStream.<span class="title function_">end</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理流事件 --&gt; finish、error</span></span><br><span class="line">writerStream.<span class="title function_">on</span>(<span class="string">&#x27;finish&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;写入完成。&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">writerStream.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="keyword">function</span>(<span class="params">err</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">stack</span>);</span><br><span class="line"> &#125;);</span><br><span class="line"> </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;程序执行完毕&quot;</span>);</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>标志</th>
<th>行为</th>
</tr>
</thead>
<tbody><tr>
<td><code>&#39;w&#39;</code></td>
<td>覆盖写入（默认）</td>
</tr>
<tr>
<td><code>&#39;a&#39;</code></td>
<td>追加写入（保留原内容，新数据写入到文件末尾）</td>
</tr>
<tr>
<td><code>&#39;wx&#39;</code></td>
<td>排他写入（仅在文件不存在时创建并写入，否则失败）</td>
</tr>
<tr>
<td><code>&#39;r+&#39;</code></td>
<td>读写模式（文件必须存在，从头部开始覆盖写入，不截断文件）</td>
</tr>
</tbody></table>
<h3 id="双工流（Duplex）"><a href="#双工流（Duplex）" class="headerlink" title="双工流（Duplex）"></a>双工流（Duplex）</h3><p>可读可写</p>
<p>应用场景：</p>
<ul>
<li>‌<strong>网络通信</strong>‌：如 <code>net.Socket</code> 对象，同时处理客户端请求（读）和响应（写）；</li>
<li>‌<strong>数据转换中间件</strong>‌：例如加密&#x2F;解密、压缩&#x2F;解压等需要双向处理的场景；</li>
<li>‌<strong>代理服务器</strong>‌：转发请求（读）并修改响应（写）的中间层。</li>
</ul>
<p>TCP 套接字：</p>
<p>可通过 <code>net</code> 模块实现双向数据流的读写。以下是具体实现步骤及核心代码逻辑：</p>
<p>‌<strong>1. 搭建 TCP 服务器</strong>‌</p>
<p>通过 <code>net.createServer</code> 创建服务器，监听客户端连接并处理双向数据流：</p>
<p><strong>server.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">&#x27;net&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 TCP 服务器</span></span><br><span class="line"><span class="keyword">const</span> server = net.<span class="title function_">createServer</span>(<span class="function">(<span class="params">socket</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;客户端已连接&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 接收客户端数据（读操作）</span></span><br><span class="line">  socket.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`收到客户端数据: <span class="subst">$&#123;data&#125;</span>`</span>);</span><br><span class="line">    <span class="comment">// 向客户端发送响应（写操作）</span></span><br><span class="line">    socket.<span class="title function_">write</span>(<span class="string">`服务器回应: <span class="subst">$&#123;data&#125;</span>`</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 客户端断开连接处理</span></span><br><span class="line">  socket.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;客户端断开连接&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 错误处理</span></span><br><span class="line">  socket.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;套接字错误:&#x27;</span>, err);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务器运行在 8000 端口&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>2. 创建 TCP 客户端</strong>‌</p>
<p>客户端通过 <code>net.connect</code> 连接服务器，实现主动发送数据和接收响应：</p>
<p><strong>client.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">&#x27;net&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 连接服务器</span></span><br><span class="line"><span class="keyword">const</span> client = net.<span class="title function_">connect</span>(&#123; <span class="attr">port</span>: <span class="number">8000</span> &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;已连接到服务器&#x27;</span>);</span><br><span class="line">  <span class="comment">// 发送数据（写操作）</span></span><br><span class="line">  client.<span class="title function_">write</span>(<span class="string">&#x27;Hello Server!&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收服务器响应（读操作）</span></span><br><span class="line">client.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`收到服务器响应: <span class="subst">$&#123;data&#125;</span>`</span>);</span><br><span class="line">  <span class="comment">// 关闭连接</span></span><br><span class="line">  client.<span class="title function_">end</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 连接关闭处理</span></span><br><span class="line">client.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;与服务器断开连接&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误处理</span></span><br><span class="line">client.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;客户端错误:&#x27;</span>, err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>运行</strong></p>
<ul>
<li><p>启动服务器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node server.js</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动客户端</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node client.js</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>多次发送消息直至退出</strong>：</p>
<p><strong>server.js</strong></p>
<p><img src="/blog2025.github.io/image-20250502114217591.png" alt="image-20250502114217591"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">&#x27;net&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 TCP 服务器</span></span><br><span class="line"><span class="keyword">const</span> server = net.<span class="title function_">createServer</span>(<span class="function">(<span class="params">socket</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;客户端已连接&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 监听客户端发送的数据</span></span><br><span class="line">  socket.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> clientMessage = data.<span class="title function_">toString</span>().<span class="title function_">trim</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`收到客户端消息: <span class="subst">$&#123;clientMessage&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 向客户端发送响应（双工写操作）</span></span><br><span class="line">    socket.<span class="title function_">write</span>(<span class="string">`服务器已收到: &quot;<span class="subst">$&#123;clientMessage&#125;</span>&quot;\n`</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 监听客户端断开连接</span></span><br><span class="line">  socket.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;客户端已断开连接&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 错误处理</span></span><br><span class="line">  socket.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;服务器端错误:&#x27;</span>, err.<span class="property">message</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听 8000 端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">8000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务器已启动，监听端口 8000&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>client.js</strong></p>
<p><img src="/blog2025.github.io/image-20250502114129955.png" alt="image-20250502114129955"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">&#x27;net&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> readline = <span class="built_in">require</span>(<span class="string">&#x27;readline&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 连接服务器</span></span><br><span class="line"><span class="keyword">const</span> client = net.<span class="title function_">connect</span>(&#123; <span class="attr">port</span>: <span class="number">8000</span> &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;已连接到服务器&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建命令行交互接口</span></span><br><span class="line"><span class="keyword">const</span> rl = readline.<span class="title function_">createInterface</span>(&#123;</span><br><span class="line">  <span class="attr">input</span>: process.<span class="property">stdin</span>,</span><br><span class="line">  <span class="attr">output</span>: process.<span class="property">stdout</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 持续监听输入</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">askQuestion</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    rl.<span class="title function_">question</span>(<span class="string">&#x27;请输入消息（输入 exit 退出）: &#x27;</span>, <span class="function">(<span class="params">message</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (message.<span class="title function_">toLowerCase</span>() === <span class="string">&#x27;exit&#x27;</span>) &#123;</span><br><span class="line">        client.<span class="title function_">end</span>();</span><br><span class="line">        rl.<span class="title function_">close</span>();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      client.<span class="title function_">write</span>(message);</span><br><span class="line">      <span class="title function_">askQuestion</span>(); <span class="comment">// 递归调用，持续输入</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收服务器响应（双工读操作）</span></span><br><span class="line">client.<span class="title function_">on</span>(<span class="string">&#x27;connect&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">askQuestion</span>(); <span class="comment">// 连接成功后启动输入循环</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听连接关闭</span></span><br><span class="line">client.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;连接已关闭&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误处理</span></span><br><span class="line">client.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;客户端错误:&#x27;</span>, err.<span class="property">message</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="转换流（Transform）"><a href="#转换流（Transform）" class="headerlink" title="转换流（Transform）"></a>转换流（Transform）</h3><p>转换流是一种特殊的双工流，可以修改或转换数据。常见的转换流包括压缩和解压缩流。</p>
<ul>
<li>使用 <code>zlib.createGzip()</code> 生成压缩流；</li>
<li>使用 <code>zlib.createGunzip()</code> 解压数据流</li>
</ul>
<p>如将<strong>input.txt</strong>压缩为<strong>input.txt.gz</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> zlib = <span class="built_in">require</span>(<span class="string">&#x27;zlib&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个可读流</span></span><br><span class="line"><span class="keyword">const</span> readableStream = fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;input.txt&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个转换流（压缩）</span></span><br><span class="line"><span class="keyword">const</span> gzip = zlib.<span class="title function_">createGzip</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个可写流</span></span><br><span class="line"><span class="keyword">const</span> writableStream = fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;input.txt.gz&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将可读流管道到转换流，再管道到可写流</span></span><br><span class="line">readableStream.<span class="title function_">pipe</span>(gzip).<span class="title function_">pipe</span>(writableStream);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听完成事件</span></span><br><span class="line">writableStream.<span class="title function_">on</span>(<span class="string">&#x27;finish&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;文件压缩成功！&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>解压缩：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> zlib = <span class="built_in">require</span>(<span class="string">&#x27;zlib&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个可读流（读取.gz文件）</span></span><br><span class="line"><span class="keyword">const</span> readableStream = fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;input.txt.gz&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建解压转换流</span></span><br><span class="line"><span class="keyword">const</span> gzip = zlib.<span class="title function_">createGunzip</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个可写流（输出解压后的文件）</span></span><br><span class="line"><span class="keyword">const</span> writableStream = fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;input副本.txt&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将可读流管道到转换流，再管道到可写流（管道连接）</span></span><br><span class="line">readableStream.<span class="title function_">pipe</span>(gzip).<span class="title function_">pipe</span>(writableStream);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听完成事件</span></span><br><span class="line">writableStream.<span class="title function_">on</span>(<span class="string">&#x27;finish&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;文件压缩成功！&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误处理（重要！）</span></span><br><span class="line">readableStream.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;读取失败:&#x27;</span>, err));</span><br><span class="line">gzip.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;解压失败:&#x27;</span>, err));</span><br><span class="line">writableStream.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;写入失败:&#x27;</span>, err));</span><br></pre></td></tr></table></figure>

<h3 id="管道流：（pipe）"><a href="#管道流：（pipe）" class="headerlink" title="管道流：（pipe）"></a>管道流：（pipe）</h3><p>管道提供了一个输出流到输入流的机制。</p>
<p>从一个流中获取数据并将数据传递到另外一个流中。</p>
<p>应用：</p>
<ul>
<li><strong>大文件处理</strong>：提供了压缩和解压数据。</li>
<li><strong>实时流处理</strong>：日志、多媒体编码</li>
<li>‌<strong>协议转换</strong>：CSV 表格转换为 JSON</li>
</ul>
<p>将数据从一个文件<strong>input.txt</strong>写到另一个文件<strong>output.txt</strong>中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个可读流</span></span><br><span class="line"><span class="keyword">var</span> readerStream = fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;input.txt&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个可写流</span></span><br><span class="line"><span class="keyword">var</span> writerStream = fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;output.txt&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 管道读写操作</span></span><br><span class="line"><span class="comment">// 读取 input.txt 文件内容，并将内容写入到 output.txt 文件中</span></span><br><span class="line">readerStream.<span class="title function_">pipe</span>(writerStream);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;程序执行完毕&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="链式流"><a href="#链式流" class="headerlink" title="链式流"></a>链式流</h3><p>链式是通过连接输出流到另外一个流并创建多个流操作链的机制。</p>
<p>链式流一般用于管道操作。</p>
<p>链式流通过 ‌<strong>模块化处理单元串联</strong>‌ 实现高效数据流转与任务协作，比如说解压缩：</p>
<p><strong>压缩</strong>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> zlib = <span class="built_in">require</span>(<span class="string">&#x27;zlib&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩 input.txt 文件为 input.txt.gz</span></span><br><span class="line">fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;input.txt&#x27;</span>)</span><br><span class="line">  .<span class="title function_">pipe</span>(zlib.<span class="title function_">createGzip</span>())</span><br><span class="line">  .<span class="title function_">pipe</span>(fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;input.txt.gz&#x27;</span>));</span><br><span class="line">  </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;文件压缩完成。&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>解压</strong>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> zlib = <span class="built_in">require</span>(<span class="string">&#x27;zlib&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解压 input.txt.gz 文件为 input.txt</span></span><br><span class="line">fs.<span class="title function_">createReadStream</span>(<span class="string">&#x27;input.txt.gz&#x27;</span>)</span><br><span class="line">  .<span class="title function_">pipe</span>(zlib.<span class="title function_">createGunzip</span>())</span><br><span class="line">  .<span class="title function_">pipe</span>(fs.<span class="title function_">createWriteStream</span>(<span class="string">&#x27;input.txt&#x27;</span>));</span><br><span class="line">  </span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;文件解压完成。&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="‌转换流、管道流、链式流的关系"><a href="#‌转换流、管道流、链式流的关系" class="headerlink" title="‌转换流、管道流、链式流的关系"></a>‌<strong>转换流、管道流、链式流的关系</strong></h3><p>这三者在数据流处理中扮演不同角色，但通过 ‌<strong>协作模式</strong>‌ 共同实现高效、灵活的数据处理流程。以下是它们的核心关系与区别：</p>
<p> <strong>核心定义与功能</strong>‌</p>
<table>
<thead>
<tr>
<th>‌<strong>概念</strong>‌</th>
<th>‌<strong>定义</strong>‌</th>
<th>‌<strong>典型实现</strong>‌</th>
</tr>
</thead>
<tbody><tr>
<td>‌<strong>转换流</strong>‌</td>
<td>继承自 <code>Transform</code> 类的流，‌<strong>处理并修改数据</strong>‌（如压缩、加密、格式转换）</td>
<td>Node.js 的 <code>zlib.createGzip()</code></td>
</tr>
<tr>
<td>‌<strong>管道流</strong>‌</td>
<td>通过 <code>.pipe()</code> 方法‌<strong>连接多个流</strong>‌，形成单向数据通道</td>
<td><code>readable.pipe(transform).pipe(writable)</code></td>
</tr>
<tr>
<td>‌<strong>链式流</strong>‌</td>
<td>通过‌<strong>连续方法调用</strong>‌（如 <code>.pipe()</code> 链式操作）将多个处理单元串联成完整流水线</td>
<td>压缩+加密+传输的链式调用</td>
</tr>
</tbody></table>
<p><strong>协作关系与层级</strong>‌</p>
<ul>
<li><p>‌<strong>依赖关系</strong>‌：</p>
<ul>
<li>‌<strong>链式流</strong>‌ 是目标（构建完整处理流程）；</li>
<li>‌<strong>管道流</strong>‌ 是实现链式流的核心方法（通过 <code>.pipe()</code> 串联流）；</li>
<li>‌<strong>转换流</strong>‌ 是链式流中的关键处理节点（修改或增强数据）。</li>
</ul>
</li>
<li><p>‌<strong>数据流转图示</strong>‌：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">plaintextCopy Code输入流 (Readable) </span><br><span class="line">  → [转换流1: 压缩] </span><br><span class="line">  → [转换流2: 加密] </span><br><span class="line">  → 输出流 (Writable)</span><br></pre></td></tr></table></figure>

<p>通过 <code>.pipe()</code> 连接各环节，形成链式流。</p>
</li>
</ul>
<p><strong>关键区别与协作优势</strong>‌</p>
<table>
<thead>
<tr>
<th>‌<strong>维度</strong>‌</th>
<th>‌<strong>转换流</strong>‌</th>
<th>‌<strong>管道流</strong>‌</th>
<th>‌<strong>链式流</strong>‌</th>
</tr>
</thead>
<tbody><tr>
<td>‌<strong>核心目的</strong>‌</td>
<td>修改数据内容</td>
<td>连接数据流</td>
<td>组织完整处理流程</td>
</tr>
<tr>
<td>‌<strong>代码体现</strong>‌</td>
<td>实现 <code>_transform()</code> 方法</td>
<td>调用 <code>.pipe()</code> 方法</td>
<td>多个 <code>.pipe()</code> 链式调用</td>
</tr>
<tr>
<td>‌<strong>资源消耗</strong>‌</td>
<td>可能占用 CPU（如加密）</td>
<td>仅管理流连接，低开销</td>
<td>整体流程的资源协同优化</td>
</tr>
</tbody></table>
<h2 id="模块系统"><a href="#模块系统" class="headerlink" title="模块系统"></a>模块系统</h2><h3 id="模块类型："><a href="#模块类型：" class="headerlink" title="模块类型："></a>模块类型：</h3><ul>
<li><strong>内置模块</strong>：Node.js 自带的模块，如 <code>fs</code>、<code>http</code>、<code>path</code> 等。</li>
<li><strong>用户自定义模块</strong>：由开发者创建的模块。</li>
<li><strong>第三方模块</strong>：通过 npm 安装的模块，如 <code>express</code>、<code>lodash</code> 等。</li>
</ul>
<h3 id="导入内置模块："><a href="#导入内置模块：" class="headerlink" title="导入内置模块："></a>导入内置模块：</h3><p>使用<code>require(&#39;&#39;)</code>函数传入模块名称</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入文件系统模块</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入路径模块</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导入 HTTP 模块</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="导入第三方模块"><a href="#导入第三方模块" class="headerlink" title="导入第三方模块:"></a>导入第三方模块:</h3><p>先使用 npm 安装到项目中，再使用。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express</span><br></pre></td></tr></table></figure>

<p>第三方模块安装后，这些模块会被放置在项目的 node_modules 目录下。</p>
<p>自动生成：</p>
<ul>
<li>node_modules </li>
<li><code>package.json</code></li>
<li><code>package-lock.json</code></li>
</ul>
<p>要导入一个第三方模块，同样使用 <code>require()</code> 函数，但传入的是模块的名称。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入第三方模块 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="自定义模块导出与导入（CommonJS-模块）"><a href="#自定义模块导出与导入（CommonJS-模块）" class="headerlink" title="自定义模块导出与导入（CommonJS 模块）"></a>自定义模块导出与导入（CommonJS 模块）</h3><p>CommonJS 是 Node.js 中的默认模块系统，用于打包和管理 JavaScript 代码。</p>
<p>每个文件都被视为一个独立的模块，通过 <em>require</em> 函数加载其他模块，并通过 <em>module.exports</em> 或 <em>exports</em> 对象导出模块内容。</p>
<ul>
<li><p>**导出模块：**使用 <strong>module.exports</strong> 或 <strong>exports</strong> 将函数、对象或变量导出。<font color="red"><strong>两者不建议一同使用。</strong></font></p>
<ul>
<li><code>module.exports</code> 是导出对象的真正引用。（<strong>暴露对象</strong>）</li>
<li><code>exports</code> 是 <code>module.exports</code> 的快捷方式。不能直接赋值 <code>exports = ...</code>，否则会断开引用。（<strong>暴露属性和方法</strong>）</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exports</span> = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;; ❌ 无效导出</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;; ✅ 正确</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">PI</span> = <span class="number">3.14</span>; <span class="comment">// 正确写法</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>**导入模块：**使用 <strong>require()</strong> 导入模块。</p>
<p><strong>main.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hello = <span class="built_in">require</span>(<span class="string">&#x27;./hello&#x27;</span>);</span><br><span class="line">hello.<span class="title function_">world</span>();</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">在 main.js 中通过 require(&#x27;./hello&#x27;) 加载这个模块，然后就可以直接访问 hello.js 中 exports 对象的成员函数了。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//代码 require(&#x27;./hello&#x27;) 引入了当前目录下的 hello.js 文件</span></span><br></pre></td></tr></table></figure>

<p><strong>hello.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">world</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Hello World&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//hello.js 通过 exports 对象把 world 作为模块的访问接口</span></span><br></pre></td></tr></table></figure>

<p>或者：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">world</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*箭头函数</span></span><br><span class="line"><span class="comment">module.exports = &#123;</span></span><br><span class="line"><span class="comment">    world()&#123;</span></span><br><span class="line"><span class="comment">        console.log(&quot;hello&quot;);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*分开定义后导出</span></span><br><span class="line"><span class="comment">function sayHello() &#123;</span></span><br><span class="line"><span class="comment">  console.log(&quot;hello&quot;);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">module.exports = &#123;</span></span><br><span class="line"><span class="comment">  world: sayHello</span></span><br><span class="line"><span class="comment">&#125;;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="自定义模块导出与导入（ES-模块）"><a href="#自定义模块导出与导入（ES-模块）" class="headerlink" title="自定义模块导出与导入（ES 模块）"></a>自定义模块导出与导入（ES 模块）</h3><p>ES 模块使用 <strong>import</strong> 和 <strong>export</strong>，是现代 JavaScript 的模块规范。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// math.js（ES 模块）</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a, b</span>) &#123; <span class="keyword">return</span> a + b; &#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">PI</span> = <span class="number">3.14</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.js（ES 模块）</span></span><br><span class="line"><span class="keyword">import</span> &#123; add, <span class="variable constant_">PI</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./math.js&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">add</span>(<span class="number">2</span>, <span class="number">3</span>)); <span class="comment">// 5</span></span><br></pre></td></tr></table></figure>

<p>（需在 <code>package.json</code> 中设置 <code>&quot;type&quot;: &quot;module&quot;</code>）：否则会报错：</p>
<p><img src="/blog2025.github.io/image-20250502131217439.png" alt="image-20250502131217439"></p>
<p><code>package.json</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my-project&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;module&quot;</span><span class="punctuation">,</span>   <span class="comment">// 🚨 关键配置项</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node app.js&quot;</span>	<span class="comment">//启动入口</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// 你的依赖项...</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="加载模块的路径解析"><a href="#加载模块的路径解析" class="headerlink" title="加载模块的路径解析"></a>加载模块的路径解析</h3><p>**1、核心模块：**如 http 和 fs，在 Node.js 安装时就包含，可以直接加载。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>**2、本地文件模块：**使用相对路径或绝对路径加载，需指定 <strong>.&#x2F;</strong> 或 <strong>&#x2F;</strong>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myModule = <span class="built_in">require</span>(<span class="string">&#x27;./myModule&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>**3、第三方模块：**位于 <strong>node_modules</strong> 目录中，只需输入模块名称即可加载。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="模块缓存"><a href="#模块缓存" class="headerlink" title="模块缓存"></a>模块缓存</h3><p>**模块缓存机制：**Node.js 会将已加载的模块缓存起来，以提高性能。再次 <code>require()</code> 同一模块时，直接返回缓存中的模块，而不是重新加载。</p>
<p>**刷新缓存：**要重新加载模块，可以删除缓存：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="built_in">require</span>.<span class="property">cache</span>[<span class="built_in">require</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;./myModule&#x27;</span>)];</span><br></pre></td></tr></table></figure>

<h3 id="服务端的模块"><a href="#服务端的模块" class="headerlink" title="服务端的模块"></a><a target="_blank" rel="noopener" href="https://www.runoob.com/nodejs/nodejs-module-system.html">服务端的模块</a></h3><h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>Node.js 继承了 JavaScript 的所有函数特性，并在其异步编程模型中发挥了重要作用。</p>
<h3 id="函数声明"><a href="#函数声明" class="headerlink" title="函数声明"></a>函数声明</h3><p>使用 <strong>function</strong> 关键字声明一个函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">greet</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hello, <span class="subst">$&#123;name&#125;</span>!`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="函数表达式"><a href="#函数表达式" class="headerlink" title="函数表达式"></a>函数表达式</h3><p>将函数赋值给一个变量。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> greet = <span class="keyword">function</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hello, <span class="subst">$&#123;name&#125;</span>!`</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h3><p>ES6 引入的简洁函数表达式。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">greet</span> = (<span class="params">name</span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hello, <span class="subst">$&#123;name&#125;</span>!`</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 单行箭头函数</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">greet</span> = name =&gt; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hello, <span class="subst">$&#123;name&#125;</span>!`</span>);</span><br></pre></td></tr></table></figure>

<h3 id="函数的类型"><a href="#函数的类型" class="headerlink" title="函数的类型"></a>函数的类型</h3><ul>
<li><p><strong>普通函数</strong></p>
<p>最常见的函数形式，可以有参数和返回值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>匿名函数</strong></p>
<p>没有名字的函数，通常作为参数传递给其他函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;这是一个匿名函数。&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>回调函数</strong></p>
<p>作为参数传递给另一个函数，并在某个操作完成后被调用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> data = <span class="string">&#x27;Some data&#x27;</span>;</span><br><span class="line">        <span class="title function_">callback</span>(data);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fetchData</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="异步函数"><a href="#异步函数" class="headerlink" title="异步函数"></a>异步函数</h3><p>使用 async 和 await 关键字处理异步操作。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">fetchUser</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`https://api.example.com/users/<span class="subst">$&#123;id&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">const</span> user = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error fetching user:&#x27;</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fetchUser</span>(<span class="number">1</span>).<span class="title function_">then</span>(<span class="function"><span class="params">user</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(user));</span><br></pre></td></tr></table></figure>

<h3 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h3><ul>
<li><p><strong>闭包</strong></p>
<p>闭包是指一个函数能够记住并访问其词法作用域，即使这个函数在其词法作用域之外也能执行。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createCounter</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        count++;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> counter = <span class="title function_">createCounter</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">counter</span>()); <span class="comment">// 1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">counter</span>()); <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>高阶函数</strong></p>
<p>接受函数作为参数或返回函数的函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">applyOperation</span>(<span class="params">a, b, operation</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">operation</span>(a, b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sum = <span class="title function_">applyOperation</span>(<span class="number">5</span>, <span class="number">3</span>, <span class="function">(<span class="params">x, y</span>) =&gt;</span> x + y);</span><br><span class="line"><span class="keyword">const</span> product = <span class="title function_">applyOperation</span>(<span class="number">5</span>, <span class="number">3</span>, <span class="function">(<span class="params">x, y</span>) =&gt;</span> x * y);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sum); <span class="comment">// 8</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(product); <span class="comment">// 15</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="默认参数"><a href="#默认参数" class="headerlink" title="默认参数"></a>默认参数</h3><p>在函数声明时为参数提供默认值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">greet</span>(<span class="params">name = <span class="string">&#x27;Guest&#x27;</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hello, <span class="subst">$&#123;name&#125;</span>!`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">greet</span>(); <span class="comment">// Hello, Guest!</span></span><br><span class="line"><span class="title function_">greet</span>(<span class="string">&#x27;Alice&#x27;</span>); <span class="comment">// Hello, Alice!</span></span><br></pre></td></tr></table></figure>

<h3 id="Rest-剩余参数-…值"><a href="#Rest-剩余参数-…值" class="headerlink" title="Rest 剩余参数[…值]"></a>Rest 剩余参数[…值]</h3><p>允许将不定数量的参数表示为一个数组。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">...numbers</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> numbers.<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, num</span>) =&gt;</span> acc + num, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)); <span class="comment">// 10</span></span><br></pre></td></tr></table></figure>

<h3 id="解构参数"><a href="#解构参数" class="headerlink" title="解构参数"></a>解构参数</h3><p>从对象或数组中<strong>提取数据</strong>并将其赋值给变量。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getUserInfo</span>(<span class="params">&#123; name, age &#125;</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Name: <span class="subst">$&#123;name&#125;</span>, Age: <span class="subst">$&#123;age&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = &#123; <span class="attr">name</span>: <span class="string">&#x27;Alice&#x27;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;;</span><br><span class="line"><span class="title function_">getUserInfo</span>(user); <span class="comment">// Name: Alice, Age: 30</span></span><br></pre></td></tr></table></figure>

<h3 id="函数推荐写法："><a href="#函数推荐写法：" class="headerlink" title="函数推荐写法："></a>函数推荐写法：</h3><ul>
<li>**函数单一职责：**每个函数应该只做一件事，这样更容易测试和维护。</li>
<li>**避免全局变量：**尽量减少全局变量的使用，使用局部变量和函数参数。</li>
<li>**使用箭头函数：**箭头函数简洁明了，特别是在处理回调函数时。</li>
<li><strong>错误处理：</strong> 使用 try…catch 语句处理可能抛出的错误。</li>
<li><strong>函数作为参数:</strong> 函数作为一个参数来使用。</li>
</ul>
<h2 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h2><p>路由是处理 HTTP 请求的关键部分，它决定了如何根据不同的 URL 和 HTTP 方法（如 GET、POST、PUT、DELETE 等）来分发请求。</p>
<p>路由通常用于构建 Web 应用程序，特别是 RESTful API。</p>
<p>Node.js 本身并<strong>没有</strong>内置的路由机制，但可以通过中间件库（如 <strong>Express</strong>）来实现。</p>
<p>路由通常涉及以下几个方面：</p>
<ul>
<li><strong>URL 匹配</strong>：根据请求的 URL 来匹配路由规则。</li>
<li><strong>HTTP 方法匹配</strong>：根据请求的 HTTP 方法（GET、POST、PUT、DELETE 等）来匹配路由规则。</li>
<li><strong>请求处理</strong>：一旦匹配到合适的路由规则，就调用相应的处理函数来处理请求。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建服务器并定义路由</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; url, method &#125; = req;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (url === <span class="string">&#x27;/&#x27;</span> &amp;&amp; method === <span class="string">&#x27;GET&#x27;</span>) &#123;</span><br><span class="line">    res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/plain&#x27;</span> &#125;);</span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&#x27;Home Page&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (url === <span class="string">&#x27;/about&#x27;</span> &amp;&amp; method === <span class="string">&#x27;GET&#x27;</span>) &#123;</span><br><span class="line">    res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/plain&#x27;</span> &#125;);</span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&#x27;About Page&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.<span class="title function_">writeHead</span>(<span class="number">404</span>, &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/plain&#x27;</span> &#125;);</span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&#x27;404 Not Found&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务器运行在 http://localhost:3000&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="请求参数"><a href="#请求参数" class="headerlink" title="请求参数"></a>请求参数</h3><p>一个完整 URL 的 <strong><code>http://localhost:8888/start?foo=bar&amp;hello=world</code></strong> 包含主机、路径和查询字符串。</p>
<p>为了解析这些数据，我们可以使用 <strong>URL</strong> 对象和 <strong>querystring</strong> 模块。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myUrl = <span class="keyword">new</span> <span class="title function_">URL</span>(<span class="string">&quot;http://localhost:8888/start?foo=bar&amp;hello=world&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 提取路径名</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(myUrl.<span class="property">pathname</span>); <span class="comment">// 输出: /start</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 提取查询参数</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(myUrl.<span class="property">searchParams</span>.<span class="title function_">get</span>(<span class="string">&quot;foo&quot;</span>));   <span class="comment">// 输出: bar</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(myUrl.<span class="property">searchParams</span>.<span class="title function_">get</span>(<span class="string">&quot;hello&quot;</span>)); <span class="comment">// 输出: world</span></span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">myUrl.pathname</span><br><span class="line">          |</span><br><span class="line">          |</span><br><span class="line">        -----</span><br><span class="line">http://localhost:8888/start?foo=bar&amp;hello=world</span><br><span class="line">                                ---       -----</span><br><span class="line">                                 |          |</span><br><span class="line">                                 |          |</span><br><span class="line">           myUrl.searchParams.get(&quot;foo&quot;)    |</span><br><span class="line">                                            |</span><br><span class="line">                                     myUrl.searchParams.get(&quot;hello&quot;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>完善的服务请求</strong>：</p>
<p><strong>server.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>); <span class="comment">// 引入 Node.js 的 http 模块，用于创建服务器</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="variable constant_">URL</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>); <span class="comment">// 从 url 模块引入 URL 构造函数</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义并导出 start 函数，用于启动服务器</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">start</span>(<span class="params">route</span>) &#123;</span><br><span class="line">  <span class="comment">// 定义 onRequest 函数，处理每个请求</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">onRequest</span>(<span class="params">request, response</span>) &#123;</span><br><span class="line">    <span class="comment">// 使用 URL 构造函数解析请求路径</span></span><br><span class="line">    <span class="keyword">const</span> pathname = <span class="keyword">new</span> <span class="title function_">URL</span>(request.<span class="property">url</span>, <span class="string">`http://<span class="subst">$&#123;request.headers.host&#125;</span>`</span>).<span class="property">pathname</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Request for <span class="subst">$&#123;pathname&#125;</span> received.`</span>); <span class="comment">// 打印请求路径</span></span><br><span class="line"> </span><br><span class="line">    <span class="title function_">route</span>(pathname); <span class="comment">// 调用路由函数处理路径</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 设置响应头和响应内容</span></span><br><span class="line">    response.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123; <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;text/plain&quot;</span> &#125;);</span><br><span class="line">    response.<span class="title function_">write</span>(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">    response.<span class="title function_">end</span>();</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 创建服务器并监听指定端口</span></span><br><span class="line">  http.<span class="title function_">createServer</span>(onRequest).<span class="title function_">listen</span>(<span class="number">8888</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Server has started.&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 导出 start 函数供其他模块使用</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">start</span> = start;</span><br></pre></td></tr></table></figure>

<p><strong>router.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">route</span>(<span class="params">pathname</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;About to route a request for &quot;</span> + pathname);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 导出了 route 函数</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">route</span> = route;</span><br></pre></td></tr></table></figure>

<p><strong>index.js</strong>（入口文件—启动）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> server = <span class="built_in">require</span>(<span class="string">&quot;./server&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> router = <span class="built_in">require</span>(<span class="string">&quot;./router&quot;</span>);</span><br><span class="line"> </span><br><span class="line">server.<span class="title function_">start</span>(router.<span class="property">route</span>);</span><br></pre></td></tr></table></figure>

<p>启动：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node index.js</span><br></pre></td></tr></table></figure>

<p>访问<a target="_blank" rel="noopener" href="http://localhost:8888/">http://localhost:8888/</a></p>
<p><img src="/blog2025.github.io/image-20250502134436168.png" alt="image-20250502134436168"></p>
<p>访问<a target="_blank" rel="noopener" href="http://localhost:8888/home/user/id">http://localhost:8888/home/user/id</a></p>
<p><img src="/blog2025.github.io/image-20250502134531496.png" alt="image-20250502134531496"></p>
<p>页面都是</p>
<p><img src="/blog2025.github.io/image-20250502134614395.png" alt="image-20250502134614395"></p>
<h3 id="Express-路由"><a href="#Express-路由" class="headerlink" title="Express 路由"></a>Express 路由</h3><p><strong>安装 Express：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express</span><br></pre></td></tr></table></figure>

<p><strong>基本路由：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个 GET 路由</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;Hello, World!&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个 POST 路由</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/submit&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;Form submitted!&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动服务器</span></span><br><span class="line">app.<span class="title function_">listen</span>(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Server is running on http://localhost:<span class="subst">$&#123;port&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>动态路由：</strong></p>
<p>动态路由允许你使用参数化的 URL。</p>
<p>例如，你可以定义一个路由来处理 <strong>&#x2F;users&#x2F;:id</strong>，其中 <strong>:id</strong> 是一个动态参数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/users/:id&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> userId = req.<span class="property">params</span>.<span class="property">id</span>;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">`User ID: <span class="subst">$&#123;userId&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>路由参数：</strong></p>
<p>Express 允许你从 URL 中提取参数，并通过 req.params 对象访问这些参数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/users/:id&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> userId = req.<span class="property">params</span>.<span class="property">id</span>;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">`User ID: <span class="subst">$&#123;userId&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/search/:query&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> query = req.<span class="property">params</span>.<span class="property">query</span>;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">`Search query: <span class="subst">$&#123;query&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>查询参数</strong>：</p>
<p>查询参数是 URL 中的键值对，通常用于传递额外的信息。你可以通过 req.query 对象访问查询参数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/users/:id&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> userId = req.<span class="property">params</span>.<span class="property">id</span>;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">`User ID: <span class="subst">$&#123;userId&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/search/:query&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> query = req.<span class="property">params</span>.<span class="property">query</span>;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">`Search query: <span class="subst">$&#123;query&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>路由中间件：</strong></p>
<p>路由中间件是在处理请求之前或之后执行的函数。你可以使用中间件来处理诸如身份验证、日志记录等任务。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 日志记录中间件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">logger</span> = (<span class="params">req, res, next</span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Request Type: <span class="subst">$&#123;req.method&#125;</span> <span class="subst">$&#123;req.url&#125;</span>`</span>);</span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(logger);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;Hello, World!&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>路由分组：</strong></p>
<p>为了更好地组织代码，你可以使用路由分组。Express 提供了 express.Router 对象，可以用来创建模块化的、可挂载的路由处理程序。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个路由器实例</span></span><br><span class="line"><span class="keyword">const</span> userRouter = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义用户相关的路由</span></span><br><span class="line">userRouter.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;List of users&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">userRouter.<span class="title function_">get</span>(<span class="string">&#x27;/:id&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> userId = req.<span class="property">params</span>.<span class="property">id</span>;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">`User ID: <span class="subst">$&#123;userId&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 挂载用户路由器</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/users&#x27;</span>, userRouter);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动服务器</span></span><br><span class="line">app.<span class="title function_">listen</span>(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Server is running on http://localhost:<span class="subst">$&#123;port&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>高级路由技巧：</strong></p>
<ul>
<li><p><strong>错误处理：</strong> 你可以定义错误处理中间件来捕获和处理路由中的错误。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(err.<span class="property">stack</span>);</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;Something broke!&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>**路由优先级：**路由的定义顺序决定了它们的优先级，先定义的路由会先被匹配。</p>
</li>
<li><p><strong>路由限制：</strong> 你可以使用中间件来限制某些路由的访问，例如仅允许认证用户访问。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">authMiddleware</span> = (<span class="params">req, res, next</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">headers</span>.<span class="property">authorization</span>) &#123;</span><br><span class="line">        <span class="title function_">next</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">401</span>).<span class="title function_">send</span>(<span class="string">&#x27;Unauthorized&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/admin&#x27;</span>, authMiddleware, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&#x27;Admin page&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="全局对象"><a href="#全局对象" class="headerlink" title="全局对象"></a>全局对象</h2><p>全局对象的所有属性都可以在程序的任何地方访问。</p>
<ul>
<li><p>浏览器 JavaScript— window 是全局对象</p>
</li>
<li><p>Node.js — global 是全局对象</p>
<p>所有全局变量（除了 global 本身以外）都是 global 对象的属性。</p>
</li>
</ul>
<h3 id="全局对象与全局变量："><a href="#全局对象与全局变量：" class="headerlink" title="全局对象与全局变量："></a>全局对象与全局变量：</h3><p>global 最根本的作用是作为全局变量的宿主。按照 ES 的定义，满足以下条 件的变量是全局变量：</p>
<ul>
<li>在最外层定义的变量；</li>
<li>全局对象的属性；</li>
<li>隐式定义的变量（未定义直接赋值的变量）。</li>
</ul>
<p><strong>注意：</strong> 最好不要使用 var 定义变量以避免引入全局变量，因为全局变量会污染命名空间，提高代码的耦合风险。</p>
<ul>
<li><p><strong>__filename</strong></p>
<p>表示当前正在执行的脚本的<strong>文件名</strong>。它将输出文件所在位置的<strong>绝对路径</strong>，且和命令行参数所指定的文件名不一定相同。 如果在模块中，返回的值是模块文件的路径。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(__filename)</span><br></pre></td></tr></table></figure>

<p><img src="/blog2025.github.io/image-20250502135806178.png" alt="image-20250502135806178"></p>
</li>
<li><p><strong>__dirname</strong></p>
<p>表示当前执行脚本所在的<strong>目录</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(__dirname)</span><br></pre></td></tr></table></figure>

<p><img src="/blog2025.github.io/image-20250502135924044.png" alt="image-20250502135924044"></p>
</li>
<li><p><strong>setTimeout(cb, ms)</strong></p>
<p>在指定的毫秒(ms)数后执行指定函数(cb)。</p>
<p><strong>只执行一次指定函数。</strong></p>
<p>返回一个代表定时器的句柄值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">printHello</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;Hello, World!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 两秒后执行以上函数</span></span><br><span class="line"><span class="built_in">setTimeout</span>(printHello, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>clearTimeout(t)</strong></p>
<p>用于停止一个之前通过 setTimeout() 创建的定时器。 参数 <strong>t</strong> 是通过 setTimeout() 函数创建的定时器。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">printHello</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;Hello, World!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 两秒后执行以上函数</span></span><br><span class="line"><span class="keyword">var</span> t = <span class="built_in">setTimeout</span>(printHello, <span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 清除定时器</span></span><br><span class="line"><span class="built_in">clearTimeout</span>(t);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>setInterval(cb, ms)</strong></p>
<p>在指定的毫秒(ms)数后执行指定函数(cb)。</p>
<p>返回一个代表定时器的句柄值。可以使用 <strong>clearInterval(t)</strong> 函数来清除定时器。</p>
<p>setInterval() 方法会<strong>不停地调用函数</strong>，直到 clearInterval() 被调用或窗口被关闭。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">printHello</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>( <span class="string">&quot;Hello, World!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 两秒后执行以上函数</span></span><br><span class="line"><span class="built_in">setInterval</span>(printHello, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>console</strong></p>
<table>
<thead>
<tr>
<th>**方法 **</th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>console.log(data)</strong></td>
<td>向标准输出流打印字符并以换行符结束。该方法接收若干 个参数，如果只有一个参数，则输出这个参数的字符串形式。如果有多个参数，则 以类似于C 语言 printf() 命令的格式输出。</td>
</tr>
<tr>
<td><strong>console.info(data)</strong></td>
<td>该命令的作用是返回信息性消息，这个命令与console.log差别并不大，除了在chrome中只会输出文字外，其余的会显示一个蓝色的惊叹号。</td>
</tr>
<tr>
<td><strong>console.error(data)</strong></td>
<td>输出错误消息的。控制台在出现错误时会显示是红色的叉子。</td>
</tr>
<tr>
<td><strong>console.warn(data)</strong></td>
<td>输出警告消息。控制台出现有黄色的惊叹号。</td>
</tr>
<tr>
<td><strong>console.dir(obj[, options])</strong></td>
<td>用来对一个对象进行检查（inspect），并以易于阅读和打印的格式显示。</td>
</tr>
<tr>
<td><strong>console.time(label)</strong></td>
<td>输出时间，表示计时开始。</td>
</tr>
<tr>
<td><strong>console.timeEnd(label)</strong></td>
<td>结束时间，表示计时结束。</td>
</tr>
<tr>
<td><strong>console.trace(message[, …])</strong></td>
<td>当前执行的代码在堆栈中的调用路径，这个测试函数运行很有帮助，只要给想测试的函数里面加入 console.trace 就行了。</td>
</tr>
<tr>
<td><strong>console.assert(value, message)</strong></td>
<td>用于判断某个表达式或变量是否为真，接收两个参数，第一个参数是表达式，第二个参数是字符串。只有当第一个参数为false，才会输出第二个参数，否则不会有任何结果。</td>
</tr>
</tbody></table>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.runoob.com/nodejs/nodejs-global-object.html"><strong>process</strong></a></p>
<p>它用于描述当前Node.js 进程状态的对象，提供了一个与操作系统的简单接口。</p>
<table>
<thead>
<tr>
<th><strong>事件</strong></th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>exit</strong></td>
<td>当进程准备退出时触发。</td>
</tr>
<tr>
<td><strong>beforeExit</strong></td>
<td>当 node 清空事件循环，并且没有其他安排时触发这个事件。通常来说，当没有进程安排时 node 退出，但是 ‘beforeExit’ 的监听器可以异步调用，这样 node 就会继续执行。</td>
</tr>
<tr>
<td><strong>uncaughtException</strong></td>
<td>当一个异常冒泡回到事件循环，触发这个事件。如果给异常添加了监视器，默认的操作（打印堆栈跟踪信息并退出）就不会发生。</td>
</tr>
<tr>
<td><strong>Signal 事件</strong></td>
<td>当进程接收到信号时就触发。信号列表详见标准的 POSIX 信号名，如 SIGINT、SIGUSR1 等。</td>
</tr>
</tbody></table>
<p>……</p>
</li>
</ul>
<h2 id="常用工具（util）"><a href="#常用工具（util）" class="headerlink" title="常用工具（util）"></a>常用工具（util）</h2><p><strong>util</strong></p>
<ul>
<li>实用工具函数，用于支持 JavaScript 编程中的调试、错误处理、格式化等功能。</li>
<li>常用函数的集合，用于弥补核心 JavaScript 的功能过于精简的不足。</li>
<li>涵盖了从对象检查、继承到格式化字符串等多个方面。</li>
</ul>
<h3 id="导入-util-模块"><a href="#导入-util-模块" class="headerlink" title="导入 util 模块"></a>导入 util 模块</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> util = <span class="built_in">require</span>(<span class="string">&#x27;util&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="util-方法"><a href="#util-方法" class="headerlink" title="util 方法"></a><a target="_blank" rel="noopener" href="https://www.runoob.com/nodejs/nodejs-util.html">util 方法</a></h3><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
<th>‌<strong>核心参数&#x2F;示例</strong></th>
<th><strong>备注</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>util.format(format, ...args)</code></td>
<td align="left">字符串格式化，支持 <code>%s</code>、<code>%d</code>、<code>%j</code> 占位符。</td>
<td><code>util.format(&#39;%s:%d&#39;, &#39;端口&#39;, 8080); // &#39;端口:8080&#39;</code> <code>参数过多时用空格拼接：util.format(1,2,3) → &#39;1 2 3&#39;</code></td>
<td>支持自动类型转换，默认空格分隔多余参数</td>
</tr>
<tr>
<td align="left"><code>util.inspect(object[, options])</code></td>
<td align="left">将对象转换为字符串，用于调试。</td>
<td><code>util.inspect(obj, &#123; colors: true, depth: 2 &#125;);</code> <code>colors</code> 启用颜色高亮，<code>depth</code> 控制递归层级</td>
<td>常用于日志打印或命令行输出</td>
</tr>
<tr>
<td align="left"><code>util.promisify(function)</code></td>
<td align="left">将回调风格的函数转换为返回 Promise 的函数。</td>
<td><code>const readFileAsync = util.promisify(fs.readFile);</code> <code>readFileAsync(&#39;file.txt&#39;).then(...)</code></td>
<td>需函数符合 Node.js 回调参数规范（<code>(err, data)</code>）</td>
</tr>
<tr>
<td align="left"><code>util.callbackify(fn)</code></td>
<td align="left">将返回 Promise 的函数转换为回调风格函数。</td>
<td><code>const callbackFn = util.callbackify(asyncFn);</code> <code>callbackFn((err, res) =&gt; &#123; ... &#125;)</code></td>
<td>错误处理通过 <code>err.reason</code> 获取 Promise 拒绝原因</td>
</tr>
<tr>
<td align="left"><code>util.inherits(constructor, superConstructor)</code></td>
<td align="left">让一个构造函数继承另一个构造函数的原型方法。</td>
<td><code>util.inherits(SubClass, BaseClass);</code> <code>SubClass 继承 BaseClass 的原型方法</code></td>
<td>ES6 推荐使用 <code>class</code> 和 <code>extends</code> 替代</td>
</tr>
<tr>
<td align="left"><code>util.deprecate(fn, message)</code></td>
<td align="left">标记函数为废弃，调用时会打印警告消息。</td>
<td><code>const deprecatedFn = util.deprecate(() =&gt; &#123;&#125;, &#39;此函数已废弃&#39;);</code></td>
<td>用于代码迁移兼容性处理</td>
</tr>
<tr>
<td align="left"><code>util.types</code></td>
<td align="left">包含多种类型检测方法的集合，例如 <code>isAnyArrayBuffer</code>、<code>isBigInt64Array</code>。</td>
<td><code>util.types.isDate(new Date()) → true</code> <code>util.types.isRegExp(/abc/) → true</code> <code>util.types.isPromise(promiseObj)</code></td>
<td>支持多种类型检测，如 <code>AsyncFunction</code>、<code>ArrayBuffer</code> 等</td>
</tr>
<tr>
<td align="left"><code>util.isDeepStrictEqual(val1, val2)</code></td>
<td align="left">判断两个值是否深度相等，类似于深度比较。</td>
<td><code>util.isDeepStrictEqual(&#123;a:1&#125;, &#123;a:1&#125;); // true</code></td>
<td>替代 <code>assert.deepStrictEqual()</code> 的场景</td>
</tr>
<tr>
<td align="left"><code>util.getSystemErrorName(err)</code></td>
<td align="left">根据错误码返回系统错误名称。</td>
<td></td>
<td></td>
</tr>
<tr>
<td align="left"><code>util.inspect.custom</code></td>
<td align="left">一个 Symbol，可以定义自定义的 <code>inspect</code> 行为，用于调试。</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="util-types-下的类型检测方法"><a href="#util-types-下的类型检测方法" class="headerlink" title="util.types 下的类型检测方法"></a>util.types 下的类型检测方法</h3><p>util.types 是一个包含许多类型检测方法的集合，扩展了 JavaScript 的 typeof 和 instanceof。</p>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>util.types.isAnyArrayBuffer(value)</code></td>
<td align="left">检查值是否为 <code>ArrayBuffer</code> 或 <code>SharedArrayBuffer</code>。</td>
</tr>
<tr>
<td align="left"><code>util.types.isArrayBuffer(value)</code></td>
<td align="left">检查值是否为 <code>ArrayBuffer</code>。</td>
</tr>
<tr>
<td align="left"><code>util.types.isAsyncFunction(value)</code></td>
<td align="left">检查值是否为异步函数。</td>
</tr>
<tr>
<td align="left"><code>util.types.isBigInt64Array(value)</code></td>
<td align="left">检查值是否为 <code>BigInt64Array</code>。</td>
</tr>
<tr>
<td align="left"><code>util.types.isBigUint64Array(value)</code></td>
<td align="left">检查值是否为 <code>BigUint64Array</code>。</td>
</tr>
<tr>
<td align="left"><code>util.types.isBooleanObject(value)</code></td>
<td align="left">检查值是否为布尔对象。</td>
</tr>
<tr>
<td align="left"><code>util.types.isDataView(value)</code></td>
<td align="left">检查值是否为 <code>DataView</code>。</td>
</tr>
<tr>
<td align="left"><code>util.types.isDate(value)</code></td>
<td align="left">检查值是否为 <code>Date</code>。</td>
</tr>
<tr>
<td align="left"><code>util.types.isGeneratorFunction(value)</code></td>
<td align="left">检查值是否为生成器函数。</td>
</tr>
<tr>
<td align="left"><code>util.types.isMap(value)</code></td>
<td align="left">检查值是否为 <code>Map</code>。</td>
</tr>
<tr>
<td align="left"><code>util.types.isSet(value)</code></td>
<td align="left">检查值是否为 <code>Set</code>。</td>
</tr>
<tr>
<td align="left"><code>util.types.isRegExp(value)</code></td>
<td align="left">检查值是否为正则表达式。</td>
</tr>
<tr>
<td align="left"><code>util.types.isSymbolObject(value)</code></td>
<td align="left">检查值是否为符号对象。</td>
</tr>
</tbody></table>
<h2 id="文件系统（fs-模块）"><a href="#文件系统（fs-模块）" class="headerlink" title="文件系统（fs 模块）"></a><a target="_blank" rel="noopener" href="https://www.runoob.com/nodejs/nodejs-fs.html">文件系统（fs 模块）</a></h2><p>文件系统模块（fs 模块）提供了丰富的 API，用于读取、写入、删除文件以及执行其他文件系统操作。</p>
<p>fs 模块既支持同步方法也支持异步方法，使得开发者可以根据具体需求选择合适的方式来处理文件操作。</p>
<p><strong>导入 fs 模块</strong>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="异步和同步"><a href="#异步和同步" class="headerlink" title="异步和同步"></a>异步和同步</h3><p>Node.js 文件系统（fs 模块）模块中的方法均有异步和同步版本。</p>
<p>异步的方法函数最后一个参数为回调函数，回调函数的第一个参数包含了错误信息(error)。</p>
<h3 id="文件操作类-API‌"><a href="#文件操作类-API‌" class="headerlink" title="文件操作类 API‌"></a>文件操作类 API‌</h3><table>
<thead>
<tr>
<th>‌<strong>方法</strong>‌</th>
<th>‌<strong>功能描述</strong>‌</th>
<th>‌<strong>参数示例</strong>‌</th>
<th>‌<strong>同步版本</strong>‌</th>
</tr>
</thead>
<tbody><tr>
<td><code>fs.readFile()</code></td>
<td>异步读取文件内容</td>
<td><code>fs.readFile(&#39;file.txt&#39;, &#39;utf8&#39;, (err, data) =&gt; &#123; ... &#125;)</code></td>
<td><code>fs.readFileSync()</code></td>
</tr>
<tr>
<td><code>fs.writeFile()</code></td>
<td>异步写入文件（覆盖原内容）</td>
<td><code>fs.writeFile(&#39;log.txt&#39;, &#39;content&#39;, (err) =&gt; &#123; ... &#125;)</code></td>
<td><code>fs.writeFileSync()</code></td>
</tr>
<tr>
<td><code>fs.appendFile()</code></td>
<td>异步追加内容到文件末尾</td>
<td><code>fs.appendFile(&#39;log.txt&#39;, &#39;new data&#39;, (err) =&gt; &#123; ... &#125;)</code></td>
<td><code>fs.appendFileSync()</code></td>
</tr>
<tr>
<td><code>fs.copyFile()</code></td>
<td>异步复制文件</td>
<td><code>fs.copyFile(&#39;src.txt&#39;, &#39;dest.txt&#39;, (err) =&gt; &#123; ... &#125;)</code></td>
<td><code>fs.copyFileSync()</code></td>
</tr>
<tr>
<td><code>fs.rename()</code></td>
<td>异步重命名&#x2F;移动文件</td>
<td><code>fs.rename(&#39;old.txt&#39;, &#39;new.txt&#39;, (err) =&gt; &#123; ... &#125;)</code></td>
<td><code>fs.renameSync()</code></td>
</tr>
<tr>
<td><code>fs.unlink()</code></td>
<td>异步删除文件</td>
<td><code>fs.unlink(&#39;file.txt&#39;, (err) =&gt; &#123; ... &#125;)</code></td>
<td><code>fs.unlinkSync()</code></td>
</tr>
<tr>
<td><code>fs.open</code></td>
<td>打开文件</td>
<td><code>fs.open(&#39;file.txt&#39;, &#39;r&#39;, (err, fd) =&gt; &#123; ... &#125;)</code></td>
<td><code>fs.openSync()</code></td>
</tr>
<tr>
<td><code>fs.read()</code></td>
<td>读取文件内容</td>
<td><code>fs.read(fd, buffer, offset, length, position, callback);</code></td>
<td><code>fs.readSync()</code></td>
</tr>
<tr>
<td><code>fs.write()</code></td>
<td>写入文件内容</td>
<td><code>fs.write(fd, buffer[, offset[, length[, position]]], callback);</code><br/><code>fs.write(fd, string[, position[, encoding]], callback);</code></td>
<td><code>fs.writeSync()</code></td>
</tr>
<tr>
<td><code>fs.close()</code></td>
<td>关闭文件描述符</td>
<td><code>fs.close(fd, callback);</code></td>
<td><code>fs.closeSync()</code></td>
</tr>
</tbody></table>
<hr>
<h3 id="‌目录操作类-API‌"><a href="#‌目录操作类-API‌" class="headerlink" title="‌目录操作类 API‌"></a>‌目录操作类 API‌</h3><table>
<thead>
<tr>
<th>‌<strong>方法</strong>‌</th>
<th>‌<strong>功能描述</strong>‌</th>
<th>‌<strong>参数示例</strong>‌</th>
<th>‌<strong>同步版本</strong>‌</th>
</tr>
</thead>
<tbody><tr>
<td><code>fs.readdir()</code></td>
<td>异步读取目录内容列表</td>
<td><code>fs.readdir(&#39;./src&#39;, (err, files) =&gt; &#123; ... &#125;)</code></td>
<td><code>fs.readdirSync()</code></td>
</tr>
<tr>
<td><code>fs.mkdir()</code></td>
<td>异步创建目录（支持递归创建）</td>
<td><code>fs.mkdir(&#39;newDir&#39;, &#123; recursive: true &#125;, (err) =&gt; &#123; ... &#125;)</code></td>
<td><code>fs.mkdirSync()</code></td>
</tr>
<tr>
<td><code>fs.rmdir()</code></td>
<td>异步删除空目录</td>
<td><code>fs.rmdir(&#39;emptyDir&#39;, (err) =&gt; &#123; ... &#125;)</code></td>
<td><code>fs.rmdirSync()</code></td>
</tr>
<tr>
<td><code>fs.rm()</code></td>
<td>异步递归删除目录及内容（Node.js 14.14+）</td>
<td><code>fs.rm(&#39;dir&#39;, &#123; recursive: true &#125;, (err) =&gt; &#123; ... &#125;)</code></td>
<td><code>fs.rmSync()</code></td>
</tr>
</tbody></table>
<h3 id="文件信息与权限‌"><a href="#文件信息与权限‌" class="headerlink" title="文件信息与权限‌"></a>文件信息与权限‌</h3><table>
<thead>
<tr>
<th>‌<strong>方法</strong>‌</th>
<th>‌<strong>功能描述</strong>‌</th>
<th>‌<strong>参数示例</strong>‌</th>
<th>‌<strong>同步版本</strong>‌</th>
</tr>
</thead>
<tbody><tr>
<td><code>fs.stat()</code></td>
<td>异步获取文件&#x2F;目录元信息（大小、创建时间、权限等）</td>
<td><code>fs.stat(&#39;file.txt&#39;, (err, stats) =&gt; &#123; ... &#125;)</code></td>
<td><code>fs.statSync()</code></td>
</tr>
<tr>
<td><code>fs.access()</code></td>
<td>异步检查文件&#x2F;目录权限（可读、可写、可执行）</td>
<td><code>fs.access(&#39;file.txt&#39;, fs.constants.R_OK, (err) =&gt; &#123; ... &#125;)</code></td>
<td><code>fs.accessSync()</code></td>
</tr>
<tr>
<td><code>fs.chmod()</code></td>
<td>异步修改文件&#x2F;目录权限</td>
<td><code>fs.chmod(&#39;file.txt&#39;, 0o755, (err) =&gt; &#123; ... &#125;)</code></td>
<td><code>fs.chmodSync()</code></td>
</tr>
<tr>
<td><code>fs.utimes()</code></td>
<td>异步修改文件访问时间和修改时间</td>
<td><code>fs.utimes(&#39;file.txt&#39;, new Date(), new Date(), (err) =&gt; &#123; ... &#125;)</code></td>
<td><code>fs.utimesSync()</code></td>
</tr>
</tbody></table>
<hr>
<h3 id="‌流式文件操作"><a href="#‌流式文件操作" class="headerlink" title="‌流式文件操作"></a>‌流式文件操作</h3><table>
<thead>
<tr>
<th>‌<strong>方法</strong>‌</th>
<th>‌<strong>功能描述</strong>‌</th>
<th>‌<strong>参数示例</strong>‌</th>
<th>‌<strong>适用场景</strong>‌</th>
</tr>
</thead>
<tbody><tr>
<td><code>fs.createReadStream()</code></td>
<td>创建可读流，分块读取大文件</td>
<td><code>fs.createReadStream(&#39;video.mp4&#39;).pipe(process.stdout)</code></td>
<td>视频&#x2F;日志流式处理</td>
</tr>
<tr>
<td><code>fs.createWriteStream()</code></td>
<td>创建可写流，分块写入文件</td>
<td><code>const ws = fs.createWriteStream(&#39;output.log&#39;); ws.write(&#39;data&#39;)</code></td>
<td>大文件写入或实时日志记录</td>
</tr>
</tbody></table>
<hr>
<h3 id="‌高级功能‌"><a href="#‌高级功能‌" class="headerlink" title="‌高级功能‌"></a>‌高级功能‌</h3><table>
<thead>
<tr>
<th>‌<strong>方法</strong>‌</th>
<th>‌<strong>功能描述</strong>‌</th>
<th>‌<strong>参数示例</strong>‌</th>
<th>‌<strong>同步版本</strong>‌</th>
</tr>
</thead>
<tbody><tr>
<td><code>fs.watch()</code></td>
<td>监听文件&#x2F;目录变化（跨平台兼容性有限）</td>
<td><code>fs.watch(&#39;dir&#39;, (event, filename) =&gt; &#123; ... &#125;)</code></td>
<td>-</td>
</tr>
<tr>
<td><code>fs.realpath()</code></td>
<td>异步解析文件绝对路径（含符号链接追踪）</td>
<td><code>fs.realpath(&#39;./symlink&#39;, (err, resolvedPath) =&gt; &#123; ... &#125;)</code></td>
<td><code>fs.realpathSync()</code></td>
</tr>
<tr>
<td><code>fs.truncate()</code></td>
<td>异步截断文件至指定长度（直接通过文件路径操作）</td>
<td><code>fs.truncate(&#39;file.txt&#39;, 100, (err) =&gt; &#123; ... &#125;)</code></td>
<td><code>fs.truncateSync()</code></td>
</tr>
<tr>
<td><code>fs.ftruncate()</code></td>
<td>截取文件（通过已打开的文件描述符操作）</td>
<td><code>fs.ftruncate(fd, len, callback)</code></td>
<td><code>fs.ftruncateSync()</code></td>
</tr>
</tbody></table>
<h2 id="Node-js应用"><a href="#Node-js应用" class="headerlink" title="Node.js应用"></a>Node.js应用</h2><h3 id="构建简单应用"><a href="#构建简单应用" class="headerlink" title="构建简单应用"></a>构建简单应用</h3><ul>
<li><p>创建项目文件夹 my-first-node-app</p>
</li>
<li><p>初始化项目：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init </span><br></pre></td></tr></table></figure>

<p>生成 package.json 文件，其包含项目的配置信息。</p>
<p>或者使用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></table></figure>

<p><code>-y</code> 参数的作用是跳过交互式问卷环节，自动接受所有默认配置选项并直接生成 package.json 文件。（系统会直接采用默认值填充项目名称、版本、描述等信息）</p>
<p><strong>package.json</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my-first-node-app&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;test&quot;</span><span class="punctuation">:</span> <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;keywords&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;license&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ISC&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>这里的<code>&quot;scripts&quot;: &#123;&quot;test&quot;：&quot;...&quot;,&quot;start&quot;: 后续需要修改为项目的入口文件&#125;</code></p>
<p>如：<code>&quot;scripts&quot;: &#123;&quot;test&quot;: &quot;test server&quot;, &quot;start&quot;: &quot;node server.js&quot;&#125;</code></p>
</li>
<li><p>创建入口文件：</p>
<p><strong>server.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建服务器</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 设置HTTP响应的状态码和头信息</span></span><br><span class="line">  res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="comment">// 设置内容类型为 HTML，并指定字符集为 UTF-8，这样中文不会乱码</span></span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html; charset=utf-8&#x27;</span> </span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 发送响应体</span></span><br><span class="line">  res.<span class="title function_">end</span>(<span class="string">&#x27;&lt;h1&gt;Hello, World!&lt;/h1&gt;&lt;p&gt;这是我的第一个 Node.js 应用。&lt;/p&gt;&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听端口</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="number">3000</span>;</span><br><span class="line">server.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`服务器运行在 http://localhost:<span class="subst">$&#123;PORT&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行服务器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure>

<p><img src="/blog2025.github.io/image-20250503092619234.png" alt="image-20250503092619234"></p>
<p><img src="/blog2025.github.io/image-20250503092710434.png" alt="image-20250503092710434"></p>
</li>
<li><p>更完善的写法—增加路由（解耦合）</p>
<p><strong>server.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">&#x27;./router&#x27;</span>); <span class="comment">// 导入路由模块</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 设置默认字符集（UTF-8保证中文不亂碼）</span></span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>,<span class="string">&#x27;text/html; charset=utf-8&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 将请求交给路由处理</span></span><br><span class="line">  router.<span class="title function_">handleRequests</span>(req, res);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="number">3000</span>;</span><br><span class="line">server.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`服务器已启动: http://localhost:<span class="subst">$&#123;PORT&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>router.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = &#123;</span><br><span class="line">  <span class="title function_">handleRequests</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; url &#125; = req;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 路由映射表</span></span><br><span class="line">    <span class="keyword">const</span> routes = &#123;</span><br><span class="line">      <span class="string">&#x27;/&#x27;</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html; charset=utf-8&#x27;</span> &#125;);</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">&#x27;&lt;h1&gt;你好世界！&lt;/h1&gt;&lt;p&gt;这是我的第一个 Node.js 应用。&lt;/p&gt;&#x27;</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&#x27;/about&#x27;</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/plain; charset=utf-8&#x27;</span> &#125;);</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">&#x27;关于我们&#x27;</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&#x27;404&#x27;</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        res.<span class="title function_">writeHead</span>(<span class="number">404</span>, &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/plain; charset=utf-8&#x27;</span> &#125;);</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">&#x27;404 页面不存在&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行匹配的路由处理函数，无匹配则返回404</span></span><br><span class="line">    (routes[url] || routes[<span class="string">&#x27;404&#x27;</span>])();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="GET-POST命令"><a href="#GET-POST命令" class="headerlink" title="GET&#x2F;POST命令"></a>GET&#x2F;POST命令</h3><h4 id="GET："><a href="#GET：" class="headerlink" title="GET："></a>GET：</h4><p>使用 url.parse 方法来解析 URL 中的参数</p>
<ul>
<li><p>获取 URL 的参数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="string">&#x27;GET&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> parsedUrl = url.<span class="title function_">parse</span>(req.<span class="property">url</span>, <span class="literal">true</span>); <span class="comment">// 解析路径和查询参数</span></span><br><span class="line">    <span class="keyword">const</span> &#123; pathname, query &#125; = parsedUrl;</span><br><span class="line"></span><br><span class="line">    res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/plain; charset=utf-8&#x27;</span> &#125;);</span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">`GET 路径：<span class="subst">$&#123;pathname&#125;</span>\n参数：<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(query)&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>

<p>访问<code>&quot;http://localhost:3000/api?name=张三&amp;age=20&quot;</code></p>
<p>输出：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET 路径：/api</span><br><span class="line">参数：<span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;张三&quot;</span><span class="punctuation">,</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="string">&quot;20&quot;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>url的属性和方法</p>
<table>
<thead>
<tr>
<th><strong>属性&#x2F;方法</strong>‌</th>
<th>‌<strong>功能描述</strong>‌</th>
<th>‌<strong>示例值&#x2F;说明</strong>‌</th>
</tr>
</thead>
<tbody><tr>
<td>‌<strong>href</strong></td>
<td>获取或设置完整 URL 字符串</td>
<td><code>&#39;https://www.example.com:8080/api?name=test#hash&#39;</code></td>
</tr>
<tr>
<td>‌<strong>origin</strong>‌</td>
<td>获取协议+主机名+端口的组合（只读属性）</td>
<td><code>&#39;https://www.example.com:8080&#39;</code></td>
</tr>
<tr>
<td>‌<strong>protocol</strong>‌</td>
<td>获取或设置协议部分（含冒号）</td>
<td><code>&#39;https:&#39;</code></td>
</tr>
<tr>
<td>‌<strong>hostname</strong>‌</td>
<td>获取或设置主机名（不含端口）</td>
<td><code>&#39;www.example.com&#39;</code></td>
</tr>
<tr>
<td>‌<strong>port</strong>‌</td>
<td>获取或设置端口号（空字符串表示默认端口）</td>
<td><code>&#39;8080&#39;</code></td>
</tr>
<tr>
<td>‌<strong>host</strong>‌</td>
<td>获取或设置完整主机（含端口）</td>
<td><code>&#39;www.example.com:8080&#39;</code></td>
</tr>
<tr>
<td>‌<strong>username</strong>‌</td>
<td>获取或设置认证用户名</td>
<td>若 URL 为 <code>http://user:pass@example.com</code>，则值为 <code>&#39;user&#39;</code></td>
</tr>
<tr>
<td>‌<strong>password</strong>‌</td>
<td>获取或设置认证密码</td>
<td>同上例中为 <code>&#39;pass&#39;</code></td>
</tr>
<tr>
<td>‌<strong>pathname</strong>‌</td>
<td>获取或设置路径部分（以 <code>/</code> 开头）</td>
<td><code>&#39;/api/data&#39;</code></td>
</tr>
<tr>
<td>‌<strong>search</strong>‌</td>
<td>获取或设置查询字符串（含 <code>?</code>）</td>
<td><code>&#39;?name=张三&amp;age=20&#39;</code></td>
</tr>
<tr>
<td>‌<strong>searchParams</strong>‌</td>
<td>获取 <code>URLSearchParams</code> 对象（用于操作查询参数）</td>
<td>支持 <code>get()</code>, <code>set()</code>, <code>append()</code> 等方法</td>
</tr>
<tr>
<td><strong>get(name)</strong></td>
<td>获取指定名称的查询参数值</td>
<td><code>myUrl.searchParams.get(&quot;name&quot;)</code></td>
</tr>
<tr>
<td><strong>set(name, value)</strong></td>
<td>设置查询字符串中指定名称的参数（若已存在则更新）</td>
<td><code>myUrl.searchParams.set(&quot;name&quot;, &quot;lisi&quot;)</code><br /><code>?name=lisi</code></td>
</tr>
<tr>
<td><strong>delete(name)</strong></td>
<td>删除指定名称的查询参数</td>
<td><code>myUrl.searchParams.delete(&quot;age&quot;)</code></td>
</tr>
<tr>
<td><strong>has(name)</strong></td>
<td>判断查询字符串中是否存在指定名称的参数</td>
<td><code>myUrl.searchParams.has(&quot;foo&quot;)</code>返回<code>true</code> 或 <code>false</code></td>
</tr>
<tr>
<td><strong>append(name, value)</strong></td>
<td>向查询字符串中追加新的参数</td>
<td><code>myUrl.searchParams.append(&quot;age&quot;, &quot;18&quot;)</code><br /><code>?name=zhangsan&amp;age=18</code></td>
</tr>
<tr>
<td>‌<strong>hash</strong>‌</td>
<td>获取或设置哈希值（含 <code>#</code>）</td>
<td><code>&#39;#section1&#39;</code></td>
</tr>
<tr>
<td>‌**toString()**‌</td>
<td>返回完整 URL 字符串（等效于 <code>href</code> 属性）</td>
<td><code>url.toString() → &#39;https://example.com/&#39;</code></td>
</tr>
<tr>
<td>‌**toJSON()**‌</td>
<td>序列化时自动调用 <code>toString()</code>（兼容 JSON 序列化需求）</td>
<td>调用 <code>JSON.stringify(url)</code> 时自动触发</td>
</tr>
</tbody></table>
<p><strong>关键功能演示代码：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="variable constant_">URL</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 URL 对象</span></span><br><span class="line"><span class="keyword">const</span> myUrl = <span class="keyword">new</span> <span class="title function_">URL</span>(<span class="string">&#x27;https://user:pass@example.com:8080/path?key=val#hash&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 操作属性示例</span></span><br><span class="line">myUrl.<span class="property">protocol</span> = <span class="string">&#x27;http:&#x27;</span>;  <span class="comment">// 修改协议为 HTTP</span></span><br><span class="line">myUrl.<span class="property">searchParams</span>.<span class="title function_">append</span>(<span class="string">&#x27;newParam&#x27;</span>, <span class="string">&#x27;123&#x27;</span>);  <span class="comment">// 添加查询参数</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(myUrl.<span class="property">href</span>);  </span><br><span class="line"><span class="comment">// 输出: http://user:pass@example.com:8080/path?key=val&amp;newParam=123#hash</span></span><br></pre></td></tr></table></figure>

<p><strong>注意事项：</strong></p>
<ul>
<li><p>‌<strong>构造 URL 对象</strong>‌<br>必须使用 <code>new URL(input[, base])</code> 语法，相对路径需指定 <code>base</code> 参数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> relativeUrl = <span class="keyword">new</span> <span class="title function_">URL</span>(<span class="string">&#x27;/api&#x27;</span>, <span class="string">&#x27;https://example.com&#x27;</span>); </span><br><span class="line"><span class="comment">// → https://example.com/api</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>‌<strong>编码处理</strong>‌<br>特殊字符需通过 <code>encodeURIComponent()</code> 处理，避免 URL 解析错误：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> safeParam = <span class="built_in">encodeURIComponent</span>(<span class="string">&#x27;特殊字符&amp;值&#x27;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>‌<strong>参数操作</strong>‌<br>通过 <code>searchParams</code> 方法链式操作查询参数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">myUrl.<span class="property">searchParams</span></span><br><span class="line">  .<span class="title function_">set</span>(<span class="string">&#x27;page&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">  .<span class="title function_">delete</span>(<span class="string">&#x27;oldKey&#x27;</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="POST："><a href="#POST：" class="headerlink" title="POST："></a>POST：</h4><p>需要监听并处理 <strong>request</strong> 对象的 <strong>data</strong> 和 <strong>end</strong> 事件。</p>
<ul>
<li><strong>监听 <code>data</code> 事件</strong>：当数据块到达服务器时，<code>data</code> 事件触发，数据块作为回调的参数传递。</li>
<li><strong>监听 <code>end</code> 事件</strong>：当整个请求体接收完毕时，<code>end</code> 事件触发，这时可以对完整的 POST 数据进行处理。</li>
</ul>
<p>‌<strong>原生模块处理代码</strong>‌</p>
<p><strong>1. 基础数据接收</strong>‌</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> body = [];</span><br><span class="line">    <span class="comment">// 监听 data 事件，逐块接收数据</span></span><br><span class="line">    req.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="params">chunk</span> =&gt;</span> body.<span class="title function_">push</span>(chunk));  <span class="comment">// 分块接收数据</span></span><br><span class="line">    <span class="comment">// 监听 end 事件，数据接收完毕</span></span><br><span class="line">    req.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      body = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>(body).<span class="title function_">toString</span>();</span><br><span class="line">      res.<span class="title function_">end</span>(<span class="string">`接收数据：<span class="subst">$&#123;body&#125;</span>`</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>检测请求方法</strong>：通过 <code>req.method === &#39;POST&#39;</code> 来判断请求类型是否为 POST。</li>
<li><strong>接收数据</strong>：在 <code>req.on(&#39;data&#39;)</code> 事件中累加数据块，形成完整的数据体。</li>
<li><strong>完成接收</strong>：在 <code>req.on(&#39;end&#39;)</code> 事件中处理完整的 POST 数据。</li>
<li><strong>响应客户端</strong>：完成数据接收和处理后，向客户端发送响应。</li>
</ul>
<p>测试：</p>
<p><img src="/blog2025.github.io/image-20250503112310095.png" alt="image-20250503112310095"></p>
<p>结果：</p>
<p><img src="/blog2025.github.io/image-20250503112331620.png" alt="image-20250503112331620"></p>
<p><strong>2‌. JSON 数据解析</strong>‌</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">req.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> jsonData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(body);  <span class="comment">// 直接解析 </span></span><br><span class="line">    res.<span class="title function_">end</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; <span class="attr">status</span>: <span class="string">&#x27;success&#x27;</span>, <span class="attr">data</span>: jsonData &#125;));</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    res.<span class="property">statusCode</span> = <span class="number">400</span>;</span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&#x27;Invalid JSON&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<p><img src="/blog2025.github.io/image-20250503113237340.png" alt="image-20250503113237340"></p>
<p>结果：</p>
<p><img src="/blog2025.github.io/image-20250503113257451.png" alt="image-20250503113257451"></p>
<p><strong>3. 表单</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">&#x27;querystring&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">method</span> === <span class="string">&#x27;POST&#x27;</span> &amp;&amp; req.<span class="property">url</span> === <span class="string">&#x27;/submit&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> body = [];</span><br><span class="line">    <span class="comment">// 分块接收数据:ml-citation&#123;ref=&quot;2,5&quot; data=&quot;citationList&quot;&#125;</span></span><br><span class="line">    req.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="params">chunk</span> =&gt;</span> body.<span class="title function_">push</span>(chunk))</span><br><span class="line">       .<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">         <span class="keyword">const</span> data = querystring.<span class="title function_">parse</span>(<span class="title class_">Buffer</span>.<span class="title function_">concat</span>(body).<span class="title function_">toString</span>());</span><br><span class="line">         <span class="keyword">if</span> (!data.<span class="property">username</span> || !data.<span class="property">password</span>) &#123;</span><br><span class="line">           res.<span class="title function_">writeHead</span>(<span class="number">400</span>, &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span> &#125;);</span><br><span class="line">           <span class="keyword">return</span> res.<span class="title function_">end</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; <span class="attr">error</span>: <span class="string">&#x27;参数缺失&#x27;</span> &#125;));</span><br><span class="line">         &#125;</span><br><span class="line">         res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span> &#125;);</span><br><span class="line">         res.<span class="title function_">end</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; <span class="attr">status</span>: <span class="string">&#x27;success&#x27;</span>, data &#125;));</span><br><span class="line">       &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.<span class="property">statusCode</span> = <span class="number">404</span>;</span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&#x27;Not Found&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;原生服务运行于 http://localhost:3000&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<p><img src="/blog2025.github.io/image-20250503120118983.png" alt="image-20250503120118983"></p>
<p><img src="/blog2025.github.io/image-20250503120134242.png" alt="image-20250503120134242"></p>
<p><img src="/blog2025.github.io/image-20250503120147672.png" alt="image-20250503120147672"></p>
<p>结果：</p>
<p><img src="/blog2025.github.io/image-20250503120203537.png" alt="image-20250503120203537"></p>
<h3 id="工具模块"><a href="#工具模块" class="headerlink" title="工具模块"></a><a target="_blank" rel="noopener" href="https://www.runoob.com/nodejs/nodejs-utitlity-module.html">工具模块</a></h3><table>
<thead>
<tr>
<th align="left">模块名</th>
<th align="left">描述</th>
<th>使用</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/nodejs/nodejs-os-module.html"><strong>OS 模块</strong></a></td>
<td align="left">提供基本的系统操作函数。</td>
<td><code>const os = require(&#39;os&#39;);</code><br/><code>console.log(os.cpus());</code> &#x2F;&#x2F; 查看 CPU 信息</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/nodejs/nodejs-path-module.html"><strong>Path 模块</strong></a></td>
<td align="left">提供了处理和转换文件路径的工具。</td>
<td><code>const path = require(&#39;path&#39;);</code><br/><code>const fullPath = path.join(__dirname, &#39;data&#39;, &#39;test.txt&#39;);</code></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/nodejs/nodejs-net-module.html"><strong>Net 模块</strong></a></td>
<td align="left">用于底层的网络通信。提供了服务端和客户端的的操作。</td>
<td></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/nodejs/nodejs-dns-module.html"><strong>DNS 模块</strong></a></td>
<td align="left">用于解析域名。</td>
<td></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/nodejs/nodejs-domain-module.html"><strong>Domain 模块</strong></a></td>
<td align="left">简化异步代码的异常处理，可以捕捉处理try catch无法捕捉的。</td>
<td></td>
</tr>
<tr>
<td align="left">‌<strong>Util 模块</strong></td>
<td align="left">提供类型检查、字符串格式化、回调转 Promise 等实用工具</td>
<td><code>const util = require(&#39;util&#39;);</code><br/><code>util.promisify(fs.readFile)(&#39;file.txt&#39;); // 回调转 Promise</code></td>
</tr>
<tr>
<td align="left">‌<strong>Querystring 模块</strong></td>
<td align="left">解析 URL 查询参数，支持对象与字符串互转</td>
<td><code>const qs = require(&#39;querystring&#39;);</code><br/><code>const params = qs.parse(&#39;name=Alice&amp;age=25&#39;);</code></td>
</tr>
</tbody></table>
<h3 id="Web-模块"><a href="#Web-模块" class="headerlink" title="Web 模块"></a>Web 模块</h3><p>Web服务器：一般指网站服务器，</p>
<p>Web服务器的基本功能：提供Web信息浏览服务。</p>
<p>Web 服务器都支持服务端的脚本语言（php、python、ruby）等，并通过脚本语言从数据库获取数据，将结果返回给客户端浏览器。</p>
<p>Web服务器最主流的是 Apache、Nginx、IIS。</p>
<p><img src="https://www.runoob.com/wp-content/uploads/2015/09/web_architecture.jpg" alt="img"></p>
<ul>
<li><strong>Client</strong> - 客户端，一般指浏览器，浏览器可以通过 HTTP 协议向服务器请求数据。</li>
<li><strong>Server</strong> - 服务端，一般指 Web 服务器，可以接收客户端请求，并向客户端发送响应数据。</li>
<li><strong>Business</strong> - 业务层， 通过 Web 服务器处理应用程序，如与数据库交互，逻辑运算，调用外部程序等。</li>
<li><strong>Data</strong> - 数据层，一般由数据库组成。</li>
</ul>
<h4 id="使用-Node-创建-Web-服务器"><a href="#使用-Node-创建-Web-服务器" class="headerlink" title="使用 Node 创建 Web 服务器"></a>使用 Node 创建 Web 服务器</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<p><strong>server.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">&#x27;url&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">// 创建服务器</span></span><br><span class="line">http.<span class="title function_">createServer</span>( <span class="keyword">function</span> (<span class="params">request, response</span>) &#123;  </span><br><span class="line">   <span class="comment">// 解析请求，包括文件名</span></span><br><span class="line">   <span class="keyword">var</span> pathname = url.<span class="title function_">parse</span>(request.<span class="property">url</span>).<span class="property">pathname</span>;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">// 输出请求的文件名</span></span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Request for &quot;</span> + pathname + <span class="string">&quot; received.&quot;</span>);</span><br><span class="line">   </span><br><span class="line">   <span class="comment">// 从文件系统中读取请求的文件内容</span></span><br><span class="line">   fs.<span class="title function_">readFile</span>(pathname.<span class="title function_">substr</span>(<span class="number">1</span>), <span class="keyword">function</span> (<span class="params">err, data</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">         <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">         <span class="comment">// HTTP 状态码: 404 : NOT FOUND</span></span><br><span class="line">         <span class="comment">// Content Type: text/html</span></span><br><span class="line">         response.<span class="title function_">writeHead</span>(<span class="number">404</span>, &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html&#x27;</span>&#125;);</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;             </span><br><span class="line">         <span class="comment">// HTTP 状态码: 200 : OK</span></span><br><span class="line">         <span class="comment">// Content Type: text/html</span></span><br><span class="line">         response.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html&#x27;</span>&#125;);    </span><br><span class="line">         </span><br><span class="line">         <span class="comment">// 响应文件内容</span></span><br><span class="line">         response.<span class="title function_">write</span>(data.<span class="title function_">toString</span>());        </span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//  发送响应数据</span></span><br><span class="line">      response.<span class="title function_">end</span>();</span><br><span class="line">   &#125;);   </span><br><span class="line">&#125;).<span class="title function_">listen</span>(<span class="number">8080</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 控制台会输出以下信息</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Server running at http://127.0.0.1:8080/&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>index.html</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>菜鸟教程(runoob.com)<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>我的第一个标题<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>我的第一个段落。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node server.js</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="/blog2025.github.io/image-20250503121623965.png" alt="image-20250503121623965"></p>
<h4 id="使用-Node-创建-Web-客户端"><a href="#使用-Node-创建-Web-客户端" class="headerlink" title="使用 Node 创建 Web 客户端"></a>使用 Node 创建 Web 客户端</h4><p>示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 用于请求的选项</span></span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">   <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">   <span class="attr">port</span>: <span class="string">&#x27;8080&#x27;</span>,</span><br><span class="line">   <span class="attr">path</span>: <span class="string">&#x27;/index.html&#x27;</span>  </span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 处理响应的回调函数</span></span><br><span class="line"><span class="keyword">var</span> callback = <span class="keyword">function</span>(<span class="params">response</span>)&#123;</span><br><span class="line">   <span class="comment">// 不断更新数据</span></span><br><span class="line">   <span class="keyword">var</span> body = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">   response.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">      body += data;</span><br><span class="line">   &#125;);</span><br><span class="line">   </span><br><span class="line">   response.<span class="title function_">on</span>(<span class="string">&#x27;end&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// 数据接收完成</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(body);</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 向服务端发送请求</span></span><br><span class="line"><span class="keyword">var</span> req = http.<span class="title function_">request</span>(options, callback);</span><br><span class="line">req.<span class="title function_">end</span>();</span><br></pre></td></tr></table></figure>

<p>执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node client.js</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="/blog2025.github.io/image-20250503121806344.png" alt="image-20250503121806344"></p>
<p><img src="/blog2025.github.io/image-20250503121827728.png" alt="image-20250503121827728"></p>
<h3 id="Express-框架"><a href="#Express-框架" class="headerlink" title="Express 框架"></a>Express 框架</h3><p>Express 是一个简洁而灵活的 node.js Web应用框架, 提供了一系列强大特性帮助你创建各种 Web 应用，和丰富的 HTTP 工具。</p>
<p>使用 Express 可以快速地搭建一个完整功能的网站。</p>
<p>Express 框架核心特性：</p>
<ul>
<li>可以设置<strong>中间件</strong>来响应 HTTP 请求。</li>
<li>定义了<strong>路由表</strong>用于执行不同的 HTTP 请求动作。</li>
<li>可以通过向模板传递参数来<strong>动态渲染</strong> HTML <strong>页面</strong>。</li>
</ul>
<h4 id="安装-Express"><a href="#安装-Express" class="headerlink" title="安装 Express"></a>安装 Express</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install express --save</span><br></pre></td></tr></table></figure>

<p>自动安装 Express 到自动生成的 node_modules 目录下。</p>
<p>还需安装几个重要框架搭配 express 使用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install body-parser --save</span><br><span class="line">npm install cookie-parser --save</span><br><span class="line">npm install multer --save</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>body-parser</strong> - node.js 中间件，用于处理 JSON, Raw, Text 和 URL 编码的数据。</li>
<li><strong>cookie-parser</strong> - 这就是一个解析Cookie的工具。通过req.cookies可以取到传过来的cookie，并把它们转成对象。</li>
<li><strong>multer</strong> - node.js 中间件，用于处理 enctype&#x3D;”multipart&#x2F;form-data”（设置表单的MIME编码）的表单数据。</li>
</ul>
<p><strong>package.json</strong></p>
<p><img src="/blog2025.github.io/image-20250503122544098.png" alt="image-20250503122544098"></p>
<h4 id="第一个示例"><a href="#第一个示例" class="headerlink" title="第一个示例"></a>第一个示例</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//express_demo.js 文件</span></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>();</span><br><span class="line"> </span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">   res.<span class="title function_">send</span>(<span class="string">&#x27;Hello World&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> server = app.<span class="title function_">listen</span>(<span class="number">8081</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">var</span> host = server.<span class="title function_">address</span>().<span class="property">address</span></span><br><span class="line">  <span class="keyword">var</span> port = server.<span class="title function_">address</span>().<span class="property">port</span></span><br><span class="line"> </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;应用实例，访问地址为 http://%s:%s&quot;</span>, host, port)</span><br><span class="line"> </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="/blog2025.github.io/image-20250503122747221.png" alt="image-20250503122747221"></p>
<h4 id="请求和响应"><a href="#请求和响应" class="headerlink" title="请求和响应"></a>请求和响应</h4><p>Express 使用回调函数的参数： <strong>request</strong> 和 <strong>response</strong> 对象来处理请求和响应的数据。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">   <span class="comment">// --</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>Request 对象</strong> - request 对象表示 HTTP 请求，包含了请求查询字符串，参数，内容，HTTP 头部等属性。常见属性有：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>req.app</strong></td>
<td>当callback为外部文件时，用req.app访问express的实例</td>
</tr>
<tr>
<td><strong>req.baseUrl</strong></td>
<td>获取路由当前安装的URL路径</td>
</tr>
<tr>
<td><strong>req.body &#x2F; req.cookies</strong></td>
<td>获得「请求主体」&#x2F; Cookies</td>
</tr>
<tr>
<td><strong>req.fresh &#x2F; req.stale</strong></td>
<td>判断请求是否还「新鲜」</td>
</tr>
<tr>
<td><strong>req.hostname &#x2F; req.ip</strong></td>
<td>获取主机名和IP地址</td>
</tr>
<tr>
<td><strong>req.originalUrl</strong></td>
<td>获取原始请求URL</td>
</tr>
<tr>
<td><strong>req.params</strong></td>
<td>获取路由的parameters</td>
</tr>
<tr>
<td><strong>req.path</strong></td>
<td>获取请求路径</td>
</tr>
<tr>
<td><strong>req.protocol</strong></td>
<td>获取协议类型</td>
</tr>
<tr>
<td><strong>req.query</strong></td>
<td>获取URL的查询参数串</td>
</tr>
<tr>
<td><strong>req.route</strong></td>
<td>获取当前匹配的路由</td>
</tr>
<tr>
<td><strong>req.subdomains</strong></td>
<td>获取子域名</td>
</tr>
<tr>
<td><strong>req.accepts()</strong></td>
<td>检查可接受的请求的文档类型</td>
</tr>
<tr>
<td><strong>req.acceptsCharsets &#x2F; req.acceptsEncodings &#x2F; req.acceptsLanguages</strong></td>
<td>返回指定字符集的第一个可接受字符编码</td>
</tr>
<tr>
<td><strong>req.get()</strong></td>
<td>获取指定的HTTP请求头</td>
</tr>
<tr>
<td><strong>req.is()</strong></td>
<td>判断请求头Content-Type的MIME类型</td>
</tr>
</tbody></table>
<p><strong>Response 对象</strong> - response 对象表示 HTTP 响应，即在接收到请求时向客户端发送的 HTTP 响应数据。常见属性有：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><strong>res.app</strong></td>
<td>当callback为外部文件时，用res.app访问express的实例</td>
</tr>
<tr>
<td><strong>res.append()</strong></td>
<td>追加指定HTTP头</td>
</tr>
<tr>
<td><strong>res.set()</strong></td>
<td>在res.append()后将重置之前设置的头</td>
</tr>
<tr>
<td><strong>res.cookie(name，value [，option])</strong></td>
<td>设置Cookie</td>
</tr>
<tr>
<td><strong>opition</strong></td>
<td>domain &#x2F; expires &#x2F; httpOnly &#x2F; maxAge &#x2F; path &#x2F; secure &#x2F; signed</td>
</tr>
<tr>
<td><strong>res.clearCookie()</strong></td>
<td>清除Cookie</td>
</tr>
<tr>
<td><strong>res.download()</strong></td>
<td>传送指定路径的文件</td>
</tr>
<tr>
<td><strong>res.get()</strong></td>
<td>返回指定的HTTP头</td>
</tr>
<tr>
<td><strong>res.json()</strong></td>
<td>传送JSON响应</td>
</tr>
<tr>
<td><strong>res.jsonp()</strong></td>
<td>传送JSONP响应</td>
</tr>
<tr>
<td><strong>res.location()</strong></td>
<td>只设置响应的Location HTTP头，不设置状态码或者close response</td>
</tr>
<tr>
<td><strong>res.redirect()</strong></td>
<td>设置响应的Location HTTP头，并且设置状态码302</td>
</tr>
<tr>
<td><strong>res.render(view,[locals],callback)</strong></td>
<td>渲染一个view，同时向callback传递渲染后的字符串，如果在渲染过程中有错误发生next(err)将会被自动调用。callback将会被传入一个可能发生的错误以及渲染后的页面，这样就不会自动输出了。</td>
</tr>
<tr>
<td><strong>res.send()</strong></td>
<td>传送HTTP响应</td>
</tr>
<tr>
<td><strong>res.sendFile(path [，options] [，fn])</strong></td>
<td>传送指定路径的文件 -会自动根据文件extension设定Content-Type</td>
</tr>
<tr>
<td><strong>res.set()</strong></td>
<td>设置HTTP头，传入object可以一次设置多个头</td>
</tr>
<tr>
<td><strong>res.status()</strong></td>
<td>设置HTTP状态码</td>
</tr>
<tr>
<td><strong>res.type()</strong></td>
<td>设置Content-Type的MIME类型</td>
</tr>
</tbody></table>
<h4 id="路由-1"><a href="#路由-1" class="headerlink" title="路由"></a>路由</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>();</span><br><span class="line"> </span><br><span class="line"><span class="comment">//  主页输出 &quot;Hello World&quot;</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;主页 GET 请求&quot;</span>);</span><br><span class="line">   res.<span class="title function_">send</span>(<span class="string">&#x27;Hello GET&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//  POST 请求</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;主页 POST 请求&quot;</span>);</span><br><span class="line">   res.<span class="title function_">send</span>(<span class="string">&#x27;Hello POST&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//  /del_user 页面响应</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/del_user&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;/del_user 响应 DELETE 请求&quot;</span>);</span><br><span class="line">   res.<span class="title function_">send</span>(<span class="string">&#x27;删除页面&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="comment">//  /list_user 页面 GET 请求</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/list_user&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;/list_user GET 请求&quot;</span>);</span><br><span class="line">   res.<span class="title function_">send</span>(<span class="string">&#x27;用户列表页面&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 对页面 abcd, abxcd, ab123cd, 等响应 GET 请求</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/ab*cd&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;   </span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;/ab*cd GET 请求&quot;</span>);</span><br><span class="line">   res.<span class="title function_">send</span>(<span class="string">&#x27;正则匹配&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> server = app.<span class="title function_">listen</span>(<span class="number">8081</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">var</span> host = server.<span class="title function_">address</span>().<span class="property">address</span></span><br><span class="line">  <span class="keyword">var</span> port = server.<span class="title function_">address</span>().<span class="property">port</span></span><br><span class="line"> </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;应用实例，访问地址为 http://%s:%s&quot;</span>, host, port)</span><br><span class="line"> </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="静态文件"><a href="#静态文件" class="headerlink" title="静态文件"></a>静态文件</h4><p>Express 提供了内置的中间件 <strong>express.static</strong> 来设置静态文件如：图片， CSS, JavaScript 等。</p>
<p>使用 <strong>express.static</strong> 中间件来设置静态文件路径。</p>
<p>例如，如果你将图片、CSS、 JavaScript 文件放在 <strong>public</strong> 目录下，调用方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/public&#x27;</span>, express.<span class="title function_">static</span>(<span class="string">&#x27;public&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p><img src="/blog2025.github.io/image-20250503123947310.png" alt="image-20250503123947310"></p>
<h4 id="GET-方法"><a href="#GET-方法" class="headerlink" title="GET 方法"></a>GET 方法</h4><p>示例：</p>
<p><strong>index.html</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/process_get&quot;</span> <span class="attr">method</span>=<span class="string">&quot;GET&quot;</span>&gt;</span></span><br><span class="line">First Name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;first_name&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">Last Name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;last_name&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>server.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/index.html&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">   res.<span class="title function_">sendFile</span>( __dirname + <span class="string">&quot;/&quot;</span> + <span class="string">&quot;index.html&quot;</span> );</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/process_get&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">// 输出 JSON 格式</span></span><br><span class="line">   <span class="keyword">var</span> response = &#123;</span><br><span class="line">       <span class="string">&quot;first_name&quot;</span>:req.<span class="property">query</span>.<span class="property">first_name</span>,</span><br><span class="line">       <span class="string">&quot;last_name&quot;</span>:req.<span class="property">query</span>.<span class="property">last_name</span></span><br><span class="line">   &#125;;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">   res.<span class="title function_">end</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(response));</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> server = app.<span class="title function_">listen</span>(<span class="number">8081</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">var</span> host = server.<span class="title function_">address</span>().<span class="property">address</span></span><br><span class="line">  <span class="keyword">var</span> port = server.<span class="title function_">address</span>().<span class="property">port</span></span><br><span class="line"> </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;应用实例，访问地址为 http://%s:%s&quot;</span>, host, port)</span><br><span class="line"> </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="/blog2025.github.io/image-20250503124347263.png" alt="image-20250503124347263"></p>
<p><img src="/blog2025.github.io/image-20250503124411249.png" alt="image-20250503124411249"></p>
<h4 id="POST-方法"><a href="#POST-方法" class="headerlink" title="POST 方法"></a>POST 方法</h4><p>示例：</p>
<p><strong>index.html</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://127.0.0.1:8081/process_post&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">First Name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;first_name&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">Last Name: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;last_name&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>server.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 创建 application/x-www-form-urlencoded 编码解析</span></span><br><span class="line"><span class="keyword">var</span> urlencodedParser = bodyParser.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;)</span><br><span class="line"> </span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/index.html&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">   res.<span class="title function_">sendFile</span>( __dirname + <span class="string">&quot;/&quot;</span> + <span class="string">&quot;index.html&quot;</span> );</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/process_post&#x27;</span>, urlencodedParser, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">// 输出 JSON 格式</span></span><br><span class="line">   <span class="keyword">var</span> response = &#123;</span><br><span class="line">       <span class="string">&quot;first_name&quot;</span>:req.<span class="property">body</span>.<span class="property">first_name</span>,</span><br><span class="line">       <span class="string">&quot;last_name&quot;</span>:req.<span class="property">body</span>.<span class="property">last_name</span></span><br><span class="line">   &#125;;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(response);</span><br><span class="line">   res.<span class="title function_">end</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(response));</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> server = app.<span class="title function_">listen</span>(<span class="number">8081</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">var</span> host = server.<span class="title function_">address</span>().<span class="property">address</span></span><br><span class="line">  <span class="keyword">var</span> port = server.<span class="title function_">address</span>().<span class="property">port</span></span><br><span class="line"> </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;应用实例，访问地址为 http://%s:%s&quot;</span>, host, port)</span><br><span class="line"> </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="/blog2025.github.io/image-20250503124916262.png" alt="image-20250503124916262"></p>
<p><img src="/blog2025.github.io/image-20250503124933080.png" alt="image-20250503124933080"></p>
<h4 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h4><p>示例：</p>
<p><strong>index.html</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>文件上传表单<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.error</span> &#123; <span class="attribute">color</span>: red; <span class="attribute">display</span>: none; &#125;  <span class="comment">/* 错误提示样式*/</span></span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>文件上传：<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;uploadForm&quot;</span> <span class="attr">action</span>=<span class="string">&quot;/file_upload&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span> <span class="attr">onsubmit</span>=<span class="string">&quot;return validateForm()&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            选择一个文件上传: <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;image&quot;</span> <span class="attr">id</span>=<span class="string">&quot;fileInput&quot;</span> <span class="attr">size</span>=<span class="string">&quot;50&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;errorMsg&quot;</span> <span class="attr">class</span>=<span class="string">&quot;error&quot;</span>&gt;</span>请先选择文件！<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传文件&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">validateForm</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> fileInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;fileInput&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> errorMsg = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;errorMsg&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (fileInput.<span class="property">files</span>.<span class="property">length</span> === <span class="number">0</span>) &#123;  <span class="comment">// 检查文件是否为空</span></span></span><br><span class="line"><span class="language-javascript">                errorMsg.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;inline&#x27;</span>;  <span class="comment">// 显示错误提示</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> <span class="literal">false</span>;  <span class="comment">// 阻止表单提交</span></span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> <span class="literal">true</span>;  <span class="comment">// 允许提交</span></span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 动态隐藏错误提示（当用户选择新文件时）</span></span></span><br><span class="line"><span class="language-javascript">     	<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;fileInput&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;change&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;errorMsg&#x27;</span>).<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;none&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>server.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> multer  = <span class="built_in">require</span>(<span class="string">&#x27;multer&#x27;</span>);</span><br><span class="line"> </span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">multer</span>(&#123; <span class="attr">dest</span>: <span class="string">&#x27;/tmp/&#x27;</span>&#125;).<span class="title function_">array</span>(<span class="string">&#x27;image&#x27;</span>));</span><br><span class="line"> </span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/index.html&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">   res.<span class="title function_">sendFile</span>( __dirname + <span class="string">&quot;/&quot;</span> + <span class="string">&quot;index.html&quot;</span> );</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/file_upload&#x27;</span>, <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line"> </span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">files</span>[<span class="number">0</span>]);  <span class="comment">// 上传的文件信息</span></span><br><span class="line"> </span><br><span class="line">   <span class="keyword">var</span> des_file = __dirname + <span class="string">&quot;/&quot;</span> + req.<span class="property">files</span>[<span class="number">0</span>].<span class="property">originalname</span>;</span><br><span class="line">   fs.<span class="title function_">readFile</span>( req.<span class="property">files</span>[<span class="number">0</span>].<span class="property">path</span>, <span class="keyword">function</span> (<span class="params">err, data</span>) &#123;</span><br><span class="line">        fs.<span class="title function_">writeFile</span>(des_file, data, <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">         <span class="keyword">if</span>( err )&#123;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>( err );</span><br><span class="line">         &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               response = &#123;</span><br><span class="line">                   <span class="attr">message</span>:<span class="string">&#x27;File uploaded successfully&#x27;</span>, </span><br><span class="line">                   <span class="attr">filename</span>:req.<span class="property">files</span>[<span class="number">0</span>].<span class="property">originalname</span></span><br><span class="line">              &#125;;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>( response );</span><br><span class="line">          res.<span class="title function_">end</span>( <span class="title class_">JSON</span>.<span class="title function_">stringify</span>( response ) );</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> server = app.<span class="title function_">listen</span>(<span class="number">8081</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">var</span> host = server.<span class="title function_">address</span>().<span class="property">address</span></span><br><span class="line">  <span class="keyword">var</span> port = server.<span class="title function_">address</span>().<span class="property">port</span></span><br><span class="line"> </span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;应用实例，访问地址为 http://%s:%s&quot;</span>, host, port)</span><br><span class="line"> </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="/blog2025.github.io/image-20250503125907472.png" alt="image-20250503125907472"></p>
<p><img src="/blog2025.github.io/image-20250503130001095.png" alt="image-20250503130001095"></p>
<p><img src="/blog2025.github.io/image-20250503130240872.png" alt="image-20250503130240872"></p>
<p><img src="/blog2025.github.io/image-20250503130021263.png" alt="image-20250503130021263"></p>
<h4 id="Cookie-管理"><a href="#Cookie-管理" class="headerlink" title="Cookie 管理"></a>Cookie 管理</h4><p>示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> cookieParser = <span class="built_in">require</span>(<span class="string">&#x27;cookie-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 配置 Cookie 中间件（启用签名）</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>(<span class="string">&#x27;your_secret_key&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 基础路由（测试页面）</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">`</span></span><br><span class="line"><span class="string">    &lt;html&gt;</span></span><br><span class="line"><span class="string">      &lt;body style=&quot;padding: 20px;&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;h2&gt;Cookie 管理测试&lt;/h2&gt;</span></span><br><span class="line"><span class="string">        &lt;button onclick=&quot;location.href=&#x27;/set-cookie&#x27;&quot;&gt;设置 Cookie&lt;/button&gt;</span></span><br><span class="line"><span class="string">        &lt;button onclick=&quot;location.href=&#x27;/get-cookie&#x27;&quot;&gt;读取 Cookie&lt;/button&gt;</span></span><br><span class="line"><span class="string">        &lt;button onclick=&quot;location.href=&#x27;/clear-cookie&#x27;&quot;&gt;删除 Cookie&lt;/button&gt;</span></span><br><span class="line"><span class="string">        &lt;p style=&quot;color: green&quot;&gt;<span class="subst">$&#123;req.signedCookies.user ? <span class="string">`当前用户: <span class="subst">$&#123;req.signedCookies.user&#125;</span>`</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>&lt;/p&gt;</span></span><br><span class="line"><span class="string">      &lt;/body&gt;</span></span><br><span class="line"><span class="string">    &lt;/html&gt;</span></span><br><span class="line"><span class="string">  `</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置签名 Cookie</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/set-cookie&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">cookie</span>(<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;Alice&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">maxAge</span>: <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000</span>,    <span class="comment">// 1 小时有效期</span></span><br><span class="line">    <span class="attr">httpOnly</span>: <span class="literal">true</span>,            <span class="comment">// 禁止客户端脚本访问</span></span><br><span class="line">    <span class="attr">secure</span>: <span class="literal">false</span>,             <span class="comment">// 开发环境设为 false，生产环境需设为 true</span></span><br><span class="line">    <span class="attr">signed</span>: <span class="literal">true</span>               <span class="comment">// 启用签名防篡改</span></span><br><span class="line">  &#125;);</span><br><span class="line">  res.<span class="title function_">redirect</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取 Cookie</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/get-cookie&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> unsignedUser = req.<span class="property">cookies</span>.<span class="property">user</span>;        <span class="comment">// 未签名 Cookie</span></span><br><span class="line">  <span class="keyword">const</span> signedUser = req.<span class="property">signedCookies</span>.<span class="property">user</span>;    <span class="comment">// 签名 Cookie</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (signedUser === <span class="literal">false</span>) &#123;                   <span class="comment">// 签名校验失败处理</span></span><br><span class="line">    res.<span class="title function_">clearCookie</span>(<span class="string">&#x27;user&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">send</span>(<span class="string">&#x27;Cookie 签名校验失败，已清除&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">send</span>(<span class="string">`签名 Cookie: <span class="subst">$&#123;signedUser || <span class="string">&#x27;无&#x27;</span>&#125;</span>&lt;br&gt;普通 Cookie: <span class="subst">$&#123;unsignedUser || <span class="string">&#x27;无&#x27;</span>&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除 Cookie</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/clear-cookie&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">clearCookie</span>(<span class="string">&#x27;user&#x27;</span>, &#123; </span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>, </span><br><span class="line">    <span class="attr">signed</span>: <span class="literal">true</span> </span><br><span class="line">  &#125;);</span><br><span class="line">  res.<span class="title function_">redirect</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误处理</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(err.<span class="property">stack</span>);</span><br><span class="line">  res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;服务器错误&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`运行地址: http://localhost:<span class="subst">$&#123;port&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><img src="/blog2025.github.io/image-20250503131301081.png" alt="image-20250503131301081"></p>
<p><img src="/blog2025.github.io/image-20250503131319686.png" alt="image-20250503131319686"></p>
<p><img src="/blog2025.github.io/image-20250503131353687.png" alt="image-20250503131353687"></p>
<p><img src="/blog2025.github.io/image-20250503131412960.png" alt="image-20250503131412960"></p>
<h3 id="RESTful-API"><a href="#RESTful-API" class="headerlink" title="RESTful API"></a><a target="_blank" rel="noopener" href="https://www.runoob.com/w3cnote/restful-architecture.html">RESTful API</a></h3><h4 id="HTTP-方法"><a href="#HTTP-方法" class="headerlink" title="HTTP 方法"></a>HTTP 方法</h4><p>以下为 REST 基本架构的四个方法：</p>
<ul>
<li><strong>GET</strong> - 用于获取数据。</li>
<li><strong>PUT</strong> - 用于更新或添加数据。</li>
<li><strong>DELETE</strong> - 用于删除数据。</li>
<li><strong>POST</strong> - 用于添加数据。</li>
</ul>
<p>示例：</p>
<p><strong>db.json</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;users&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Alice&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;alice@example.com&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Bob&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bob@example.com&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1746322845393</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zhangsan&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1111@163.com&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1746322868169</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lisi&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;222@163.cpm&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;products&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><strong>app.js</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="property">promises</span>;</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据库配置</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">DB_PATH</span> = path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;db.json&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>());</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(<span class="string">&#x27;public&#x27;</span>)); <span class="comment">// 托管静态文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取数据库</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">readDB</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> fs.<span class="title function_">readFile</span>(<span class="variable constant_">DB_PATH</span>, <span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">JSON</span>.<span class="title function_">parse</span>(data);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="keyword">if</span> (err.<span class="property">code</span> === <span class="string">&#x27;ENOENT&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">await</span> fs.<span class="title function_">writeFile</span>(<span class="variable constant_">DB_PATH</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; <span class="attr">users</span>: [] &#125;, <span class="literal">null</span>, <span class="number">2</span>));</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">users</span>: [] &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> err;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写入数据库</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">writeDB</span> = <span class="keyword">async</span> (<span class="params">data</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> fs.<span class="title function_">writeFile</span>(<span class="variable constant_">DB_PATH</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data, <span class="literal">null</span>, <span class="number">2</span>), <span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// RESTful API</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/api/users&#x27;</span>, <span class="title function_">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> db = <span class="keyword">await</span> <span class="title function_">readDB</span>();</span><br><span class="line">    res.<span class="title function_">json</span>(db.<span class="property">users</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;Database error&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/api/users&#x27;</span>, <span class="title function_">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> db = <span class="keyword">await</span> <span class="title function_">readDB</span>();</span><br><span class="line">    <span class="keyword">const</span> newUser = &#123; <span class="attr">id</span>: <span class="title class_">Date</span>.<span class="title function_">now</span>(), ...req.<span class="property">body</span> &#125;;</span><br><span class="line">    db.<span class="property">users</span>.<span class="title function_">push</span>(newUser);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">writeDB</span>(db);</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">201</span>).<span class="title function_">json</span>(newUser);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;Create failed&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">put</span>(<span class="string">&#x27;/api/users/:id&#x27;</span>, <span class="title function_">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> db = <span class="keyword">await</span> <span class="title function_">readDB</span>();</span><br><span class="line">    <span class="keyword">const</span> user = db.<span class="property">users</span>.<span class="title function_">find</span>(<span class="function"><span class="params">u</span> =&gt;</span> u.<span class="property">id</span> === <span class="built_in">parseInt</span>(req.<span class="property">params</span>.<span class="property">id</span>));</span><br><span class="line">    <span class="keyword">if</span> (!user) <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">404</span>).<span class="title function_">send</span>(<span class="string">&#x27;User not found&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">assign</span>(user, req.<span class="property">body</span>);</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">writeDB</span>(db);</span><br><span class="line">    res.<span class="title function_">json</span>(user);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;Update failed&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">delete</span>(<span class="string">&#x27;/api/users/:id&#x27;</span>, <span class="title function_">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> db = <span class="keyword">await</span> <span class="title function_">readDB</span>();</span><br><span class="line">    <span class="keyword">const</span> initialLength = db.<span class="property">users</span>.<span class="property">length</span>;</span><br><span class="line">    db.<span class="property">users</span> = db.<span class="property">users</span>.<span class="title function_">filter</span>(<span class="function"><span class="params">u</span> =&gt;</span> u.<span class="property">id</span> !== <span class="built_in">parseInt</span>(req.<span class="property">params</span>.<span class="property">id</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (db.<span class="property">users</span>.<span class="property">length</span> === initialLength) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">404</span>).<span class="title function_">send</span>(<span class="string">&#x27;User not found&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">writeDB</span>(db);</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">204</span>).<span class="title function_">send</span>();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;Delete failed&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Server running at http://localhost:<span class="subst">$&#123;PORT&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>public&#x2F;index.html</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>用户管理系统<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;styles.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>用户管理<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 添加用户表单 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;userForm&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;姓名&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">id</span>=<span class="string">&quot;email&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;邮箱&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>添加用户<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 用户列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;userList&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 获取DOM元素</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> userForm = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;userForm&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> userList = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;userList&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 加载用户列表</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> <span class="title function_">loadUsers</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/api/users&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> users = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span></span><br><span class="line"><span class="language-javascript">      userList.<span class="property">innerHTML</span> = users.<span class="title function_">map</span>(<span class="function"><span class="params">user</span> =&gt;</span> <span class="string">`</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">        &lt;div class=&quot;user-card&quot; data-id=&quot;<span class="subst">$&#123;user.id&#125;</span>&quot;&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">          &lt;div&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">            &lt;span&gt;<span class="subst">$&#123;user.name&#125;</span>&lt;/span&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">            &lt;small&gt;<span class="subst">$&#123;user.email&#125;</span>&lt;/small&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">          &lt;/div&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">          &lt;div&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">            &lt;button onclick=&quot;editUser(<span class="subst">$&#123;user.id&#125;</span>)&quot;&gt;编辑&lt;/button&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">            &lt;button onclick=&quot;deleteUser(<span class="subst">$&#123;user.id&#125;</span>)&quot;&gt;删除&lt;/button&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">          &lt;/div&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">        &lt;/div&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">      `</span>).<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 添加用户</span></span></span><br><span class="line"><span class="language-javascript">    userForm.<span class="property">onsubmit</span> = <span class="title function_">async</span> (e) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">      e.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> newUser = &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">name</span>: <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;name&#x27;</span>).<span class="property">value</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">email</span>: <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;email&#x27;</span>).<span class="property">value</span></span></span><br><span class="line"><span class="language-javascript">      &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/api/users&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">headers</span>: &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(newUser)</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      userForm.<span class="title function_">reset</span>();</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">loadUsers</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 删除用户</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="property">deleteUser</span> = <span class="title function_">async</span> (id) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="title function_">confirm</span>(<span class="string">&#x27;确定要删除吗？&#x27;</span>)) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`/api/users/<span class="subst">$&#123;id&#125;</span>`</span>, &#123; <span class="attr">method</span>: <span class="string">&#x27;DELETE&#x27;</span> &#125;);</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">loadUsers</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 编辑用户（弹窗修改）</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="property">editUser</span> = <span class="title function_">async</span> (id) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> newName = <span class="title function_">prompt</span>(<span class="string">&#x27;输入新姓名&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> newEmail = <span class="title function_">prompt</span>(<span class="string">&#x27;输入新邮箱&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">      </span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (newName &amp;&amp; newEmail) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`/api/users/<span class="subst">$&#123;id&#125;</span>`</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">method</span>: <span class="string">&#x27;PUT&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">headers</span>: &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; <span class="attr">name</span>: newName, <span class="attr">email</span>: newEmail &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">loadUsers</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 初始化加载</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">loadUsers</span>();</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>public&#x2F;styles.css</strong></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">font-family</span>: Arial, sans-serif;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#f0f2f5</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.container</span> &#123;</span><br><span class="line">    <span class="attribute">max-width</span>: <span class="number">800px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">    <span class="attribute">background</span>: white;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">2px</span> <span class="number">4px</span> <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0.1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-id">#userForm</span> &#123;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">gap</span>: <span class="number">10px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-tag">input</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ddd</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-tag">button</span> &#123;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">8px</span> <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#007bff</span>;</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">    <span class="attribute">border</span>: none;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-tag">button</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#0056b3</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.user-card</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">    <span class="attribute">align-items</span>: center;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">5px</span> <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#eee</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.user-card</span> <span class="selector-tag">div</span><span class="selector-pseudo">:first-child</span> &#123;</span><br><span class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.user-card</span> <span class="selector-tag">span</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.user-card</span> small &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#666</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="多进程"><a href="#多进程" class="headerlink" title="多进程"></a>多进程</h3><p>Node.js 是以单线程的模式运行的，但可以使用事件驱动来处理并发，从而创建多个子进程。实现：</p>
<ul>
<li>‌<strong>充分利用多核 CPU</strong>‌（横向扩展）</li>
<li>‌<strong>隔离高 CPU 消耗任务</strong>‌（避免阻塞事件循环）</li>
<li>‌<strong>提高应用稳定性</strong>‌（单个进程崩溃不影响整体）</li>
</ul>
<h4 id="子进程组成：（三大标准流）"><a href="#子进程组成：（三大标准流）" class="headerlink" title="子进程组成：（三大标准流）"></a>子进程组成：（三大标准流）</h4><ul>
<li><p>child.stdin</p>
<ul>
<li>用于向子进程 ‌<strong>发送输入数据</strong>‌（如命令参数、交互式输入）</li>
<li>本质是可写流（Writable Stream），通过 <code>.write()</code> 写入数据</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">child.<span class="property">stdin</span>.<span class="title function_">write</span>(<span class="string">&#x27;ping example.com\n&#x27;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>child.stdout </p>
<ul>
<li>接收子进程的 ‌<strong>标准输出数据</strong>‌（例如命令行执行结果）</li>
<li>本质是可读流（Readable Stream），通过监听 <code>data</code> 事件获取数据</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">child.<span class="property">stdout</span>.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`子进程输出：<span class="subst">$&#123;data&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>child.stderr</p>
<ul>
<li>捕获子进程的 ‌<strong>错误输出</strong>‌（如命令执行失败、异常信息）</li>
<li>同样为可读流，需单独监听以避免与正常输出混淆</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">child.<span class="property">stderr</span>.<span class="title function_">on</span>(<span class="string">&#x27;data&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`错误信息：<span class="subst">$&#123;err&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
<p>‌<strong>数据流向示意图</strong>‌</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">父进程 → [child.stdin] → 子进程  </span><br><span class="line">子进程 → [child.stdout] → 父进程  </span><br><span class="line">子进程 → [child.stderr] → 父进程</span><br></pre></td></tr></table></figure>

<p>‌<strong>典型使用场景</strong>‌</p>
<table>
<thead>
<tr>
<th>场景</th>
<th>对应流</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>‌<strong>交互式命令</strong>‌</td>
<td><code>stdin</code> + <code>stdout</code></td>
<td>如 SSH 连接后持续输入指令</td>
</tr>
<tr>
<td>‌<strong>日志收集</strong>‌</td>
<td><code>stdout</code>&#x2F;<code>stderr</code></td>
<td>分离正常日志和错误日志</td>
</tr>
<tr>
<td>‌<strong>管道操作</strong>‌</td>
<td>组合使用</td>
<td>将 A 进程的输出作为 B 进程的输入</td>
</tr>
</tbody></table>
<p>‌<strong>注意事项</strong>‌</p>
<ul>
<li>‌<strong>流模式差异</strong>‌<br><code>spawn</code> 默认使用流式处理（适合大数据），而 <code>exec</code> 会缓冲全部输出后返回</li>
<li>‌<strong>共享与独立</strong>‌<br>子进程的 stdio 流可与父进程共享（默认），也可通过配置设为独立管道</li>
<li>‌<strong>资源释放</strong>‌<br>需手动关闭流：<code>child.stdin.end()</code> 终止输入</li>
<li>‌<strong>错误处理</strong>‌<br>必须监听 <code>stderr</code> 和 <code>error</code> 事件，否则可能导致未捕获异常</li>
</ul>
<h4 id="多进程核心模块"><a href="#多进程核心模块" class="headerlink" title="多进程核心模块"></a>多进程核心模块</h4><p> ‌**<code>child_process</code> 模块**</p>
<ul>
<li><p>‌关键方法：</p>
<ul>
<li><code>spawn()</code>: 启动子进程执行命令（适合长时间运行）</li>
<li><code>exec()</code>: 执行 Shell 命令并缓冲输出（适合短命令）</li>
<li><code>fork()</code>: 专用 <code>spawn()</code>，创建新的 Node.js 进程（自动建立 IPC(进程间) 通信）</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/nodejs/nodejs-process.html">详细参数看链接</a></p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例：使用 fork 创建子进程</span></span><br><span class="line"><span class="keyword">const</span> &#123; fork &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> child = <span class="title function_">fork</span>(<span class="string">&#x27;subprocess.js&#x27;</span>);</span><br><span class="line"></span><br><span class="line">child.<span class="title function_">on</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">msg</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;来自子进程的消息:&#x27;</span>, msg);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">child.<span class="title function_">send</span>(&#123; <span class="attr">parent</span>: <span class="string">&#x27;Hello from parent&#x27;</span> &#125;);</span><br></pre></td></tr></table></figure>

<p><strong><code>cluster</code> 模块</strong></p>
<ul>
<li>‌<strong>核心功能</strong>‌：自动创建主进程（Master）和工作进程（Worker）</li>
<li>‌<strong>典型场景</strong>‌：创建 HTTP 服务器集群</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cluster = <span class="built_in">require</span>(<span class="string">&#x27;cluster&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> numCPUs = <span class="built_in">require</span>(<span class="string">&#x27;os&#x27;</span>).<span class="title function_">cpus</span>().<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (cluster.<span class="property">isMaster</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`主进程 <span class="subst">$&#123;process.pid&#125;</span> 启动`</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 创建工作进程</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; numCPUs; i++) &#123;</span><br><span class="line">    cluster.<span class="title function_">fork</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  cluster.<span class="title function_">on</span>(<span class="string">&#x27;exit&#x27;</span>, <span class="function">(<span class="params">worker</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`工作进程 <span class="subst">$&#123;worker.process.pid&#125;</span> 已退出`</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// 工作进程共享同一个端口</span></span><br><span class="line">  http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">writeHead</span>(<span class="number">200</span>);</span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&#x27;Hello World\n&#x27;</span>);</span><br><span class="line">  &#125;).<span class="title function_">listen</span>(<span class="number">8000</span>);</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`工作进程 <span class="subst">$&#123;process.pid&#125;</span> 启动`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JXcore-打包（不建议使用-不支持ES6）"><a href="#JXcore-打包（不建议使用-不支持ES6）" class="headerlink" title="JXcore 打包（不建议使用-不支持ES6）"></a>JXcore 打包（不建议使用-不支持ES6）</h3><p>JXcore 是一个支持多线程的 Node.js 发行版本，基本不需要对你现有的代码做任何改动就可以直接线程安全地以多线程运行。</p>
<h4 id="JXcore-安装"><a href="#JXcore-安装" class="headerlink" title="JXcore 安装"></a>JXcore 安装</h4><p>下载 JXcore 安装包，并解压，在解压的的目录下提供了 jx 二进制文件命令，接下来我们主要使用这个命令。</p>
<p>下载地址：<a target="_blank" rel="noopener" href="https://github.com/jxcore/jxcore-release">https://github.com/jxcore/jxcore-release</a></p>
<p><img src="/blog2025.github.io/image-20250504101946525.png" alt="image-20250504101946525"></p>
<p>打包项目：</p>
<p><img src="/blog2025.github.io/image-20250504102326113.png" alt="image-20250504102326113"></p>
<p>以 <strong>app.js</strong> 为入口文件，指定 <strong>app.js</strong> 为node.js项目的主文件：</p>
<ul>
<li>基本打包命令：</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">jx package &lt;入口文件&gt; &lt;输出文件名&gt; [选项]</span><br><span class="line"></span><br><span class="line"><span class="comment">#示例</span></span><br><span class="line">jx package app.js myapp -native</span><br><span class="line">-native：生成当前平台的可执行文件</span><br><span class="line">-slim：精简依赖包体积		 -slim fs,net</span><br><span class="line">-library：是否生成动态链接库	-library <span class="literal">false</span></span><br><span class="line">-extract：保持文件结构不压缩	-extract</span><br><span class="line">-password：加密打包文件	  -password mySecret123</span><br><span class="line">--target：跨平台打包(默认生成当前平台的可执行文件)	--target=windows,linux</span><br></pre></td></tr></table></figure>

<p><img src="/blog2025.github.io/image-20250504102304618.png" alt="image-20250504102304618"></p>
<p>执行成功，会生成以下两个文件：</p>
<p><img src="/blog2025.github.io/image-20250504102404458.png" alt="image-20250504102404458"></p>
<ul>
<li><strong>app.jx</strong>：这是一个完整包信息的二进制文件，可运行在客户端上。</li>
<li><strong>app.jxp</strong>：这是一个中间件文件，包含了需要编译的完整项目信息。</li>
</ul>
<h4 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jx app.jx</span><br></pre></td></tr></table></figure>

<h4 id="兼容性问题："><a href="#兼容性问题：" class="headerlink" title="兼容性问题："></a>兼容性问题：</h4><ol>
<li>‌<strong>引擎版本差异</strong>‌<br>JXcore 使用的 JavaScript 引擎为 <strong><code>SpiderMonkey</code> 或旧版 V8</strong>，默认不支持 ES6 箭头函数等新特性</li>
<li>‌<strong>编译模式限制</strong>‌<br>使用 <code>jx package</code> 打包时若未开启 ES6 支持，编译器会将箭头函数识别为非法语法</li>
</ol>
<p><strong>解决方案：</strong></p>
<ul>
<li>‌**方案1：代码降级（推荐）**‌</li>
</ul>
<p>将箭头函数改写为传统函数表达式：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修改前</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123; </span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改后</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>(<span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>方案2：强制启用 ES6 模式</strong>‌</li>
</ul>
<p>在打包命令中添加 <code>-es6</code> 参数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jx package server.js server --es6</span><br></pre></td></tr></table></figure>

<ul>
<li>**方案3：使用 Babel 转译（完整ES6支持）**‌</li>
</ul>
<ol>
<li>安装 Babel 依赖：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @babel/core @babel/preset-env --save-dev</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>创建 <code>.babelrc</code> 配置文件：</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;presets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;@babel/preset-env&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>使用 Babel 预处理代码后再打包：</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npx babel server.js --out-file compiled.js &amp;&amp; jx package compiled.js server</span><br></pre></td></tr></table></figure>

<h3 id="pkg-nexe-Next-js-等打包工具"><a href="#pkg-nexe-Next-js-等打包工具" class="headerlink" title="pkg&#x2F;nexe&#x2F;Next.js 等打包工具"></a>pkg&#x2F;nexe&#x2F;Next.js 等打包工具</h3><table>
<thead>
<tr>
<th>工具</th>
<th>打包速度</th>
<th>输出体积</th>
<th>ES6支持</th>
</tr>
</thead>
<tbody><tr>
<td>‌<strong>nexe</strong>‌</td>
<td>中等</td>
<td>较大</td>
<td>完整</td>
</tr>
<tr>
<td>‌<strong>pkg</strong>‌</td>
<td>快速</td>
<td>较小</td>
<td>完整</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>工具类型</th>
<th>推荐工具</th>
<th>适用场景</th>
<th>关键特性</th>
</tr>
</thead>
<tbody><tr>
<td>‌<strong>轻量级</strong>‌</td>
<td><code>pkg</code></td>
<td>CLI工具或小型服务</td>
<td>单文件输出、零配置依赖</td>
</tr>
<tr>
<td>‌<strong>复杂应用</strong>‌</td>
<td><code>Webpack + nexe</code></td>
<td>多模块项目或需动态加载</td>
<td>代码分割、热更新支持</td>
</tr>
<tr>
<td>‌<strong>全栈开发</strong>‌</td>
<td><code>Next.js</code></td>
<td>SSR&#x2F;SSG应用或一体化API服务</td>
<td>内置优化、开发体验流畅</td>
</tr>
</tbody></table>
<hr>
<h4 id="pkg教程（推荐）"><a href="#pkg教程（推荐）" class="headerlink" title="pkg教程（推荐）"></a>pkg教程（推荐）</h4><p><strong>全局安装 pkg</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g pkg@latest</span><br></pre></td></tr></table></figure>

<p><strong>项目配置</strong>（这个需要<code>npm init</code>去生成）<br>在 <code>package.json</code> 中配置入口文件与打包参数：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;my-app&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;main&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;pkg&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;node18-win-x64&quot;</span><span class="punctuation">,</span> <span class="string">&quot;node18-linux-x64&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;assets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;public/&amp;zwnj;**/*&quot;</span><span class="punctuation">,</span> <span class="string">&quot;views/**&amp;zwnj;/*&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>targets</code>：指定目标平台与 Node.js 版本（格式：<code>node版本-平台-架构</code>）</li>
<li><code>assets</code>：声明需打包的静态资源目录（如图片、CSS 文件等）</li>
</ul>
<p><strong><font color="red">本地开发环境与打包目标的 Node.js 版本需严格一致</font></strong></p>
<hr>
<p><strong>基础打包命令</strong></p>
<p><strong>1. 单文件打包</strong>‌</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pkg index.js --target node18-win-x64 --output myapp.exe</span><br></pre></td></tr></table></figure>

<ul>
<li><code>--target</code>：指定目标运行环境（默认生成当前系统平台的可执行文件）</li>
<li><code>--output</code>：自定义输出文件名</li>
<li><code>index.js</code>：入口文件</li>
<li><code>--output</code>：输出文件名</li>
</ul>
<p><img src="/blog2025.github.io/image-20250504112144603.png" alt="image-20250504112144603"></p>
<p>‌<strong>2. 多平台打包</strong>‌</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pkg . --targets node18-win-x64,node18-macos-x64,node18-linux-x64 --out-path dist/</span><br></pre></td></tr></table></figure>

<ul>
<li>生成不同平台的二进制文件并输出到 <code>dist/</code> 目录</li>
</ul>
<hr>
<p><strong>静态资源处理</strong>‌</p>
<p>‌<strong>1. 自动打包资源文件</strong>‌<br>在 <code>package.json</code> 的 <code>assets</code> 字段声明需包含的静态资源：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;pkg&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;targets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;node18-win-x64&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;node18-linux-x64&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;assets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;public/**/*&quot;</span><span class="punctuation">,</span> <span class="string">&quot;config/*.json&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;app.js&quot;</span><span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<ul>
<li>支持通配符 <code>*</code> 和 <code>**</code> 匹配多级目录</li>
</ul>
<p><strong>2. 运行时路径适配</strong>‌<br>代码中需使用 <code>__dirname</code> 动态获取资源路径：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> configPath = path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;config/settings.json&#x27;</span>);</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>打包效果</strong>：</p>
<p><img src="/blog2025.github.io/image-20250504112943771.png" alt="image-20250504112943771"></p>
<hr>
<p><strong>测试验证</strong>：‌</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myapp.exe --<span class="built_in">test</span></span><br></pre></td></tr></table></figure>

<p><img src="/blog2025.github.io/image-20250504113008729.png" alt="image-20250504113008729"></p>
<hr>
<p><strong>详细配置看<code>node-packagetest</code>代码包</strong></p>
<p><strong>第一次打包慢，后头就快了。</strong></p>
<hr>
<h4 id="nexe教程（存在联网问题）"><a href="#nexe教程（存在联网问题）" class="headerlink" title="nexe教程（存在联网问题）"></a>nexe教程（存在联网问题）</h4><p>‌<strong>全局安装 Nexe</strong>‌</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g nexe@latest</span><br></pre></td></tr></table></figure>

<p><strong>基础打包流程</strong></p>
<p>1.<strong>单文件打包</strong>‌<br>对简单脚本直接生成可执行文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nexe app.js -o myapp</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-o</code> 指定输出文件名，默认生成当前平台的二进制文件</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nexe app.js -o app --target node18.17.0-win-x64 --build</span><br></pre></td></tr></table></figure>

<ul>
<li><code>--target</code>：指定目标运行环境（默认生成当前系统平台的可执行文件）</li>
<li><code>--build</code>：项目包含 <code>.node</code> 文件（如 SQLite3、bcrypt），需通过 <code>--build</code> 参数显式触发重新编译</li>
</ul>
<p>‌2.<strong>完整项目打包</strong>‌<br>处理多文件项目时需指定入口文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nexe ./src/main.js --build --resource <span class="string">&quot;public/**/*&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>--build</code> 启用编译优化模式</li>
<li><code>--resource</code> 包含静态资源文件（如图片、配置文件）</li>
<li><code>./src/main.js</code>：入口文件</li>
</ul>
<p><img src="/blog2025.github.io/image-20250504114813603.png" alt="image-20250504114813603"></p>
<p><strong>高级配置选项</strong></p>
<ol>
<li><p>‌<strong>跨平台打包</strong>‌<br>通过 <code>--target</code> 参数指定目标平台：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nexe app.js --target windows-x64,linux-x64,macos-x64</span><br></pre></td></tr></table></figure>

<ul>
<li>支持组合生成多平台可执行文件</li>
</ul>
</li>
<li><p>‌<strong>锁定 Node.js 版本</strong>‌<br>指定项目依赖的 Node.js 运行时版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nexe app.js --target node18.17.0-win-x64</span><br></pre></td></tr></table></figure>

<ul>
<li>避免因环境差异导致运行异常</li>
</ul>
</li>
</ol>
<p><strong>静态资源处理</strong>‌</p>
<ul>
<li><p>使用<code>__dirname</code>获取运行时绝对路径：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> configPath = path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;config/settings.json&#x27;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过<code>--resource</code>参数声明资源目录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nexe app.js --resource <span class="string">&quot;assets/**/*.json&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>支持通配符匹配多级目录文件</li>
</ul>
</li>
</ul>
<h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><h3 id="示例一："><a href="#示例一：" class="headerlink" title="示例一："></a>示例一：</h3><p>‌<strong>安装依赖</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mysql2</span><br></pre></td></tr></table></figure>

<p><strong>创建 MySQL 数据库与表</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> testdb;</span><br><span class="line">USE testdb;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建用户表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> users (</span><br><span class="line">  id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">  username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  created_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入示例数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (username, email) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;user1&#x27;</span>, <span class="string">&#x27;user1@example.com&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;user2&#x27;</span>, <span class="string">&#x27;user2@example.com&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>可运行代码：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql2/promise&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据库配置</span></span><br><span class="line"><span class="keyword">const</span> dbConfig = &#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">  <span class="attr">user</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">  <span class="attr">password</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">  <span class="attr">database</span>: <span class="string">&#x27;testdb&#x27;</span>,</span><br><span class="line">  <span class="attr">waitForConnections</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">connectionLimit</span>: <span class="number">10</span>,</span><br><span class="line">  <span class="attr">queueLimit</span>: <span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建连接池</span></span><br><span class="line"><span class="keyword">const</span> pool = mysql.<span class="title function_">createPool</span>(dbConfig);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 增删改查操作封装</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserDAO</span> &#123;</span><br><span class="line">  <span class="comment">// 添加用户</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">addUser</span>(<span class="params">username, email</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> sql = <span class="string">&#x27;INSERT INTO users (username, email) VALUES (?, ?)&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> [result] = <span class="keyword">await</span> pool.<span class="title function_">execute</span>(sql, [username, email]);</span><br><span class="line">    <span class="keyword">return</span> result.<span class="property">insertId</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 查询所有用户</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">getAllUsers</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> sql = <span class="string">&#x27;SELECT * FROM users&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> [rows] = <span class="keyword">await</span> pool.<span class="title function_">query</span>(sql);</span><br><span class="line">    <span class="keyword">return</span> rows;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 更新用户</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">updateUser</span>(<span class="params">id, newEmail</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> sql = <span class="string">&#x27;UPDATE users SET email = ? WHERE id = ?&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> [result] = <span class="keyword">await</span> pool.<span class="title function_">execute</span>(sql, [newEmail, id]);</span><br><span class="line">    <span class="keyword">return</span> result.<span class="property">affectedRows</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 删除用户</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">async</span> <span class="title function_">deleteUser</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> sql = <span class="string">&#x27;DELETE FROM users WHERE id = ?&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> [result] = <span class="keyword">await</span> pool.<span class="title function_">execute</span>(sql, [id]);</span><br><span class="line">    <span class="keyword">return</span> result.<span class="property">affectedRows</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试示例</span></span><br><span class="line">(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 添加用户</span></span><br><span class="line">    <span class="keyword">const</span> newUserId = <span class="keyword">await</span> <span class="title class_">UserDAO</span>.<span class="title function_">addUser</span>(<span class="string">&#x27;new_user&#x27;</span>, <span class="string">&#x27;new@example.com&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`添加成功，用户ID: <span class="subst">$&#123;newUserId&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有用户</span></span><br><span class="line">    <span class="keyword">const</span> users = <span class="keyword">await</span> <span class="title class_">UserDAO</span>.<span class="title function_">getAllUsers</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;当前用户列表:&#x27;</span>, users);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新用户</span></span><br><span class="line">    <span class="keyword">const</span> updatedRows = <span class="keyword">await</span> <span class="title class_">UserDAO</span>.<span class="title function_">updateUser</span>(newUserId, <span class="string">&#x27;updated@example.com&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`更新影响行数: <span class="subst">$&#123;updatedRows&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除用户</span></span><br><span class="line">    <span class="keyword">const</span> deletedRows = <span class="keyword">await</span> <span class="title class_">UserDAO</span>.<span class="title function_">deleteUser</span>(newUserId);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`删除影响行数: <span class="subst">$&#123;deletedRows&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 最终用户列表</span></span><br><span class="line">    <span class="keyword">const</span> finalUsers = <span class="keyword">await</span> <span class="title class_">UserDAO</span>.<span class="title function_">getAllUsers</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;最终用户列表:&#x27;</span>, finalUsers);</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;操作失败:&#x27;</span>, error);</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">// 关闭连接池</span></span><br><span class="line">    <span class="keyword">await</span> pool.<span class="title function_">end</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="示例二：（页面-解耦）"><a href="#示例二：（页面-解耦）" class="headerlink" title="示例二：（页面+解耦）"></a><strong>示例二</strong>：（页面+解耦）</h3><p><strong>项目结构</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">api-server/</span><br><span class="line">├── package.json <span class="comment">#安装express时全局安装自动生成</span></span><br><span class="line">├── db.js       <span class="comment"># 数据库连接</span></span><br><span class="line">├── users.js    <span class="comment"># 路由控制器</span></span><br><span class="line">└── server.js   <span class="comment"># 主入口</span></span><br></pre></td></tr></table></figure>

<p><strong>安装依赖：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install express mysql2 cors</span><br><span class="line"><span class="comment">#安装express、mysql、cors(跨域)</span></span><br></pre></td></tr></table></figure>

<p><strong>完整后端代码</strong>：</p>
<p><em><strong>db.js</strong></em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// db.js - 数据库连接池</span></span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql2/promise&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pool = mysql.<span class="title function_">createPool</span>(&#123;</span><br><span class="line">  <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">  <span class="attr">user</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">  <span class="attr">password</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">  <span class="attr">database</span>: <span class="string">&#x27;testdb&#x27;</span>,</span><br><span class="line">  <span class="attr">waitForConnections</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">connectionLimit</span>: <span class="number">10</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = pool;</span><br></pre></td></tr></table></figure>

<p><em><strong>users.js</strong></em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// users.js - 用户路由控制器</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">const</span> pool = <span class="built_in">require</span>(<span class="string">&#x27;./db&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取所有用户</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="title function_">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [rows] = <span class="keyword">await</span> pool.<span class="title function_">query</span>(<span class="string">&#x27;SELECT * FROM users&#x27;</span>);</span><br><span class="line">    res.<span class="title function_">json</span>(rows);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: err.<span class="property">message</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建用户</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/&#x27;</span>, <span class="title function_">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; username, email &#125; = req.<span class="property">body</span>;</span><br><span class="line">  <span class="keyword">if</span> (!username || !email) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: <span class="string">&#x27;缺少必要参数&#x27;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [result] = <span class="keyword">await</span> pool.<span class="title function_">execute</span>(</span><br><span class="line">      <span class="string">&#x27;INSERT INTO users (username, email) VALUES (?, ?)&#x27;</span>,</span><br><span class="line">      [username, email]</span><br><span class="line">    );</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">201</span>).<span class="title function_">json</span>(&#123; <span class="attr">id</span>: result.<span class="property">insertId</span> &#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: err.<span class="property">message</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更新用户</span></span><br><span class="line">router.<span class="title function_">put</span>(<span class="string">&#x27;/:id&#x27;</span>, <span class="title function_">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> id = req.<span class="property">params</span>.<span class="property">id</span>;</span><br><span class="line">  <span class="keyword">const</span> &#123; email &#125; = req.<span class="property">body</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [result] = <span class="keyword">await</span> pool.<span class="title function_">execute</span>(</span><br><span class="line">      <span class="string">&#x27;UPDATE users SET email = ? WHERE id = ?&#x27;</span>,</span><br><span class="line">      [email, id]</span><br><span class="line">    );</span><br><span class="line">    res.<span class="title function_">json</span>(&#123; <span class="attr">affectedRows</span>: result.<span class="property">affectedRows</span> &#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: err.<span class="property">message</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除用户</span></span><br><span class="line">router.<span class="title function_">delete</span>(<span class="string">&#x27;/:id&#x27;</span>, <span class="title function_">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> id = req.<span class="property">params</span>.<span class="property">id</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [result] = <span class="keyword">await</span> pool.<span class="title function_">execute</span>(</span><br><span class="line">      <span class="string">&#x27;DELETE FROM users WHERE id = ?&#x27;</span>,</span><br><span class="line">      [id]</span><br><span class="line">    );</span><br><span class="line">    res.<span class="title function_">json</span>(&#123; <span class="attr">affectedRows</span>: result.<span class="property">affectedRows</span> &#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">json</span>(&#123; <span class="attr">error</span>: err.<span class="property">message</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p><em><strong>server.js</strong></em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js - 主服务</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;cors&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> usersRouter = <span class="built_in">require</span>(<span class="string">&#x27;./users&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cors</span>());</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 路由</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api/users&#x27;</span>, usersRouter);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动服务</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PORT</span> = <span class="number">3001</span>;</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="variable constant_">PORT</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`API 服务运行在 http://localhost:<span class="subst">$&#123;PORT&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>测试</strong>：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:3001/api/users/</span><br></pre></td></tr></table></figure>

<p><strong>页面</strong>：</p>
<p><em><strong>index.html</strong></em></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>用户管理系统<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">font-family</span>: Arial, sans-serif;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">max-width</span>: <span class="number">800px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin</span>: <span class="number">20px</span> auto;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#f5f5f5</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.container</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background</span>: white;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">2px</span> <span class="number">4px</span> <span class="built_in">rgba</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0.1</span>);</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.user-form</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-bottom</span>: <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.form-group</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-bottom</span>: <span class="number">15px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;text&quot;</span>]</span>, </span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">&quot;email&quot;</span>]</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">width</span>: <span class="number">200px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">8px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-right</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ddd</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">button</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#007bff</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">8px</span> <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">transition</span>: background <span class="number">0.3s</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">button</span><span class="selector-pseudo">:hover</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#0056b3</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.user-list</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">list-style</span>: none;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.user-item</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">justify-content</span>: space-between;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin</span>: <span class="number">5px</span> <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#f8f9fa</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.user-info</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">flex-grow</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.user-actions</span> <span class="selector-tag">button</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-left</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#6c757d</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.error</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: <span class="number">#dc3545</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-top</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>用户管理系统<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- 添加用户表单 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;user-form&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h2</span>&gt;</span>添加新用户<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;用户名&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">id</span>=<span class="string">&quot;email&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;邮箱&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;addUser()&quot;</span>&gt;</span>添加用户<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;form-error&quot;</span> <span class="attr">class</span>=<span class="string">&quot;error&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 用户列表 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>用户列表<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;user-list&quot;</span> <span class="attr">id</span>=<span class="string">&quot;userList&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 用户列表将通过JavaScript动态加载 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 页面加载时获取用户列表</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">window</span>.<span class="property">onload</span> = loadUsers;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 加载用户列表</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">loadUsers</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;http://localhost:3001/api/users&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (!response.<span class="property">ok</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;获取数据失败&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                </span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> users = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">renderUserList</span>(users);</span></span><br><span class="line"><span class="language-javascript">            &#125; <span class="keyword">catch</span> (error) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">showError</span>(error.<span class="property">message</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 渲染用户列表</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">renderUserList</span>(<span class="params">users</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> list = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;userList&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            list.<span class="property">innerHTML</span> = <span class="string">&#x27;&#x27;</span>; <span class="comment">// 清空当前列表</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            users.<span class="title function_">forEach</span>(<span class="function"><span class="params">user</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> li = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;li&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                li.<span class="property">className</span> = <span class="string">&#x27;user-item&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">                li.<span class="property">innerHTML</span> = <span class="string">`</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">                    &lt;div class=&quot;user-info&quot;&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">                        &lt;strong&gt;<span class="subst">$&#123;user.username&#125;</span>&lt;/strong&gt; - <span class="subst">$&#123;user.email&#125;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript">                    &lt;/div&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">                    &lt;div class=&quot;user-actions&quot;&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">                        &lt;button onclick=&quot;showEditForm(<span class="subst">$&#123;user.id&#125;</span>, &#x27;<span class="subst">$&#123;user.email&#125;</span>&#x27;)&quot;&gt;修改邮箱&lt;/button&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">                        &lt;button onclick=&quot;deleteUser(<span class="subst">$&#123;user.id&#125;</span>)&quot;&gt;删除&lt;/button&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">                    &lt;/div&gt;</span></span></span><br><span class="line"><span class="string"><span class="language-javascript">                `</span>;</span></span><br><span class="line"><span class="language-javascript">                list.<span class="title function_">appendChild</span>(li);</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 添加用户</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">addUser</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> username = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;username&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> email = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;email&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (!username || !email) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">showError</span>(<span class="string">&#x27;用户名和邮箱不能为空&#x27;</span>, <span class="string">&#x27;form-error&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;http://localhost:3001/api/users&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">headers</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; username, email &#125;)</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (!response.<span class="property">ok</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;添加用户失败&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 清空表单并刷新列表</span></span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;username&#x27;</span>).<span class="property">value</span> = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;email&#x27;</span>).<span class="property">value</span> = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">loadUsers</span>();</span></span><br><span class="line"><span class="language-javascript">            &#125; <span class="keyword">catch</span> (error) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">showError</span>(error.<span class="property">message</span>, <span class="string">&#x27;form-error&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 删除用户</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">deleteUser</span>(<span class="params">userId</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (!<span class="title function_">confirm</span>(<span class="string">&#x27;确定要删除该用户吗？&#x27;</span>)) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`http://localhost:3001/api/users/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">method</span>: <span class="string">&#x27;DELETE&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (!response.<span class="property">ok</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;删除用户失败&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                </span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">loadUsers</span>();</span></span><br><span class="line"><span class="language-javascript">            &#125; <span class="keyword">catch</span> (error) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">showError</span>(error.<span class="property">message</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 显示修改邮箱表单</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">showEditForm</span>(<span class="params">userId, currentEmail</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> newEmail = <span class="title function_">prompt</span>(<span class="string">&#x27;请输入新的邮箱地址：&#x27;</span>, currentEmail);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (newEmail &amp;&amp; newEmail !== currentEmail) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">updateUserEmail</span>(userId, newEmail);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 更新用户邮箱</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">updateUserEmail</span>(<span class="params">userId, newEmail</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`http://localhost:3001/api/users/<span class="subst">$&#123;userId&#125;</span>`</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">method</span>: <span class="string">&#x27;PUT&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">headers</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; <span class="attr">email</span>: newEmail &#125;)</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (!response.<span class="property">ok</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;更新邮箱失败&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                </span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">loadUsers</span>();</span></span><br><span class="line"><span class="language-javascript">            &#125; <span class="keyword">catch</span> (error) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">showError</span>(error.<span class="property">message</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 显示错误信息</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">showError</span>(<span class="params">message, elementId = <span class="string">&#x27;form-error&#x27;</span></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> errorElement = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(elementId);</span></span><br><span class="line"><span class="language-javascript">            errorElement.<span class="property">textContent</span> = message;</span></span><br><span class="line"><span class="language-javascript">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> errorElement.<span class="property">textContent</span> = <span class="string">&#x27;&#x27;</span>, <span class="number">3000</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>或者使用vue cli 的 Vue3 页面：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;h1&gt;用户管理&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 添加用户表单 --&gt;</span><br><span class="line">    &lt;div class=&quot;add-user-form&quot;&gt;</span><br><span class="line">      &lt;h2&gt;添加新用户&lt;/h2&gt;</span><br><span class="line">      &lt;form @submit.prevent=&quot;createUser&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">          &lt;label&gt;用户名:&lt;/label&gt;</span><br><span class="line">          &lt;input v-model=&quot;newUser.username&quot; type=&quot;text&quot; required /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">          &lt;label&gt;邮箱:&lt;/label&gt;</span><br><span class="line">          &lt;input v-model=&quot;newUser.email&quot; type=&quot;email&quot; required /&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;button type=&quot;submit&quot;&gt;添加用户&lt;/button&gt;</span><br><span class="line">      &lt;/form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 用户列表 --&gt;</span><br><span class="line">    &lt;div class=&quot;user-list&quot;&gt;</span><br><span class="line">      &lt;h2&gt;用户列表&lt;/h2&gt;</span><br><span class="line">      &lt;table&gt;</span><br><span class="line">        &lt;thead&gt;</span><br><span class="line">          &lt;tr&gt;</span><br><span class="line">            &lt;th&gt;ID&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;用户名&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;邮箱&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;操作&lt;/th&gt;</span><br><span class="line">          &lt;/tr&gt;</span><br><span class="line">        &lt;/thead&gt;</span><br><span class="line">        &lt;tbody&gt;</span><br><span class="line">          &lt;tr v-for=&quot;user in users&quot; :key=&quot;user.id&quot;&gt;</span><br><span class="line">            &lt;td&gt;&#123;&#123; user.id &#125;&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;&#123;&#123; user.username &#125;&#125;&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;</span><br><span class="line">              &lt;span v-if=&quot;!user.editing&quot;&gt;&#123;&#123; user.email &#125;&#125;&lt;/span&gt;</span><br><span class="line">              &lt;input </span><br><span class="line">                v-else </span><br><span class="line">                v-model=&quot;user.editedEmail&quot; </span><br><span class="line">                type=&quot;email&quot; </span><br><span class="line">                required</span><br><span class="line">              /&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">            &lt;td&gt;</span><br><span class="line">              &lt;button </span><br><span class="line">                v-if=&quot;!user.editing&quot;</span><br><span class="line">                @click=&quot;startEdit(user)&quot;</span><br><span class="line">              &gt;</span><br><span class="line">                编辑</span><br><span class="line">              &lt;/button&gt;</span><br><span class="line">              &lt;div v-else class=&quot;edit-actions&quot;&gt;</span><br><span class="line">                &lt;button @click=&quot;saveEdit(user)&quot;&gt;保存&lt;/button&gt;</span><br><span class="line">                &lt;button @click=&quot;cancelEdit(user)&quot;&gt;取消&lt;/button&gt;</span><br><span class="line">              &lt;/div&gt;</span><br><span class="line">              &lt;button @click=&quot;deleteUser(user.id)&quot;&gt;删除&lt;/button&gt;</span><br><span class="line">            &lt;/td&gt;</span><br><span class="line">          &lt;/tr&gt;</span><br><span class="line">        &lt;/tbody&gt;</span><br><span class="line">      &lt;/table&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import &#123; ref, onMounted &#125; from &#x27;vue&#x27;</span><br><span class="line">import axios from &#x27;axios&#x27;</span><br><span class="line"></span><br><span class="line">const API_URL = &#x27;http://localhost:3001/api/users&#x27;</span><br><span class="line"></span><br><span class="line">// 用户数据</span><br><span class="line">const users = ref([])</span><br><span class="line">const newUser = ref(&#123;</span><br><span class="line">  username: &#x27;&#x27;,</span><br><span class="line">  email: &#x27;&#x27;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 初始化获取用户列表</span><br><span class="line">onMounted(async () =&gt; &#123;</span><br><span class="line">  await fetchUsers()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 获取所有用户</span><br><span class="line">const fetchUsers = async () =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    const response = await axios.get(API_URL)</span><br><span class="line">    users.value = response.data.map(user =&gt; (&#123;</span><br><span class="line">      ...user,</span><br><span class="line">      editing: false,</span><br><span class="line">      editedEmail: user.email</span><br><span class="line">    &#125;))</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    alert(&#x27;获取用户列表失败：&#x27; + error.message)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 创建用户</span><br><span class="line">const createUser = async () =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    await axios.post(API_URL, newUser.value)</span><br><span class="line">    await fetchUsers()</span><br><span class="line">    newUser.value = &#123; username: &#x27;&#x27;, email: &#x27;&#x27; &#125;</span><br><span class="line">    alert(&#x27;用户创建成功&#x27;)</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    alert(&#x27;创建用户失败：&#x27; + error.response?.data?.error || error.message)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 开始编辑</span><br><span class="line">const startEdit = (user) =&gt; &#123;</span><br><span class="line">  user.editing = true</span><br><span class="line">  user.editedEmail = user.email</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 取消编辑</span><br><span class="line">const cancelEdit = (user) =&gt; &#123;</span><br><span class="line">  user.editing = false</span><br><span class="line">  user.editedEmail = user.email</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 保存编辑</span><br><span class="line">const saveEdit = async (user) =&gt; &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    await axios.put(`$&#123;API_URL&#125;/$&#123;user.id&#125;`, &#123;</span><br><span class="line">      email: user.editedEmail</span><br><span class="line">    &#125;)</span><br><span class="line">    user.email = user.editedEmail</span><br><span class="line">    user.editing = false</span><br><span class="line">    alert(&#x27;更新成功&#x27;)</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    alert(&#x27;更新失败：&#x27; + error.response?.data?.error || error.message)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 删除用户</span><br><span class="line">const deleteUser = async (id) =&gt; &#123;</span><br><span class="line">  if (!confirm(&#x27;确定要删除这个用户吗？&#x27;)) return</span><br><span class="line">  </span><br><span class="line">  try &#123;</span><br><span class="line">    await axios.delete(`$&#123;API_URL&#125;/$&#123;id&#125;`)</span><br><span class="line">    await fetchUsers()</span><br><span class="line">    alert(&#x27;用户删除成功&#x27;)</span><br><span class="line">  &#125; catch (error) &#123;</span><br><span class="line">    alert(&#x27;删除失败：&#x27; + error.response?.data?.error || error.message)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.container &#123;</span><br><span class="line">  max-width: 800px;</span><br><span class="line">  margin: 0 auto;</span><br><span class="line">  padding: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.add-user-form &#123;</span><br><span class="line">  margin-bottom: 40px;</span><br><span class="line">  padding: 20px;</span><br><span class="line">  background: #f5f5f5;</span><br><span class="line">  border-radius: 8px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.form-group &#123;</span><br><span class="line">  margin-bottom: 15px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.form-group label &#123;</span><br><span class="line">  display: block;</span><br><span class="line">  margin-bottom: 5px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.form-group input &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">  padding: 8px;</span><br><span class="line">  border: 1px solid #ddd;</span><br><span class="line">  border-radius: 4px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">button &#123;</span><br><span class="line">  padding: 8px 15px;</span><br><span class="line">  margin: 0 5px;</span><br><span class="line">  border: none;</span><br><span class="line">  border-radius: 4px;</span><br><span class="line">  cursor: pointer;</span><br><span class="line">  background: #007bff;</span><br><span class="line">  color: white;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">button:hover &#123;</span><br><span class="line">  background: #0056b3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.edit-actions button &#123;</span><br><span class="line">  background: #28a745;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.edit-actions button:last-child &#123;</span><br><span class="line">  background: #dc3545;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-list table &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">  border-collapse: collapse;</span><br><span class="line">  margin-top: 20px;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-list th,</span><br><span class="line">.user-list td &#123;</span><br><span class="line">  padding: 12px;</span><br><span class="line">  border: 1px solid #ddd;</span><br><span class="line">  text-align: left;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-list th &#123;</span><br><span class="line">  background-color: #f8f9fa;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.user-list tr:nth-child(even) &#123;</span><br><span class="line">  background-color: #f2f2f2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">input[type=&quot;email&quot;] &#123;</span><br><span class="line">  width: 200px;</span><br><span class="line">  padding: 5px;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>解耦合：Vue3</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根目录.env.development</span></span><br><span class="line"><span class="variable constant_">VUE_APP_API_BASE_URL</span> = <span class="attr">http</span>:<span class="comment">//localhost:3001/api</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//根目录.env.production</span></span><br><span class="line"><span class="variable constant_">VUE_APP_API_BASE_URL</span> = <span class="attr">https</span>:<span class="comment">//your-production-domain.com/api</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//UserView.vue</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">API_BASE</span> = process.<span class="property">env</span>.<span class="property">VUE_APP_API_BASE_URL</span> || <span class="string">&#x27;/api&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">API_URL</span> = <span class="string">`<span class="subst">$&#123;API_BASE&#125;</span>/users`</span></span><br><span class="line"><span class="comment">/*取代</span></span><br><span class="line"><span class="comment">const API_URL = &#x27;http://localhost:3001/api/users&#x27;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//vue.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="comment">// 开发环境代理配置</span></span><br><span class="line">      <span class="string">&#x27;/api&#x27;</span>: &#123;</span><br><span class="line">        <span class="comment">/* </span></span><br><span class="line"><span class="comment">        如果 process.env.VUE_APP_API_BASE_URL 存在且为真值（truthy value），则使用该值 </span></span><br><span class="line"><span class="comment">        如果环境变量未定义（undefined）、空字符串（&#x27;&#x27;）、null 或其他假值（falsy），则使用 &#x27;http://localhost:3001&#x27;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="attr">target</span>: process.<span class="property">env</span>.<span class="property">VUE_APP_API_BASE_URL</span> || <span class="string">&#x27;http://localhost:3001&#x27;</span>,</span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">/* pathRewrite: &#123;</span></span><br><span class="line"><span class="comment">          &#x27;^/api&#x27;: &#x27;&#x27; // 移除路径中的 /api 前缀</span></span><br><span class="line"><span class="comment">        &#125; */</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>具体看 <strong>node-mysql-vue3</strong> 的源代码</p>
<hr>
<p>Node.js 支持与多种数据库进行集成，覆盖关系型、非关系型及国产数据库等类型。以下是具体分类及适配场景分析：</p>
<hr>
<h3 id="一、‌-关系型数据库（RDBMS）-‌‌"><a href="#一、‌-关系型数据库（RDBMS）-‌‌" class="headerlink" title="一、‌**关系型数据库（RDBMS）**‌‌"></a>一、‌**关系型数据库（RDBMS）**‌‌</h3><ul>
<li>‌<strong>MySQL</strong>‌<ul>
<li>‌<strong>特点</strong>‌：支持事务（ACID）、复杂查询（JOIN&#x2F;子查询）及成熟生态。</li>
<li>‌<strong>适配场景</strong>‌：用户管理、电商订单系统等需事务一致性的场景。</li>
<li>‌<strong>Node.js 驱动库</strong>‌：<code>mysql2</code>、<code>Sequelize</code>（ORM）。</li>
</ul>
</li>
<li>‌<strong>PostgreSQL</strong>‌<ul>
<li>‌<strong>特点</strong>‌：支持JSON数据类型、高级索引及地理空间数据处理。</li>
<li>‌<strong>适配场景</strong>‌：复杂数据分析、GIS系统等。</li>
<li>‌<strong>库支持</strong>‌：<code>pg</code>、<code>Sequelize</code>。</li>
</ul>
</li>
<li>‌<strong>SQLite</strong>‌<ul>
<li>‌<strong>特点</strong>‌：轻量级、无需独立服务，适合嵌入式场景。</li>
<li>‌<strong>适配场景</strong>‌：本地化应用、小型工具开发。</li>
</ul>
</li>
<li>‌<strong>其他</strong>‌：MariaDB（兼容MySQL）、Oracle、Microsoft SQL Server。</li>
</ul>
<hr>
<h3 id="二、‌-非关系型数据库（NoSQL）-‌"><a href="#二、‌-非关系型数据库（NoSQL）-‌" class="headerlink" title="二、‌**非关系型数据库（NoSQL）**‌"></a>二、‌**非关系型数据库（NoSQL）**‌</h3><p><strong>1‌. 文档数据库</strong>‌</p>
<ul>
<li>‌MongoDB<ul>
<li>‌<strong>特点</strong>‌：灵活JSON结构、水平扩展、高写入性能。</li>
<li>‌<strong>适配场景</strong>‌：实时日志处理、内容管理系统等非结构化数据场景。</li>
<li>‌<strong>库支持</strong>‌：<code>mongoose</code>（ODM）。</li>
</ul>
</li>
</ul>
<p>‌<strong>2. 键值存储</strong>‌</p>
<ul>
<li>‌Redis<ul>
<li>‌<strong>特点</strong>‌：内存存储、支持数据结构（如哈希&#x2F;列表）、高并发缓存。</li>
<li>‌<strong>适配场景</strong>‌：会话管理、热点数据缓存、实时排行榜。</li>
<li>‌<strong>库支持</strong>‌：<code>ioredis</code>、<code>redis</code>。</li>
</ul>
</li>
</ul>
<hr>
<h3 id="三、NoSQL-和-MySQL-区别"><a href="#三、NoSQL-和-MySQL-区别" class="headerlink" title="三、NoSQL 和 MySQL 区别"></a>三、NoSQL 和 MySQL 区别</h3><p>以下是 ‌<strong>NoSQL与MySQL的核心区别</strong>‌及其适用场景的对比分析，基于数据模型、扩展性、事务机制等关键维度：</p>
<hr>
<p><strong>1、‌数据模型与结构</strong>‌</p>
<table>
<thead>
<tr>
<th>‌<strong>维度</strong>‌</th>
<th>‌<strong>MySQL</strong>‌</th>
<th>‌<strong>NoSQL</strong>‌</th>
</tr>
</thead>
<tbody><tr>
<td>‌<strong>存储形式</strong>‌</td>
<td>基于表结构，需预定义模式（Schema）</td>
<td>支持灵活数据格式（文档&#x2F;键值&#x2F;列族&#x2F;图形）</td>
</tr>
<tr>
<td>‌<strong>数据关系</strong>‌</td>
<td>表间通过外键关联，强关系型设计</td>
<td>无固定关系约束，适合非结构化或半结构化数据</td>
</tr>
<tr>
<td>‌<strong>模式变更</strong>‌</td>
<td>修改表结构需执行ALTER操作，成本高</td>
<td>支持动态模式，可运行时增减字段</td>
</tr>
</tbody></table>
<hr>
<p><strong>2、‌扩展性与性能</strong>‌</p>
<table>
<thead>
<tr>
<th>‌<strong>维度</strong>‌</th>
<th>‌<strong>MySQL</strong>‌</th>
<th>‌<strong>NoSQL</strong>‌</th>
</tr>
</thead>
<tbody><tr>
<td>‌<strong>扩展方式</strong>‌</td>
<td>垂直扩展为主（提升单机性能）</td>
<td>水平扩展为主（分布式节点扩容）</td>
</tr>
<tr>
<td>‌<strong>并发处理</strong>‌</td>
<td>多线程处理，适合复杂事务但高并发下易瓶颈</td>
<td>异步I&#x2F;O优化，适合高吞吐量读写（如日志处理）</td>
</tr>
<tr>
<td>‌<strong>大数据支持</strong>‌</td>
<td>需分库分表，管理复杂度高</td>
<td>原生支持海量数据存储（如Cassandra列存储）</td>
</tr>
</tbody></table>
<hr>
<p><strong>3、‌事务与一致性</strong>‌</p>
<table>
<thead>
<tr>
<th>‌<strong>维度</strong>‌</th>
<th>‌<strong>MySQL</strong>‌</th>
<th>‌<strong>NoSQL</strong>‌</th>
</tr>
</thead>
<tbody><tr>
<td>‌<strong>事务机制</strong>‌</td>
<td>支持ACID事务（原子性&#x2F;一致性等）</td>
<td>通常仅支持最终一致性（如MongoDB）</td>
</tr>
<tr>
<td>‌<strong>锁机制</strong>‌</td>
<td>行级锁&#x2F;表级锁保证并发安全</td>
<td>部分数据库无锁设计（如Redis单线程模型）</td>
</tr>
<tr>
<td>‌<strong>适用场景</strong>‌</td>
<td>金融交易、ERP等强一致性需求场景</td>
<td>社交网络、实时统计等可用性优先场景</td>
</tr>
</tbody></table>
<hr>
<p><strong>4、‌查询语言与操作</strong>‌</p>
<table>
<thead>
<tr>
<th>‌<strong>维度</strong>‌</th>
<th>‌<strong>MySQL</strong>‌</th>
<th>‌<strong>NoSQL</strong>‌</th>
</tr>
</thead>
<tbody><tr>
<td>‌<strong>查询语言</strong>‌</td>
<td>标准SQL，支持复杂JOIN&#x2F;子查询</td>
<td>无统一语言，依赖API或特定语法（如MongoDB的BSON）</td>
</tr>
<tr>
<td>‌<strong>索引支持</strong>‌</td>
<td>支持多级索引（B+树结构）</td>
<td>部分数据库索引功能有限（如Redis仅支持键查询）</td>
</tr>
<tr>
<td>‌<strong>聚合操作</strong>‌</td>
<td>内置聚合函数（如SUM&#x2F;COUNT）</td>
<td>需依赖MapReduce或Pipeline（如MongoDB）</td>
</tr>
</tbody></table>
<hr>
<p><strong>5、‌典型应用场景对比</strong>‌</p>
<table>
<thead>
<tr>
<th>‌<strong>数据库类型</strong>‌</th>
<th>‌<strong>适用场景</strong>‌</th>
<th>‌<strong>典型案例</strong>‌</th>
</tr>
</thead>
<tbody><tr>
<td>‌<strong>MySQL</strong>‌</td>
<td>需事务保障的结构化数据场景</td>
<td>银行系统、订单管理、ERP系统</td>
</tr>
<tr>
<td>‌<strong>NoSQL</strong>‌</td>
<td>高并发读写、灵活数据模型需求</td>
<td>实时日志分析、社交网络推荐、物联网数据存储</td>
</tr>
</tbody></table>
<hr>
<p><strong>6、‌选型建议</strong>‌</p>
<ul>
<li>‌<strong>选择MySQL</strong>‌：需强一致性、复杂事务及固定数据结构的场景，如财务系统或传统企业应用。</li>
<li>‌<strong>选择NoSQL</strong>‌：应对高并发、动态数据结构或海量数据存储，如内容平台、实时监控系统。</li>
<li>‌<strong>混合使用</strong>‌：核心业务用MySQL保障ACID，高频读操作用Redis缓存，非结构化数据存MongoDB。</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/blog2025.github.io/2025/05/28/JavaScript/" rel="prev" title="JavaScript">
                  <i class="fa fa-angle-left"></i> JavaScript
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/blog2025.github.io/2025/05/28/TypeScript/" rel="next" title="TypeScript">
                  TypeScript <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    
    <!-- 去除心形图案
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    -->
    <span class="post-meta-divider">|</span>

    <span class="author" itemprop="copyrightHolder">lsdyun</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

<!--隐藏网页底部powered by Hexo 强力驱动-->
<!--
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>
-->

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous"></script>
<script src="/blog2025.github.io/js/comments.js"></script><script src="/blog2025.github.io/js/utils.js"></script><script src="/blog2025.github.io/js/motion.js"></script><script src="/blog2025.github.io/js/sidebar.js"></script><script src="/blog2025.github.io/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/blog2025.github.io/js/third-party/search/local-search.js"></script>




  <script src="/blog2025.github.io/js/third-party/fancybox.js"></script>

  <script src="/blog2025.github.io/js/third-party/pace.js"></script>


  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '64px',
  right: 'unset',
  left: '32px',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#100f2c',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script>

</body>
</html>
